
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>EPANETMSX 2.0 documentation</title>
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="canonical" href="https://epanetmsx20-manual.readthedocs.io/en/latest/index.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="#">EPANETMSX 2.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">EPANETMSX 2.0 documentation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="line-block">
<div class="line">Water Infrastructure Division</div>
<div class="line">Center for Environmental Solutions and Emergency Response</div>
<div class="line">Office of Research and Development</div>
<div class="line">U.S. Environmental Protection Agency</div>
<div class="line">Cincinnati, OH 45268</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-1_introduction"></span><section id="introducttion">
<span id="introduction"></span><h1>INTRODUCTTION<a class="headerlink" href="#introducttion" title="Permalink to this heading">¶</a></h1>
<p>EPANET <span id="id1">[<a class="reference internal" href="index.html#id8" title="L. A. Rossman. EPANET 2 Users Manual. U.S. Environmental Protection Agency, Cincinnati, OH, 2000.">Rossman, 2000</a>, <a class="reference internal" href="index.html#id9" title="L. A. Rossman, H. Woo, M. Tryby, F. Shang, R. Janke, and T. Haxton. EPANET 2.2 Users Manual. U.S. Environmental Protection Agency, Cincinnati, OH, 2020.">Rossman <em>et al.</em>, 2020</a>]</span> is a widely used program for modeling the
hydraulic and water quality behavior of drinking water distribution
systems. Its water quality component is limited to tracking the
transport and fate of just a single chemical species, such as fluoride
used in a tracer study or free chlorine used in a disinfectant decay
study. And the longitudinal dispersion process, which can play an important role in affecting the water qualities
at the dead ends of a water distribution system, is not modeled in EPANET.
This manual describes an extension to the original EPANET that
allows it to model the advection, dispersion and reaction of any system of multiple, interacting chemical species.
This capability has been incorporated into both a stand-alone executable
program as well as a toolkit library of functions that programmers can
use to build custom applications. This set of software tools is referred
to as EPANET-MSX, where MSX stands for Multi-Species Extension.</p>
<p>Many water quality problems in distribution systems can only be analyzed
by using a multi-species approach. Consider the following descriptive
examples:</p>
<ul class="simple">
<li><p>Free chlorine disinfectant is lost in bulk solution due mainly to oxidation-reduction
reactions involving HOCl and OCl<sup>-</sup> and natural organic matter (NOM). The NOM itself
is a heterogeneous mixture of organic compounds (e.g., humic and fulvic acids) of varying
chemical characteristics. Current single-species models, however, must model free chlorine loss under
the assumption that all other reactants are in excess and thus their concentrations
can be considered constant. This limitation is responsible for the
widespread observation that the water-specific decay rate constant
of the common first-order model is not a constant at all, but
rather varies significantly with chlorine dose (a clear indication
of model structure error). The formation of regulated chlorination
by-products, which result from free chlorine and NOM interactions,
presents yet another set of reaction mechanisms involving multiple interacting species.</p></li>
<li><p>Mono-, di-, and tri-chloramine result from interactions between free chlorine species and ammonia, and are increasingly used as
residual disinfectants. These chloramines also interact with NOM, though the reactions are slower than those for free chlorine. Thus
chloramine decay in distribution systems involves multiple interacting chemical species, which a single-species model is forced to simplify as a quasi-first order reaction. Further, ammonia may be produced by auto-decomposition of chloramines, which is of
significant practical importance for understanding nitrification episodes in distribution systems and storage tanks. Nitrification models may need to consider attached-growth nitrifying biofilms, suspended nitrifying biomass, and the
electron donor (ammonia), electron acceptor (oxygen), and carbon source that supports microbial growth.</p></li>
<li><p>For the relatively common situation where more than one water source supplies a distribution system, current models are not able to represent meaningful differences in source water quality, as they relate to water quality evolution in the distribution system. Modelers
must try to compensate for this limitation by assigning bulk decay rate coefficients to specific pipes, according to which source supplies them. Such an approach has obvious deficiencies when attempting to model distribution system zones where sources blend together, and
these zones are sometimes the focus of water quality issues.</p></li>
</ul>
<p>None of these examples can be accurately modeled by using the
single-species capabilities of the current EPANET program. This
shortcoming provides the motivation to extend EPANET so that it can
model reaction systems of any level of complexity.</p>
<p>Another feature in the the current version of the EPANET-MSX is the modeling option to include dispersion process in the water quality modeling analysis of water distribution system. EPANET models the transport of a single species by solving one-dimensional
advection-reaction (AR) equation; while the EPAENT-MSX solves a set of one-dimensional advection-dispersion-reaction (ADR) equations to analyze the water quality problems that involve mutiple interacting species.</p>
<p>The following sections of this manual describe the conceptual framework
used by EPANET-MSX to model multiple reacting species within a
distribution system, provide instructions on how to use both the command
line and toolkit versions of EPANET-MSX, give a complete description of
the format of an MSX input file, and describe several example
applications in detail. The appendices describe each function in the
EPANET-MSX toolkit, the format of its binary output file, and the
meaning of its error codes.</p>
</section>
<span id="document-2_framework"></span><section id="conceptual-framework">
<span id="framework"></span><h1>CONCEPTUAL FRAMEWORK<a class="headerlink" href="#conceptual-framework" title="Permalink to this heading">¶</a></h1>
<p>From a water quality modeling perspective, two significant physical
phases exist within a water distribution system: a mobile bulk water
phase and a fixed pipe surface phase. Bulk phase species are chemical or
biological components that exist within the bulk water phase and are
transported through the system with the average water velocity. Surface
phase species are components that are attached or incorporated into the
pipe wall and are thus rendered immobile. <a class="reference internal" href="#figure-2-1"><span class="std std-numref">Fig. 2.1</span></a> shows an example of
bulk phase chlorine (HOCl) reacting with bulk phase NOM (natural organic
matter) to produce a bulk phase disinfectant by-product (DBP), while
also oxidizing ferrous iron to ferric iron in the fixed surface phase at
the pipe wall.</p>
<figure class="align-default" id="id8">
<span id="figure-2-1"></span><a class="reference internal image-reference" href="_images/image2.png"><img alt="_images/image2.png" src="_images/image2.png" style="width: 5.96388in; height: 2.76667in;" /></a>
<figcaption>
<p><span class="caption-text">Example of reactions in the mobile bulk phase and at the fixed pipe surface phase.</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Examples of bulk species include dissolved constituents (individual
compounds or ions, such as HOCl and OCl<sup>-</sup>, as well as aggregate
components such as TOC), suspended constituents (such as bacterial cells
and inorganic particulates), and chemicals adsorbed onto particles.
Examples of surface species include bacteria incorporated within
biofilm, oxidized forms of iron contained within corrosion scale,
particulate material that settles out due to gravity or is attached to
the pipe wall surface through ionic or molecular (i.e., van der Waal)
forces, and organic compounds that can diffuse into or out of plastic
pipes or be adsorbed onto or desorbed from iron oxide pipe surfaces.
Some components, such as bacteria and particulates, can exist in both
the bulk and surface phases and transfer from one phase to another by
such mechanisms as physical attachment/detachment, chemical adsorption
or molecular diffusion. In such situations, the component is modeled as
two species: one bulk and the other surface.</p>
<p>Additional phases that might exist within a distribution system, such as
a mobile bed sediment phase, an immobile water phase within the pore
structure of pipe scale, or an air phase overlying the water surface in
a storage tank, could also be included within this modeling framework.</p>
<section id="material-transport">
<span id="section-material-transport"></span><h2><em>Material Transport</em><a class="headerlink" href="#material-transport" title="Permalink to this heading">¶</a></h2>
<p>A water distribution system consists of pipes, pumps, valves, fittings
and storage facilities that convey water from source points to
consumers. This physical system is modeled as a network of links
connected together at nodes in some particular branched or looped
arrangement. <a class="reference internal" href="#figure-2-2"><span class="std std-numref">Fig. 2.2</span></a> provides an example of a network representation
of a very simple distribution system. Links represent pipes, pumps, and
valves; nodes serve as source points, consumption points and storage
facilities. The following phenomena all influence the quality of water
contained in the system and can be modeled using principles of
conservation of mass coupled with reaction kinetics:</p>
<figure class="align-default" id="id9">
<span id="figure-2-2"></span><a class="reference internal image-reference" href="_images/image3.png"><img alt="Chart, diagram, schematic, box and whisker chart Description automatically generated" src="_images/image3.png" style="width: 3.22528in; height: 2.3002in;" /></a>
<figcaption>
<p><span class="caption-text">Node-link representation of a simple distribution system.</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<ol class="loweralpha simple">
<li><p><em>Advective transport in pipes</em>: bulk species are transported down the
length of a pipe with the same average velocity as the carrier fluid
while at the same time reacting with other bulk species and with the
pipe wall surface.</p></li>
<li><p><em>Dispersive transport in pipes</em>: due to the differences of concentrations and flow
velocities, bulk species spread from highly concentrated to less concentrated areas.</p></li>
<li><p><em>Mixing at pipe junctions</em>: at junctions receiving inflow from two or
more links the flows are assumed to undergo complete and
instantaneous mixing.</p></li>
<li><p><em>Mixing in storage nodes</em>: all inflows to storage nodes mix
completely with the existing contents in storage while these contents
are subjected to possible bulk phase reactions (alternative schemes
are available for modeling plug flow storage tanks).</p></li>
</ol>
</section>
<section id="advection-dispersion-and-reaction">
<span id="section-advection-dispersion-reaction"></span><h2><em>Advection, Dispersion and Reaction</em><a class="headerlink" href="#advection-dispersion-and-reaction" title="Permalink to this heading">¶</a></h2>
<p>One-dimensional mass transport in a pipe with a uniform
cross-sectional area can be described as advection-dispersion-reaction equations. For a specific species,</p>
<blockquote>
<div><div class="math notranslate nohighlight" id="equation-1dadr">
<span class="eqno">()<a class="headerlink" href="#equation-1dadr" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\frac{\partial {c_i}}  {\partial {t}} + u \frac{\partial {c_i}}  {\partial {x}}= D_i\frac{\partial^2 {c_i}}  {\partial {x^2}}+r(\boldsymbol{c})
\end{aligned}\]</div>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(i\)</span> = species index; <span class="math notranslate nohighlight">\(c_i\)</span> = concentration of the species <span class="math notranslate nohighlight">\(i\)</span>; <span class="math notranslate nohighlight">\(u\)</span> = flow velocity; <span class="math notranslate nohighlight">\(x\)</span> = distance alone the pipe’s longitudinal direction;
<span class="math notranslate nohighlight">\(D_i\)</span> = effective dispersion coefficient of the species <span class="math notranslate nohighlight">\(i\)</span>; <span class="math notranslate nohighlight">\(r_i\)</span> = reaction rate of the species <span class="math notranslate nohighlight">\(i\)</span>; and <span class="math notranslate nohighlight">\(\boldsymbol{c}\)</span> = the concentration vector of all species which includes both differential and algebraic variables as
defined in <a class="reference internal" href="#section-chemical-reaction"><span class="std std-ref">Chemical Reactions</span></a> (<a class="reference internal" href="#section-chemical-reaction"><span class="std std-numref">Section 2.3</span></a>).</p>
<p>The impact of dispersion may be negligible for many parts of water distribution systems under highly turbulent conditions. However, it is important to consider dispersion when modeling
dead-end segments of a system or premise plumbing systems where the flow Reynolds number can be low. The relative importance of the dispersion can be
quantified with the Peclet number:</p>
<blockquote>
<div><div class="math notranslate nohighlight" id="equation-peclet-number">
<span class="eqno">()<a class="headerlink" href="#equation-peclet-number" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
Pe_i = {\frac{ul}  {D_i}}
\end{aligned}\]</div>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(l\)</span> = pipe length. The Peclet number is a measure of the relative importance of advection versus dispersion, where a large number indicates an advectiion-dominated flow condition in which the dispersion is negligible.</p>
<p>The effective longitudinal dispersion coefficient accounts for the combined effect of the diffusion and the shear dispersion due to the
nonuniformity of the velocity profile. For laminar flow conditions, the effective dispersion coefficient is calcuated as an averaged value over the residence time <span id="id1">[<a class="reference internal" href="index.html#id13" title="Y. Lee. Mass dispersion in intermittent laminar flow. PhD thesis, University of Cincinnati, Cincinnati, Ohio, USA, 2004.">Lee, 2004</a>]</span>:</p>
<blockquote>
<div><div class="math notranslate nohighlight" id="equation-lee-formula">
<span class="eqno">()<a class="headerlink" href="#equation-lee-formula" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
D = {\frac {a^2u^2} {48D_m}}\left[1-\left[\frac{1-exp\left(-16\frac{D_mt_r}{a^2}\right)}{16{\frac{D_mt_r}{a^2}}} \right] \right]
\end{aligned}\]</div>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(D_m\)</span> = molecular diffusion coefficient; <span class="math notranslate nohighlight">\(a\)</span> = pipe radius; and <span class="math notranslate nohighlight">\(t_r\)</span> = pipe residence time (<span class="math notranslate nohighlight">\(\frac {l} {u}\)</span>).</p>
<p>For turbulent flow conditions, the effective dispersion coefficient does not depend on the molecular diffusion coefficient and the formula
used is <span id="id2">[<a class="reference internal" href="index.html#id12" title="H. A. Basha and L. N. Malaeb. Eulerian-lagrangain method for constituent transport in water distribution networks. Journal of Hydraulic Engineering, 133:1155-1166, October 2007.">Basha and Malaeb, 2007</a>]</span>:</p>
<blockquote>
<div><div class="math notranslate nohighlight" id="equation-basha-formula">
<span class="eqno">()<a class="headerlink" href="#equation-basha-formula" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
D = au_{\ast}\left[10.1+577\left(\frac{Re}{1000}\right)^{-2.2}\right]
\end{aligned}\]</div>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(u_{\ast}\)</span> = shear velocity; and <span class="math notranslate nohighlight">\(Re\)</span> = the Reynolds number.</p>
</section>
<section id="chemical-reactions">
<span id="section-chemical-reaction"></span><h2><em>Chemical Reactions</em><a class="headerlink" href="#chemical-reactions" title="Permalink to this heading">¶</a></h2>
<p>Reactions can be divided into two classes based on reaction rates. Some
reactions are reversible and fast enough in comparison with the system’s
other processes so that a local equilibrium can be assumed; others are
not sufficiently fast and/or irreversible and it is inappropriate to use
an equilibrium formulation to represent them. Theoretically, very large
backward and forward rate constants (with their ratio equaling the
equilibrium constant) can be used to model fast/equilibrium reactions
and therefore both fast/equilibrium and slow/kinetic reaction dynamics
can be written as a single set of ordinary differential equations (ODEs)
that can be integrated over time to simulate changes in species
concentrations. This approach can result in reaction rates that may
range over several orders of magnitude and lead to such small
integration time steps so as to make a numerical solution impractical.</p>
<p>In EPANET-MSX, algebraic equations are used to represent the
fast/equilibrium reactions and mass conservation. Thus it is assumed
that all reaction dynamics can be described by a set of
differential-algebraic equations (DAEs) that is in semi-explicit format.
The system of DAEs that defines the interactions between bulk species,
surface species, and parameter values can be written in general terms
as:</p>
<blockquote>
<div><div class="math notranslate nohighlight" id="equation-daebulk">
<span class="eqno">()<a class="headerlink" href="#equation-daebulk" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\frac{d \boldsymbol{x_b}}  {d {t}} = \boldsymbol {f(x_b, x_s, z_b, z_s, p)}
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-daewall">
<span class="eqno">()<a class="headerlink" href="#equation-daewall" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\frac{d\boldsymbol{x_s}} {d {t}}= \boldsymbol  {g(x_b, x_s, z_b, z_s, p)}
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-daeequil">
<span class="eqno">()<a class="headerlink" href="#equation-daeequil" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\boldsymbol{0} = \boldsymbol{h(x_b, x_s, z_b, z_s, p)}
\end{aligned}\]</div>
</div></blockquote>
<p>where the vectors of time-varying differential variables <span class="math notranslate nohighlight">\(\boldsymbol{x_b}\)</span> and
<span class="math notranslate nohighlight">\(\boldsymbol{x_s}\)</span> are associated with the bulk water and pipe surface,
respectively, the time-varying algebraic variables <span class="math notranslate nohighlight">\(\boldsymbol{z_b}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{z_s}\)</span>
are similarly associated, and the model parameters <span class="math notranslate nohighlight">\(\boldsymbol{p}\)</span> are time
invariant. The algebraic variables are assumed to reach equilibrium in
the system within a much smaller time scale compared to the numerical
time step used to integrate the ODEs. The dimension of the algebraic
equations <span class="math notranslate nohighlight">\(\boldsymbol{h}\)</span> must agree with that of the algebraic variables <span class="math notranslate nohighlight">\(\boldsymbol{z}\)</span> =
[<span class="math notranslate nohighlight">\(\boldsymbol{z_b}\)</span> <span class="math notranslate nohighlight">\(\boldsymbol{z_s}\)</span>], so that the total number of equations in <a class="reference internal" href="#equation-daebulk">(2.5)</a>-<a class="reference internal" href="#equation-daeequil">(2.7)</a> equals
the total number of time-varying species ([<span class="math notranslate nohighlight">\(\boldsymbol{x_b}\)</span> <span class="math notranslate nohighlight">\(\boldsymbol{x_s}\)</span> <span class="math notranslate nohighlight">\(\boldsymbol{z_b}\)</span> <span class="math notranslate nohighlight">\(\boldsymbol{z_s}\)</span>]).</p>
<p>As a simple example of a reaction/equilibrium system modeled as a set of
DAEs, consider the oxidation of arsenite (<span class="math notranslate nohighlight">\(As^{+3}\)</span>) to arsenate
(<span class="math notranslate nohighlight">\(As^{+5}\)</span>) by a monochloramine disinfectant residual in the bulk
flow and the subsequent adsorption of arsenate onto exposed iron on the
pipe wall. (Arsenite adsorption is not significant at the pH’s typically
found in drinking water.) A more complete explanation and extension of
this model is presented in <a class="reference internal" href="index.html#examplesystems"><span class="std std-ref">EXAMPLE REACTION SYSTEMS</span></a> (<a class="reference internal" href="index.html#examplesystems"><span class="std std-numref">Section 5</span></a>) of this manual. This system
consists of four species (arsenite, arsenate, and monochloramine in the
bulk flow, and sorbed arsenate on the pipe surface). It can be modeled
with three differential rate equations and one equilibrium equation:</p>
<div class="math notranslate nohighlight" id="equation-as3">
<span class="eqno">()<a class="headerlink" href="#equation-as3" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\frac{d As^{+3}} {d {t}} = -k_a As^{+3}(NH_2Cl)
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-as5">
<span class="eqno">()<a class="headerlink" href="#equation-as5" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\frac{d As^{+5}} {d {t}} = k_a As^{+3}(NH_2Cl)-A_v[k_1(S_{max}-As_s^{+5})As^{+5}-k_2As_s^{+5}]
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-nh2cl">
<span class="eqno">()<a class="headerlink" href="#equation-nh2cl" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\frac{d (NH_2Cl)} {d {t}} =-k_b (NH_2Cl)
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-as5s">
<span class="eqno">()<a class="headerlink" href="#equation-as5s" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
As_s^{+5} = \frac{k_s S_{max} As^{+5}}{1+k_s As^{+5}}
\end{aligned}\]</div>
<p>where <span class="math notranslate nohighlight">\(As^{+3}\)</span> is the bulk phase concentration of arsenite,
<span class="math notranslate nohighlight">\(As^{+5}\)</span> is the bulk phase concentration of arsenate, <span class="math notranslate nohighlight">\(As_s^{+5}\)</span> is
surface phase concentration of arsenate, and <span class="math notranslate nohighlight">\(NH_2Cl\)</span> is the
bulk phase concentration of monochloramine. The parameters in these
equations are as follows: <span class="math notranslate nohighlight">\(k_a\)</span> is a rate coefficient for arsenite
oxidation, <span class="math notranslate nohighlight">\(k_b\)</span> is a monochloramine decay rate coefficient,
<span class="math notranslate nohighlight">\(A_v\)</span> is the pipe surface area per liter pipe volume, <span class="math notranslate nohighlight">\(k_1\)</span>
and <span class="math notranslate nohighlight">\(k_2\)</span> are arsenate adsorption and desorption rate
coefficients, <span class="math notranslate nohighlight">\(S_{max}\)</span> is the maximum pipe surface concentration of
arsenate, and <span class="math notranslate nohighlight">\(k_s\)</span> = <span class="math notranslate nohighlight">\(k_1/k_2\)</span>. Thus in terms of
the notation used in <a class="reference internal" href="#equation-daebulk">(2.5)</a>-<a class="reference internal" href="#equation-daeequil">(2.7)</a>, <span class="math notranslate nohighlight">\(\boldsymbol{x_b} = {\{As^{+3},
As^{+5}, NH_2Cl\}}\)</span>, <span class="math notranslate nohighlight">\(\boldsymbol{x_s} = {\{\emptyset\}}\)</span>, <span class="math notranslate nohighlight">\(\boldsymbol{z_b} = {\{\emptyset\}}\)</span>,
<span class="math notranslate nohighlight">\(\boldsymbol{z_s} = {\{As_s^{+5}\}}\)</span>, <span class="math notranslate nohighlight">\(\boldsymbol{p} = {\{k_a, k_b, A_v, k_1, k_2, S_{max}\}}\)</span>. Example input
files for this form of the model are included with the standard
EPANET-MSX distribution, while the input file for a more complex version
of the model is presented in <a class="reference internal" href="index.html#examplesystems"><span class="std std-ref">EXAMPLE REACTION SYSTEMS</span></a> (<a class="reference internal" href="index.html#examplesystems"><span class="std std-numref">Section 5</span></a>).</p>
</section>
<section id="full-network-solution">
<span id="section-network-solution"></span><h2><em>Full Network Solution</em><a class="headerlink" href="#full-network-solution" title="Permalink to this heading">¶</a></h2>
<p>Dynamic models of water quality within water distribution systems can be
classified spatially as either Eulerian or Lagrangian. Eulerian models
divide the network into a series of fixed control elements and record
the changes at the boundaries and within these elements, while
Lagrangian models track changes of discrete parcels of water as they
travel through the network. EPANET-MSX utilizes the Lagrangian
transport algorithm as used by EPANET. It tracks the movement and reaction of chemicals in discrete
water volumes, or segments. These segments are transported through
network pipes by the bulk velocity, and completely mix at junction
nodes. This method is relatively efficient because the number and size
of the segments in a pipe can change as hydraulic conditions change. In addition, the effevtive dispersion along the
longitudinal direction is modeled. The details of the Lagranigain algorithm to model advection, dispersion and reaction are described in <span id="id3">[<a class="reference internal" href="index.html#id11" title="F. Shang, H. Woo, J. B. Burkhardt, and R. Murray. Lagrangian method to model advection-dispersion-reaction transport in drinking water pipe networks. Journal of Water Resources Planning and Management, September 2021.">Shang <em>et al.</em>, 2021</a>]</span>.</p>
<p>In summary form, the following steps, depicted visually in <a class="reference internal" href="#figure-2-3"><span class="std std-numref">Fig. 2.3</span></a>,
are performed for each water quality time step:</p>
<ol class="arabic simple">
<li><p><em>React:</em> Apply reaction dynamics within each pipe segment and storage
tank over the time step to compute new concentrations throughout the
network.</p></li>
<li><p><em>Advect:</em> Within each pipe, compute the flow volume transported over
the time step and transfer this amount of volume and its associated
bulk species mass from the pipe’s leading segments into accumulated
mass and volume totals at the downstream node.</p></li>
<li><p><em>Mix:</em> Compute new bulk species concentrations at each node based on
its accumulated mass and volume inputs from the advection step as
well as any external sources.</p></li>
<li><p><em>Release:</em> Create a new segment at the upstream end of each pipe
whose size equals the pipe’s flow volume and whose bulk species
concentrations equal that of the upstream node (or if the difference
in quality between the most upstream segment and the upstream node is
below some tolerance, simply increase the size of the current
upstream segment).</p></li>
<li><p><em>Disperse:</em> Solve the disperison process equation and update both nodal and segment concentrations.</p></li>
</ol>
<figure class="align-default" id="id10">
<span id="figure-2-3"></span><img alt="_images/image12_dispersion.png" src="_images/image12_dispersion.png" />
<figcaption>
<p><span class="caption-text">Illustration of the 5-step water quality transport method for pipe networks. The upper pipe segments contain flowing water while the lower segments are the pipe wall surface. The numbers in each segment represent hypothetical bulk and surface species concentrations, respectively.</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="reaction-system-solution">
<span id="section-reaction-solution"></span><h2><em>Reaction System Solution</em><a class="headerlink" href="#reaction-system-solution" title="Permalink to this heading">¶</a></h2>
<p>The multi-species water quality algorithm modifies the <em>React</em> step
(step 1) of the solution scheme described above. Within each pipe
segment, reaction dynamics are represented by the system of DAEs
<a class="reference internal" href="#equation-daebulk">(2.5)</a>-<a class="reference internal" href="#equation-daeequil">(2.7)</a>. The same applies for storage tanks, except that the DAEs are
modified to consider only bulk reactions. Although not indicated, the
model parameters <strong>p</strong> can possibly vary by pipe. For the equilibrium
reactions it is assumed that the Jacobian matrix of <span class="math notranslate nohighlight">\(\boldsymbol{h}\)</span> with respect
to <span class="math notranslate nohighlight">\(\boldsymbol{z}\)</span>, <span class="math notranslate nohighlight">\(\partial \boldsymbol{h} \over \partial \boldsymbol{z}\)</span>, is unique and nonsingular for all <span class="math notranslate nohighlight">\(t\)</span>. In
this case, the implicit functions defined by <a class="reference internal" href="#equation-daeequil">(2.7)</a>,</p>
<div class="math notranslate nohighlight" id="equation-abulk">
<span class="eqno">()<a class="headerlink" href="#equation-abulk" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\boldsymbol{z_b} = \boldsymbol{z_b}(\boldsymbol{x_b}, \boldsymbol{x_s}, \boldsymbol{p})
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-asurface">
<span class="eqno">()<a class="headerlink" href="#equation-asurface" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\boldsymbol{z_s} = \boldsymbol{z_s}(\boldsymbol{x_b}, \boldsymbol{x_s}, \boldsymbol{p})
\end{aligned}\]</div>
<p>exist, are continuous and unique, and possess continuous partial
derivatives. These properties, and in particular the resultant ability
to evaluate <a class="reference internal" href="#equation-abulk">(2.12)</a>-<a class="reference internal" href="#equation-asurface">(2.13)</a> (numerically), are central to the numerical
algorithms used for solution of <a class="reference internal" href="#equation-daebulk">(2.5)</a>-<a class="reference internal" href="#equation-daeequil">(2.7)</a>.</p>
<p>Given the implicit functions  <a class="reference internal" href="#equation-abulk">(2.12)</a>-<a class="reference internal" href="#equation-asurface">(2.13)</a>, the solution of <a class="reference internal" href="#equation-daebulk">(2.5)</a>-<a class="reference internal" href="#equation-daeequil">(2.7)</a> is
performed by substituting  <a class="reference internal" href="#equation-abulk">(2.12)</a>-<a class="reference internal" href="#equation-asurface">(2.13)</a> into <a class="reference internal" href="#equation-daebulk">(2.5)</a>-<a class="reference internal" href="#equation-daewall">(2.6)</a>, thus eliminating the
algebraic equations <a class="reference internal" href="#equation-daeequil">(2.7)</a> and leaving a reduced system of ordinary
differential equations (ODEs) that can be integrated numerically:</p>
<div class="math notranslate nohighlight" id="equation-reduced-bulk">
<span class="eqno">()<a class="headerlink" href="#equation-reduced-bulk" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\frac{d \boldsymbol{x_b}} {d {t}} = \boldsymbol {f(x_b, x_s, z_b(x_b, x_s, p), z_s(x_b, x_s, p), p)} = \boldsymbol {f'(x_b, x_s, p)}
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-reduced-wall">
<span class="eqno">()<a class="headerlink" href="#equation-reduced-wall" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\frac{d\boldsymbol{x_s}} {d {t}}= \boldsymbol  {g(x_b, x_s, z_b(x_b, x_s, p), z_s(x_b, x_s, p), p)} = \boldsymbol {g'(x_b, x_s, p)}
\end{aligned}\]</div>
<p>Note that the above “substitution” is not performed literally, since
<a class="reference internal" href="#equation-abulk">(2.12)</a>-<a class="reference internal" href="#equation-asurface">(2.13)</a> are implicit, and thus so are the reduced trajectories <span class="math notranslate nohighlight">\(\boldsymbol{f'}\)</span>
and <span class="math notranslate nohighlight">\(\boldsymbol{g'}\)</span>. Solving <a class="reference internal" href="#equation-reduced-bulk">(2.14)</a>-<a class="reference internal" href="#equation-reduced-wall">(2.15)</a> numerically with an explicit method,
such as any of the Runge-Kutta schemes, will require that <span class="math notranslate nohighlight">\(\boldsymbol{f'}\)</span> and
<span class="math notranslate nohighlight">\(\boldsymbol{g'}\)</span> be evaluated at intermediate values of <span class="math notranslate nohighlight">\(\boldsymbol{x_b}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{x_s}\)</span>
over the integration time step. Each such evaluation will in turn
require a solution of the nested set of algebraic equations <a class="reference internal" href="#equation-abulk">(2.12)</a>-<a class="reference internal" href="#equation-asurface">(2.13)</a>.
Alternative strategies for accomplishing these steps are discussed in
the <a class="reference internal" href="#section-model-implementation"><span class="std std-ref">Model Implementation</span></a> (<a class="reference internal" href="#section-model-implementation"><span class="std std-numref">Section 2.7</span></a>) below.</p>
<p>In addition to the <em>React</em> step, evaluation of the equilibrium equations
also needs to be performed at the <em>Mix</em> phase of the overall algorithm
since the blending together of multiple flow streams can result in a new
equilibrium condition. This process needs to be performed at each
network node, including storage tanks.</p>
</section>
<section id="pipe-surface-discretization">
<span id="section-pipe-surface"></span><h2><em>Pipe Surface Discretization</em><a class="headerlink" href="#pipe-surface-discretization" title="Permalink to this heading">¶</a></h2>
<p>The segment bulk water state variables <span class="math notranslate nohighlight">\(\boldsymbol{x_b}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{z_b}\)</span> have moving
coordinates, due to the nature of the Lagrangian water quality model
(they move with the bulk water velocity). In contrast the associated
pipe surface variables <span class="math notranslate nohighlight">\(\boldsymbol{x_s}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{z_s}\)</span> have fixed coordinates,
since they are associated with the non-moving pipe. The lack of a common
fixed coordinate system for the bulk and surface state variables must be
reconciled, since these variables interact through the common pipe-water
interface (through equations <a class="reference internal" href="#equation-daebulk">(2.5)</a>-<a class="reference internal" href="#equation-daeequil">(2.7)</a>). To resolve this issue a simple
mass-conserving scheme is applied at every water quality time step to
update the pipe surface elements to remain consistent with the
(advected) water quality segments and re-distribute the surface variable
mass among the updated elements.</p>
<p>As shown in <a class="reference internal" href="#figure-2-3"><span class="std std-numref">Fig. 2.3</span></a>, within any single water quality time step, a
moving mesh divides each pipe surface into discrete-length elements,
such that each shares a common surface/water interface with the water
quality segment above it. At the end of the time step the pipe elements
will, however, be inconsistent with the water quality segments, due to
advection of the latter (i.e., through the <em>Advect</em> step of the overall
algorithm). This inconsistency is removed by updating the surface
species concentrations using an interfacial area-weighted average:</p>
<div class="math notranslate nohighlight" id="equation-wall-update1">
<span class="eqno">()<a class="headerlink" href="#equation-wall-update1" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\boldsymbol{x}_{\boldsymbol{s}i}^{new}=\left( \frac{1} {L_{i}^{new}} \right) \sum_{j=1}^{n}(L_{i}^{new} \cap L_{j})\boldsymbol{x}_{\boldsymbol{s}j} \qquad \text{for} \quad i = 1, ... n^{new}
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-wall-update2">
<span class="eqno">()<a class="headerlink" href="#equation-wall-update2" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
\boldsymbol{z}_{\boldsymbol{s}i}^{new}=\left( \frac{1}{L_{i}^{new}} \right) \sum_{j=1}^{n}(L_{i}^{new} \cap L_{j})\boldsymbol{z}_{\boldsymbol{s}j} \qquad \text{for} \quad i = 1, ... n^{new}
\end{aligned}\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> is the water quality segment index, <span class="math notranslate nohighlight">\(n\)</span> is the number of water
quality segments in the pipe during the most recent <em>React</em> step, <span class="math notranslate nohighlight">\(L_j\)</span>
is the length of segment <span class="math notranslate nohighlight">\(j\)</span>, with corresponding vectors of surface
species <span class="math notranslate nohighlight">\(\boldsymbol{x}_{sj}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{z}_{sj}\)</span>, <span class="math notranslate nohighlight">\(n^{new}\)</span> is the updated
number of water quality segments in the pipe after advection,
<span class="math notranslate nohighlight">\(L_i^{new}\)</span> is the length of each updated segment, with corresponding
updated surface concentrations <span class="math notranslate nohighlight">\(\boldsymbol{x}_{si}^{new}\)</span> and
<span class="math notranslate nohighlight">\(\boldsymbol{z}_{si}^{new}\)</span>. The quantity <span class="math notranslate nohighlight">\((L_i^{new} \cap L_j)\)</span> is the
length of the overlapping intersection between segment <span class="math notranslate nohighlight">\(j\)</span> and updated
segment <span class="math notranslate nohighlight">\(i\)</span>.</p>
</section>
<section id="model-implementation">
<span id="section-model-implementation"></span><h2><em>Model Implementation</em><a class="headerlink" href="#model-implementation" title="Permalink to this heading">¶</a></h2>
<p>EPANET-MSX offers several choices of numerical integration methods for
solving the reaction system’s ODEs, equations <a class="reference internal" href="#equation-daebulk">(2.5)</a> and <a class="reference internal" href="#equation-daewall">(2.6)</a>. These include
a forward Euler method (as used in EPANET), a fifth order Runge-Kutta
method with automatic time step control <span id="id4">[<a class="reference internal" href="index.html#id6" title="E. Hairer, S.P. Norsett, and G. Warner. Solving Ordinary Differential Equations I. Nonstiff Problems. Springer Series in Computational Mathematics. Springer-Verlag, 2 edition, 1993.">Hairer <em>et al.</em>, 1993</a>]</span>, and a
second order Rosenbrock method with automatic time step control <span id="id5">[<a class="reference internal" href="index.html#id3" title="J.G. Verwer, E.J. Spee, J.G. Blom, and W.H. Hundsdorfer. A second order rosenbrock method applied to photochemical dispersion problems. SIAM Journal on Scientific Computing, 20:1456-1480, 1992.">Verwer <em>et al.</em>, 1992</a>]</span>. These are listed in order of the numerical work per time
step required to obtain a solution. The Euler method is best applied to
non-stiff, linear reaction systems, the Runge-Kutta method to non-stiff,
nonlinear systems, and the Rosenbrock method to stiff systems (see,
e.g., <span id="id6">Golub and Ortega [<a class="reference internal" href="index.html#id7" title="G. H. Golub and J. M. Ortega. Scientific computing and ordinary differential equations. Academic Press, 1992.">1992</a>]</span>).</p>
<p>The algebraic equilibrium equations <a class="reference internal" href="#equation-daeequil">(2.7)</a> are solved using a standard
implementation of the Newton method <span id="id7">[<a class="reference internal" href="index.html#id2" title="W.H. Press, B.P. Flannery, S.A. Teukolsky, and W.T. Vetterling. Numerical Recipes in C. Cambridge University Press, 2nd edition, 1992.">Press <em>et al.</em>, 1992</a>]</span>. This algorithm
requires that the Jacobian of <span class="math notranslate nohighlight">\(\boldsymbol{h}\)</span> with respect to the algebraic
variables <span class="math notranslate nohighlight">\(\boldsymbol{z_b}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{z_s}\)</span> be used to iteratively solve an
approximating linear system of equations until convergence is achieved.
This can be a computationally expensive procedure since the Jacobian
must be evaluated numerically and the system <a class="reference internal" href="#equation-daeequil">(2.7)</a> is being solved within
every pipe segment of every pipe at every time step, possibly several
times over, as the ODEs are integrated. To help reduce this burden
EPANET-MSX offers the following options for evaluating the nonlinear
equilibrium equation system:</p>
<ul class="simple">
<li><p>The <strong>Non-Coupled</strong> option only evaluates the equilibrium equations
at the end of the time step after a new ODE solution has been found;
the algebraic variables maintain the values they had at the start of
the time step while the ODEs are being numerically integrated.</p></li>
<li><p>The <strong>Fully-Coupled</strong> option solves the algebraic equations at each
stage of the ODE solution process using a fresh Jacobian for each
Newton step.</p></li>
</ul>
<p>The choice of coupling involves a trade-off between computational effort
and level of accuracy, the degree of which will likely be very system
dependent.</p>
<p>Mass balance report is now provided for all the species that are represented by the differential variables, <span class="math notranslate nohighlight">\(\boldsymbol{x_b}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{x_s}\)</span>.</p>
<p>The current version of EPANET-MSX (2.0) takes an operator splitting approach and the dispersion process can be optionally modeled after solving the advection and reaction equations. Computationally it is not efficient to inclue all the pipes since the flow is highly turbulent and the dispersion effect is
negligible in many pipes. EPANET-MSX provides an option to exclude pipes based on the relative importance of the advection over dispersion, i.e. the Peclet number.</p>
</section>
</section>
<span id="document-3_programusage"></span><section id="program-usage">
<span id="usage"></span><h1>PROGRAM USAGE<a class="headerlink" href="#program-usage" title="Permalink to this heading">¶</a></h1>
<p>EPANET-MSX is distributed in a compressed archive file named
EPANETMSX.ZIP. The contents of this archive are listed in <a class="reference internal" href="#table-files"><span class="std std-numref">Table 3.1</span></a>. The
top level archive folder contains a <em>Readme.txt</em> file that describes the
contents of the archive and procedures for reporting bugs.</p>
<blockquote>
<div></div></blockquote>
<span id="table-files"></span><table class="longtable docutils align-default" id="id3">
<caption><span class="caption-text">Files distributed with EPANET-MSX</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Readme.txt</p></td>
<td><p>describes the contents of the archive</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">\bin</div>
<div class="line-block">
<div class="line">epanetmsx.exe</div>
<div class="line">epanetmsx.dll</div>
<div class="line">epanet2.dll</div>
</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line">command line version of EPANET-MSX</div>
<div class="line">EPANET-MSX function library</div>
<div class="line">standard EPANET function library</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">\Examples</div>
<div class="line-block">
<div class="line">example.inp</div>
<div class="line">example.msx</div>
</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line">example EPANET input file</div>
<div class="line">example MSX input file</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">\Doc</div>
<div class="line-block">
<div class="line">epanetmsx.pdf</div>
<div class="line">license.txt</div>
</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line">EPANET-MSX users manual</div>
<div class="line">licensing agreement for using EPANET-MSX</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">\Include</div>
<div class="line-block">
<div class="line">epanetmsx.h</div>
<div class="line">epanetmsx.bas</div>
<div class="line">epanetmsx.pas</div>
<div class="line">epanet2.h</div>
<div class="line">epanet2.bas</div>
<div class="line">epanet2.pas</div>
<div class="line">epanetmsx.lib</div>
<div class="line">epanet2.lib</div>
</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line">C/C++ header file for EPANET-MSX toolkit</div>
<div class="line">Visual Basic declarations of EPANET-MSX functions</div>
<div class="line">Delphi-Pascal declarations of EPANET-MSX functions</div>
<div class="line">C/C++ header file for EPANET2 toolkit</div>
<div class="line">Visual Basic declarations of EPANET2 functions</div>
<div class="line">Delphi-Pascal declarations of EPANET2 functions</div>
<div class="line">Microsoft C/C++ LIB file for epanetmsx.dll</div>
<div class="line">Microsoft C/C++ LIB file for epanet2.dll</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>\Src</p></td>
<td><p>EPANET-MSX source files</p></td>
</tr>
</tbody>
</table>
<p>Most end users will only need to extract the files in the <em>\bin</em>,
<em>\examples</em>, and <em>\doc</em> folders to a directory of their choosing.
Developers will also need the files in the <em>\include</em> folder to write
custom applications. They should also be aware of the licensing
requirements set forth in the <em>license.txt</em> file.</p>
<p>The EPANET-MSX system is supplied as both:</p>
<ul class="simple">
<li><p>a stand-alone console application (<em>epanetmsx.exe</em>) that can run
standard water quality analyses without any additional programming
effort required,</p></li>
<li><p>a function library (<em>epanetmsx.dll</em>) that, when used in conjunction
with the original EPANET function library (<em>epanet2.dll</em>), can produce
customized programming applications.</p></li>
</ul>
<p>At this point in time the extension has not been integrated into the
Windows version of EPANET. This is expected to happen at some future
date. Examples of each type of usage are provided below.</p>
<p>Regardless of which approach is used, the user must prepare two input
files to run a multi-species analysis. One of these is a standard EPANET
input file that describes the hydraulic characteristics of the network
being analyzed (EPANET-MSX will ignore any water quality information
that might be in this file). The format of this file is described in the
EPANET Users Manual <span id="id1">[<a class="reference internal" href="index.html#id8" title="L. A. Rossman. EPANET 2 Users Manual. U.S. Environmental Protection Agency, Cincinnati, OH, 2000.">Rossman, 2000</a>, <a class="reference internal" href="index.html#id9" title="L. A. Rossman, H. Woo, M. Tryby, F. Shang, R. Janke, and T. Haxton. EPANET 2.2 Users Manual. U.S. Environmental Protection Agency, Cincinnati, OH, 2020.">Rossman <em>et al.</em>, 2020</a>]</span>. Any network file that was created,
edited and then exported from the Windows version of EPANET can serve as
the EPANET input file for the multi-species extension.</p>
<p>The second file that must be prepared is a special EPANET-MSX file that
describes the species being simulated and the chemical
reaction/equilibrium model that governs their dynamics. The format of
this file is described in <a class="reference internal" href="index.html#inputformat"><span class="std std-ref">INPUT FILE FORMAT</span></a> (<a class="reference internal" href="index.html#inputformat"><span class="std std-numref">Section 4</span></a>) of this manual.</p>
<section id="example-command-line-run">
<h2><em>Example Command Line Run</em><a class="headerlink" href="#example-command-line-run" title="Permalink to this heading">¶</a></h2>
<p>In order to demonstrate the use of the command line version of
EPANET-MSX we will simulate the arsenic oxidation/adsorption reaction
system that was briefly described in <a class="reference internal" href="index.html#framework"><span class="std std-ref">CONCEPTUAL FRAMEWORK</span></a> (<a class="reference internal" href="index.html#framework"><span class="std std-numref">Section 2</span></a>) of this manual using the
simple pipe network shown in <a class="reference internal" href="#figure-3-1"><span class="std std-numref">Fig. 3.1</span></a> that was adapted from <span id="id2">Zhang <em>et al.</em> [<a class="reference internal" href="index.html#id16" title="W. Zhang, C. T. Miller, and F. A. DiGiano. Bacterial regrowth model for water distribution systems incorporating alternating split-operator solution technique. Journal of Environmental Engineering, 130:932-941, September 2004.">2004</a>]</span>.
<a class="reference internal" href="#table-3-2"><span class="std std-numref">Table 3.2</span></a> lists the properties associated with the nodes of
this network while <a class="reference internal" href="#table-3-3"><span class="std std-numref">Table 3.3</span></a> does the same for the pipe links.</p>
<figure class="align-default" id="id4">
<span id="figure-3-1"></span><a class="reference internal image-reference" href="_images/image17.png"><img alt="Chart Description automatically generated" src="_images/image17.png" style="width: 4.30037in; height: 1.65014in;" /></a>
<figcaption>
<p><span class="caption-text">Schematic of the example pipe network</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<span id="table-3-2"></span><table class="docutils align-default" id="id5">
<caption><span class="caption-text">Nodal properties of the example pipe network</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 24%" />
<col style="width: 35%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Node</strong></p></th>
<th class="head"><p><strong>Elevation</strong> (<span class="math notranslate nohighlight">\(m\)</span>)</p></th>
<th class="head"><p><strong>Demand</strong> (<span class="math notranslate nohighlight">\(m^3/hr\)</span>)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Source</p></td>
<td><p>100</p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>A</p></td>
<td><p>0</p></td>
<td><p>4.1</p></td>
</tr>
<tr class="row-even"><td><p>B</p></td>
<td><p>0</p></td>
<td><p>3.4</p></td>
</tr>
<tr class="row-odd"><td><p>C</p></td>
<td><p>0</p></td>
<td><p>5.5</p></td>
</tr>
<tr class="row-even"><td><p>D</p></td>
<td><p>0</p></td>
<td><p>2.3</p></td>
</tr>
</tbody>
</table>
<span id="table-3-3"></span><table class="docutils align-default" id="id6">
<caption><span class="caption-text">Pipe properties of the example pipe network</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 28%" />
<col style="width: 37%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Pipe</strong></p></th>
<th class="head"><p><strong>Length</strong> (<span class="math notranslate nohighlight">\(m\)</span>)</p></th>
<th class="head"><p><strong>Diameter</strong> (<span class="math notranslate nohighlight">\(mm\)</span>)</p></th>
<th class="head"><p><strong>C-Factor</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>1000</p></td>
<td><p>200</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>800</p></td>
<td><p>150</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>1200</p></td>
<td><p>200</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>1000</p></td>
<td><p>150</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>2000</p></td>
<td><p>150</p></td>
<td><p>100</p></td>
</tr>
</tbody>
</table>
<p>The first step in running a multi-species analysis of a water
distribution system is to prepare a standard EPANET input file of the
system that contains all of the information needed to perform a
hydraulic analysis of the system. The Windows version of EPANET 2 was
used to draw the network layout and assign node and pipe attributes
using the program’s graphical editing tools. A standard .INP file was
then created by issuing the <strong>File | Export | Network</strong> command. The
resulting file was named <em>example.inp</em> and is shown in <a class="reference internal" href="#ex-input-file"><span class="std std-numref">Listing 3.1</span></a> (after
some editing was performed to remove empty sections and default
options). Note that for this simple application the water demands remain
constant over time and that a 48 hour simulation period is requested.</p>
<div class="literal-block-wrapper docutils container" id="ex-input-file">
<div class="code-block-caption"><span class="caption-text">Contents of the <em>example.inp</em> input file.</span><a class="headerlink" href="#ex-input-file" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[TITLE]
EPANET-MSX Example Network

[JUNCTIONS]
;ID    Elev  Demand  Pattern
 A     0     4.1
 B     0     3.4
 C     0     5.5
 D     0     2.3

[RESERVOIRS]
;ID      Head  Pattern
 Source  100

[PIPES]
;ID   Node1   Node2  Length  Diameter  Roughness
 1    Source  A      1000    200       100
 2    A       B      800     150       100
 3    A       C      1200    200       100
 4    B       C      1000    150       100
 5    C       D      2000    150       100

[TIMES]
 Duration           	48
 Hydraulic Timestep 	1:00
 Quality Timestep   	0:05
 Report Timestep    	2
 Report Start       	0
 Statistic          	NONE

[OPTIONS]
 Units              	CMH
 Headloss           	H-W
 Quality            	NONE
</pre></div>
</div>
</div>
<p>The next step is to prepare the MSX input file that defines the
individual water quality species of interest and the reaction
expressions that govern their dynamics. This was done using a text
editor, following the format described in <a class="reference internal" href="index.html#inputformat"><span class="std std-ref">INPUT FILE FORMAT</span></a> (<a class="reference internal" href="index.html#inputformat"><span class="std std-numref">Section 4</span></a>) of this manual. The
resulting MSX input file, named <em>example.msx</em>, is shown in <a class="reference internal" href="#ex-msx-file"><span class="std std-numref">Listing 3.2</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="ex-msx-file">
<div class="code-block-caption"><span class="caption-text">Contents of the <em>example.msx</em> input file.</span><a class="headerlink" href="#ex-msx-file" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[TITLE]
Arsenic Oxidation/Adsorption Example

[OPTIONS]
  AREA_UNITS M2             ;Surface concentration is mass/m2
  RATE_UNITS HR             ;Reaction rates are concentration/hour
  SOLVER     RK5            ;5-th order Runge-Kutta integrator
  TIMESTEP   360            ;360 sec (5 min) solution time step
  RTOL       0.001          ;Relative concentration tolerance
  ATOL       0.0001         ;Absolute concentration tolerance

[SPECIES]
  BULK AS3   UG             ;Dissolved arsenite
  BULK AS5   UG             ;Dissolved arsenate
  BULK AStot UG             ;Total dissolved arsenic
  WALL AS5s  UG             ;Adsorbed arsenate
  BULK NH2CL MG             ;Monochloramine

[COEFFICIENTS]
  CONSTANT Ka   10.0        ;Arsenite oxidation rate coefficient
  CONSTANT Kb   0.1         ;Monochloramine decay rate coefficient
  CONSTANT K1   5.0         ;Arsenate adsorption coefficient
  CONSTANT K2   1.0         ;Arsenate desorption coefficient
  CONSTANT Smax 50          ;Arsenate adsorption saturation limit

[TERMS]
  Ks       K1/K2            ;Equil. adsorption coeff.

[PIPES]
  ;Arsenite oxidation
  RATE    AS3    -Ka*AS3*NH2CL
  ;Arsenate production
  RATE    AS5    Ka*AS3*NH2CL - Av*(K1*(Smax-AS5s)*AS5 - K2*AS5s)
  ;Monochloramine decay
  RATE    NH2CL  -Kb*NH2CL
  ;Arsenate adsorption
  EQUIL   AS5s   Ks*Smax*AS5/(1+Ks*AS5) - AS5s
  ;Total bulk arsenic
  FORMULA AStot  AS3 + AS5

[TANKS]
  RATE    AS3    -Ka*AS3*NH2CL
  RATE    AS5    Ka*AS3*NH2CL
  RATE    NH2CL  -Kb*NH2CL
  FORMULA AStot  AS3 + AS5

[QUALITY]
  ;Initial conditions (= 0 if not specified here)
  NODE    Source AS3   10.0
  NODE    Source NH2CL 2.5

[REPORT]
  NODES   C   D                ;Report results for nodes C and D
  LINKS   5                    ;Report results for pipe 5
  SPECIE  AStot YES            ;Report results for each specie
  SPECIE  AS5   YES
  SPECIE  AS5s  YES
  SPECIE  NH2CL YES
</pre></div>
</div>
</div>
<p>There are several things of note in this file:</p>
<ol class="arabic">
<li><p>The species have been named as follows:</p>
<ul class="simple">
<li><p>AS3 is dissolved arsenite (<span class="math notranslate nohighlight">\(As^{+3}\)</span>), expressed in <span class="math notranslate nohighlight">\(\mu g/L\)</span></p></li>
<li><p>AS5 is dissolved arsenate (<span class="math notranslate nohighlight">\(As^{+5}\)</span>), expressed in <span class="math notranslate nohighlight">\(\mu g/L\)</span></p></li>
<li><p>AStot is total dissolved arsenic expressed in <span class="math notranslate nohighlight">\(\mu g/L\)</span></p></li>
<li><p>AS5s is adsorbed arsenate, expressed in <span class="math notranslate nohighlight">\(\mu g/m^2\)</span></p></li>
<li><p>NH2CL is dissolved monochloramine, expressed in <span class="math notranslate nohighlight">\(mg/L\)</span></p></li>
</ul>
</li>
<li><p>The reaction rate coefficients, Ka and Kb, and the adsorption
coefficients, <span class="math notranslate nohighlight">\(K_1\)</span>, <span class="math notranslate nohighlight">\(K_2\)</span>, and <span class="math notranslate nohighlight">\(S_{max}\)</span>, have been designated as constants. If
instead they varied by pipe, then they could have been declared as
parameters and their values could have been adjusted on a
pipe-specific basis in the [PARAMETERS] section of the file. Note
that the units of these coefficients are as follows: <span class="math notranslate nohighlight">\((L/mg\text{-}hr)\)</span> for
<span class="math notranslate nohighlight">\(K_a\)</span>; <span class="math notranslate nohighlight">\((1/hr)\)</span> for <span class="math notranslate nohighlight">\(K_b\)</span>, <span class="math notranslate nohighlight">\((L/\mu g\text{-}hr)\)</span> for <span class="math notranslate nohighlight">\(K_1\)</span>; <span class="math notranslate nohighlight">\((1/hr)\)</span> for <span class="math notranslate nohighlight">\(K_2\)</span>; <span class="math notranslate nohighlight">\(\mu g/m^2\)</span>
for <span class="math notranslate nohighlight">\(S_{max}\)</span>.</p></li>
<li><p>The [PIPES] section supplies the three reaction rate expressions and
the single equilibrium expression for this system as was presented
previously in equations <a class="reference internal" href="index.html#equation-as3">(2.8)</a> - <a class="reference internal" href="index.html#equation-as5s">(2.11)</a> of <a class="reference internal" href="index.html#framework"><span class="std std-ref">CONCEPTUAL FRAMEWORK</span></a> (<a class="reference internal" href="index.html#framework"><span class="std std-numref">Section 2</span></a>). For example, the rate
expression for arsenite oxidation</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
{d As^{+3} \over d {t}} = -k_a As^{+3}(NH_2Cl)
\end{aligned}\]</div>
<p>is expressed in the file as:</p>
<blockquote>
<div><p>RATE  <span class="math notranslate nohighlight">\(\ \)</span> As3 <span class="math notranslate nohighlight">\(\ \)</span> -Ka*As3*NH2CL</p>
</div></blockquote>
<p>while the equilibrium expression</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
As_s^{+5}={{k_s S_{max} As^{+5}} \over {1+k_s As^{+5}}}
\end{aligned}\]</div>
<p>is re-written so that it has an implied 0 on the left hand side:</p>
<blockquote>
<div><p>EQUIL  <span class="math notranslate nohighlight">\(\ \)</span> As5s <span class="math notranslate nohighlight">\(\ \)</span>  Ks*Smax*As5/(1 + Ks*As5) - As5s</p>
</div></blockquote>
</li>
<li><p>The variable Av that appears in the rate expression for AS5 is a
reserved symbol for the pipe wall surface area per unit of pipe
volume. It is computed internally by EPANET-MSX and has units of area
per liter, where the area units are the same as those specified in
the [OPTIONS] section of the file.</p></li>
<li><p>Even though there are no tanks in this example, a [TANKS] section is
still needed in the MSX file because both BULK and WALL species have
been defined (Tank water quality reactions can not use wall species,
which are associated only with pipes). If only BULK species were
present then a redundant [TANKS] section would not be required.</p></li>
<li><p>An initial quality is assigned to the source reservoir which remains
constant over the course of the simulation. If source quality was to
vary over time or there were source injections at other locations
they could be described in a [SOURCES] section.</p></li>
<li><p>In the [REPORT] section we ask that results for all species at nodes
C and D and link 5 be written to the report file.</p></li>
</ol>
<p>The final step in analyzing arsenic oxidation/adsorption for our example
network is to run the EPANET-MSX command line executable. This can be
done by first opening a Command Prompt window in Windows, navigating to
the folder where <em>epanetmsx.exe</em> and the input files were saved, and
issuing the following command:</p>
<p><em>epanetmsx example.inp example.msx example.rpt</em></p>
<p>where <em>example.rpt</em> is the name of the file where the results will be
written. If the executable were saved to a different folder than that of
the example files, then either the full path name would have to be added
to the name of the executable on the command line or the folder name
would have to be added to the user’s PATH environment variable. <a class="reference internal" href="#figure-3-2"><span class="std std-numref">Fig. 3.2</span></a> is a screen capture of what appears on the screen as the program
runs.</p>
<figure class="align-default" id="id7">
<span id="figure-3-2"></span><a class="reference internal image-reference" href="_images/image20_22.png"><img alt="_images/image20_22.png" src="_images/image20_22.png" style="width: 661.0px; height: 401.0px;" /></a>
<figcaption>
<p><span class="caption-text">Command line execution of EPANET-MSX.</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p id="section-6">After the program finishes, the <em>example.rpt</em> file can be opened in any
text editor (such as Windows Notepad) where its contents can be viewed.
Excerpts from the results file are reproduced in <a class="reference internal" href="#ex-rpt-file"><span class="std std-numref">Listing 3.3</span></a>. The first
page contains a summary of the standard EPANET options that were chosen
for the run. Following this is a table of results for each node and each
link. These tables contain the concentrations of each species at each
reporting period. Note that the surface species are not listed for nodes
since by definition this class of constituent is associated only with
pipe surfaces. At the end of the report file, the mass balance summaries of the three differential variables (<span class="math notranslate nohighlight">\(As^{+3}\)</span>, :<span class="math notranslate nohighlight">\(As^{+5}\)</span> and <span class="math notranslate nohighlight">\(NH_2Cl\)</span>) are provided.</p>
<div class="literal-block-wrapper docutils container" id="ex-rpt-file">
<div class="code-block-caption"><span class="caption-text">EPANET-MSX results for the example network</span><a class="headerlink" href="#ex-rpt-file" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Page 1                                    Thu Jun 23 14:17:29 2022

  ******************************************************************
  *                           E P A N E T                          *
  *                   Hydraulic and Water Quality                  *
  *                   Analysis for Pipe Networks                   *
  *                         Version 2.2                            *
  ******************************************************************
  
  EPANET-MSX Example Network
   
      Input Data File ................... example.inp
      Number of Junctions................ 4
      Number of Reservoirs............... 1
      Number of Tanks ................... 0
      Number of Pipes ................... 5
      Number of Pumps ................... 0
      Number of Valves .................. 0
      Headloss Formula .................. Hazen-Williams
      Nodal Demand Model ................ DDA
      Hydraulic Timestep ................ 1.00 hrs
      Hydraulic Accuracy ................ 0.001000
      Status Check Frequency ............ 2
      Maximum Trials Checked ............ 10
      Damping Limit Threshold ........... 0.000000
      Maximum Trials .................... 200
      Quality Analysis .................. None
      Specific Gravity .................. 1.00
      Relative Kinematic Viscosity ...... 1.00
      Relative Chemical Diffusivity ..... 1.00
      Demand Multiplier ................. 1.00
      Total Duration .................... 48.00 hrs
      Reporting Criteria:
         No Nodes
         No Links
   
  Analysis begun Thu Jun 23 14:17:29 2022

  Processing MSX input file example.msx
  
  
Page 1                                               EPANET-MSX 2.0.0
  
  ******************************************************************
  *                      E P A N E T  -  M S X                     *
  *                   Multi-Species Water Quality                  *
  *                   Analysis for Pipe  Networks                  *
  *                           Version 2.0.0                        *
  ******************************************************************
  
  Arsenic Oxidation/Adsorption Example

  
  &lt;&lt;&lt; Node C &gt;&gt;&gt;
  
  Time            AS5       AStot       NH2CL
  hr:min         UG/L        UG/L        MG/L
  -------  ----------  ----------  ----------
     0:00        0.00        0.00        0.00
     2:00        0.00        0.00        0.00
     4:00        0.00        0.00        0.00
     6:00        0.00        0.00        0.00
     8:00        0.00        0.00        1.10
    10:00        9.17        9.17        1.10
    12:00        9.17        9.17        1.10
    14:00        9.17        9.17        1.10
    16:00        9.17        9.17        1.10
    18:00        9.17        9.17        1.10
    20:00        9.17        9.17        1.10
    22:00        9.17        9.17        1.10
    24:00        9.17        9.17        1.10
    26:00        9.17        9.17        1.10
    28:00        9.17        9.17        1.10
    30:00        9.17        9.17        1.10
    32:00        9.17        9.17        1.10
    34:00        9.17        9.17        1.11
    36:00        9.17        9.17        1.11
    38:00       10.03       10.03        1.11
    40:00       10.03       10.03        1.11
    42:00       10.03       10.03        1.11
    44:00       10.03       10.03        1.11
    46:00       10.03       10.03        1.11
    48:00       10.03       10.03        1.11
  
  &lt;&lt;&lt; Node D &gt;&gt;&gt;
  
  Time            AS5       AStot       NH2CL
  hr:min         UG/L        UG/L        MG/L
  -------  ----------  ----------  ----------
     0:00        0.00        0.00        0.00
     2:00        0.00        0.00        0.00
     4:00        0.00        0.00        0.00
     6:00        0.00        0.00        0.00
     8:00        0.00        0.00        0.00
    10:00        0.00        0.00        0.00
    12:00        0.00        0.00        0.00
    14:00        0.00        0.00        0.00
    16:00        0.00        0.00        0.00
    18:00        0.00        0.00        0.00
    20:00        0.00        0.00        0.00
    22:00        0.00        0.00        0.00
    24:00        0.00        0.00        0.24
    26:00        0.00        0.00        0.24
    28:00        9.17        9.17        0.24
    30:00        9.17        9.17        0.24
    32:00        9.17        9.17        0.24
    34:00        9.17        9.17        0.24
    36:00        9.17        9.17        0.24
    38:00        9.17        9.17        0.24
    40:00        9.17        9.17        0.24
    42:00        9.17        9.17        0.24
    44:00        9.17        9.17        0.24
    46:00        9.17        9.17        0.24
    48:00        9.17        9.17        0.24
  
  &lt;&lt;&lt; Link 5 &gt;&gt;&gt;
  
  Time            AS5       AStot        AS5s       NH2CL
  hr:min         UG/L        UG/L       UG/M2        MG/L
  -------  ----------  ----------  ----------  ----------
     0:00        0.00        0.00       -0.00        0.00
     2:00        0.00        0.00        0.00        0.00
     4:00        0.00        0.00        0.00        0.00
     6:00        0.00        0.00        0.00        0.00
     8:00        0.00        0.00        0.00        0.05
    10:00        0.85        0.85        4.51        0.17
    12:00        1.86        1.86        9.88        0.27
    14:00        2.87        2.87       15.27        0.35
    16:00        3.87        3.87       20.64        0.42
    18:00        4.88        4.88       26.02        0.47
    20:00        5.89        5.89       31.39        0.52
    22:00        6.89        6.89       36.75        0.55
    24:00        7.90        7.90       42.12        0.56
    26:00        8.91        8.91       47.50        0.56
    28:00        9.17        9.17       48.93        0.56
    30:00        9.17        9.17       48.93        0.56
    32:00        9.17        9.17       48.93        0.56
    34:00        9.17        9.17       48.93        0.56
    36:00        9.17        9.17       48.93        0.57
    38:00        9.19        9.19       48.93        0.57
    40:00        9.30        9.30       48.95        0.57
    42:00        9.41        9.41       48.96        0.57
    44:00        9.52        9.52       48.97        0.57
    46:00        9.64        9.64       48.98        0.57
    48:00        9.75        9.75       48.99        0.57
  

  Water Quality Mass Balance: AS3 (UG)
  ================================
  Initial Mass:       0.00000e+00
  Mass Inflow:        7.34409e+06
  Mass Outflow:       5.15609e-11
  Mass Reacted:      -7.32740e+06
  Final Mass:         1.66911e+04
  Mass Ratio:         1.00000
  ================================

  

  Water Quality Mass Balance: AS5 (UG)
  ================================
  Initial Mass:       0.00000e+00
  Mass Inflow:        0.00000e+00
  Mass Outflow:       5.79736e+06
  Mass Reacted:       7.13763e+06
  Final Mass:         1.34027e+06
  Mass Ratio:         1.00000
  ================================

  

  Water Quality Mass Balance: NH2CL (MG)
  ================================
  Initial Mass:       0.00000e+00
  Mass Inflow:        1.83602e+06
  Mass Outflow:       8.51117e+05
  Mass Reacted:      -8.00156e+05
  Final Mass:         1.84749e+05
  Mass Ratio:         1.00000
  ================================

  
  Analysis ended Thu Jun 23 14:17:30 2022
</pre></div>
</div>
</div>
</section>
<section id="example-toolkit-usage">
<h2><em>Example Toolkit Usage</em><a class="headerlink" href="#example-toolkit-usage" title="Permalink to this heading">¶</a></h2>
<p>Using the EPANET-MSX function library requires some programming effort
to build custom applications and must be used in conjunction with the
standard EPANET Programmer’s Toolkit. Applications can be written in any
programming language that can call external functions residing in a
Windows DLL (or a Linux shared object library), such as C, C++, Visual
Basic, and Delphi Pascal. Section <a class="reference internal" href="index.html#sectoolkit"><span class="std std-ref">MSX TOOLKIT FUNCTIONS</span></a> describes each function included in
the MSX toolkit library. The functions in the EPANET toolkit library are
described in the Help file distributed with that toolkit (available at <a class="reference external" href="https://www.epa.gov/water-research/epanet">https://www.epa.gov/water-research/epanet</a>).</p>
<p>As an example of how the library can be used to construct an
application, <a class="reference internal" href="#ex-source-file"><span class="std std-numref">Listing 3.4</span></a> displays the C code behind the command line
implementation of the MSX system, <em>epanetmsx.exe,</em> which was just
discussed. The listing begins by checking for the correct number of
command line arguments and then attempts to open and read the EPANET
file supplied as the first argument. It uses the EPANET toolkit function
<em>ENopen</em> for this purpose.</p>
<p>The code then begins a <em>do-while</em> loop that simplifies error detection
through the remainder of the program. The <em>MSXopen</em> function is used to
open and process the MSX file (the second command line argument), and
the <em>MSXsolveH</em> function is used to run a hydraulic analysis of the
network whose results are saved to a scratch file. This is followed by a
call to <em>MSXinit</em> to initialize the water quality analysis. Note that
the argument of 1 to this function tells the MSX system to save its
computed water quality results to a scratch file so that they can be
used for reporting purposes later on.</p>
<p>The program then begins another <em>do-while</em> loop that will step through
each water quality time step. At each such step, the <em>MSXstep</em> function
is called to update water quality throughout the network and save these
results to the scratch output file. This function also updates the
amount of time left in the simulation (stored in the variable named
<em>tleft</em>). The loop continues until either no more time is left or an
error condition is encountered.</p>
<p>If the simulation ends successfully, the <em>MSXreport</em> function is called
to write the water quality results to the report file that was named on
the command line. If a fourth file name was supplied on the command
line, then the <em>MSXsaveoutfile</em> is called to save the results in a
binary format to this file. Lastly, the MSX system is closed down by
calling <em>MSXclose</em> and the same is done for the EPANET system by calling
<em>ENclose</em>.</p>
<p>If the source code in <a class="reference internal" href="#ex-source-file"><span class="std std-numref">Listing 3.4</span></a> was saved to a file named <em>msxepanet.c</em>
then it could be compiled into an executable named <em>epanetmsx.exe</em> by
using the following commands with the Microsoft C/C++ command line
compiler:</p>
<p><em>CL  /c  epanetmsx.c</em></p>
<p><em>LINK  epanetmsx.obj  epanet2.lib  epanetmsx.lib  /OUT:epanetmsx.exe</em></p>
<p>Note that when developing MSX applications in C/C++, the library modules
<em>epanet2.lib</em> and <em>epanetmsx.lib</em> must be linked in with the
application’s object modules. Versions of these files that are
compatible with the Microsoft C/C++ compiler (Version 6 and higher) are
supplied with the EPANET-MSX distribution. Also, copies of the
distributed DLL files <em>epanet2.dll</em> and <em>epanetmsx.dll</em> must be placed in
the same directory as the application’s executable file or reside in a
directory listed the user’s PATH environment variable.</p>
<p>Users using other compilers or platforms would need to use the
appropriate commands to produce the required object library files and
executables.</p>
<div class="literal-block-wrapper docutils container" id="ex-source-file">
<div class="code-block-caption"><span class="caption-text">C source code for the command line version of EPANET-MSX</span><a class="headerlink" href="#ex-source-file" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//  EPANETMSX.C  -- Command line implementation of EPANET-MSX</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;epanet2.h&quot;</span><span class="c1">                   // EPANET toolkit header file</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;epanetmsx.h&quot;</span><span class="c1">                 // EPANET-MSX toolkit header file</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"></span>
<span class="cm">/*</span>
<span class="cm">**  Purpose:</span>
<span class="cm">**    runs a multi-species EPANET analysis</span>
<span class="cm">**</span>
<span class="cm">**  Input:</span>
<span class="cm">**    argc = number of command line arguments</span>
<span class="cm">**    argv = array of command line arguments.</span>
<span class="cm">**</span>
<span class="cm">**  Returns:</span>
<span class="cm">**    an error code (or 0 for no error).</span>
<span class="cm">**</span>
<span class="cm">**  Notes:</span>
<span class="cm">**    The command line arguments are:</span>
<span class="cm">**     - the name of a regular EPANET input data file</span>
<span class="cm">**     - the name of a EPANET-MSX input file</span>
<span class="cm">**     - the name of a report file that will contain status</span>
<span class="cm">**       messages and output results</span>
<span class="cm">**     - optionally, the name of an output file that will</span>
<span class="cm">**       contain water quality results in binary format.</span>
<span class="cm">*/</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w">    </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">long</span><span class="w">   </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">tleft</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">long</span><span class="w">   </span><span class="n">oldHour</span><span class="p">,</span><span class="w"> </span><span class="n">newHour</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// --- Check command line arguments</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> Too few command line arguments.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// --- Open the EPANET file</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">... EPANET-MSX Version 1.0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">  o Processing EPANET input file&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">... Cannot read EPANET file; error code = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">ENclose</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ---  Begin an error detection loop</span>

<span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="c1">// --- Open the MSX input file</span>

<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">  o Processing MSX input file&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">... Cannot read MSX file; error code = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// --- Solve hydraulics</span>

<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">  o Computing network hydraulics&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXsolveH</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">... Cannot obtain network hydraulics; error code = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// --- Initialize the multi-species analysis</span>

<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">  o Initializing network water quality&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXinit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">... Cannot initialize EPANET-MSX; error code = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">oldHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">newHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// --- Repeat for each time step</span>

<span class="w">        </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="c1">// --- Report current progress</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oldHour</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">newHour</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">  o Computing water quality at hour %-4d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">newHour</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">oldHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newHour</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="c1">// --- Compute water quality</span>
<span class="w">            </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXstep</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tleft</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">newHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3600</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">err</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tleft</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// --- Report any runtime error</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">... EPANET-MSX runtime error; error code = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">  o Computing water quality at hour %-4d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3600</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// --- Report results</span>

<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">  o Reporting water quality results&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXreport</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">... MSX report writer error; error code = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// --- Save results to binary file if a file name was provided</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXsaveoutfile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="w">                    </span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">... Cannot save MSX results file; error code = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// --- End of error detection loop</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">done</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// --- Close both the multi-species &amp; EPANET systems</span>

<span class="w">    </span><span class="n">MSXclose</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">ENclose</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">... EPANET-MSX completed successfully.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
<section id="using-compiled-reaction-models">
<h2><em>Using Compiled Reaction Models</em><a class="headerlink" href="#using-compiled-reaction-models" title="Permalink to this heading">¶</a></h2>
<p>EPANET-MSX has the option to compile the chemical reaction equations that a user specifies within their MSX input
file using a C compiler that already resides on the user’s system. This can speed up execution times by a factor of 2 to 5,
depending on the nature of the reaction system and the choice of integration method. This option is available on Windows
operating systems that have either the Microsoft Visual C++ compiler or the MinGW port of the Gnu C++ compiler installed,
or on Linux systems with the Gnu C++ compiler. To utilize this option, one adds the following command to the <a class="reference internal" href="index.html#options"><span class="std std-ref">[OPTIONS]</span></a> (<a class="reference internal" href="index.html#options"><span class="std std-numref">Section 4.2</span></a>)
section of the MSX input file:</p>
<p><strong>COMPILER</strong> choice</p>
<p>where choice is <strong>VC</strong> for the Visual C++ compiler, <strong>GC</strong> for the MinGW or Gnu C++ compilers, or <strong>NONE</strong> for no compiler
(the default compiler option). You can determine if your Windows system already has one of these compilers installed
by opening a Command Prompt window and issuing the command CL for the Visual C++ compiler or gcc for the MinGW compiler.
If the system responds with a message saying that the command is not recognized, then the compiler is either not installed
or has not been configured for general use.</p>
<p>The Gnu compiler comes standard with most Linux installations.</p>
</section>
</section>
<span id="document-4_inputformat"></span><section id="input-file-format">
<span id="inputformat"></span><h1>INPUT FILE FORMAT<a class="headerlink" href="#input-file-format" title="Permalink to this heading">¶</a></h1>
<p>The input file used by EPANET-MSX to describe the species and reaction
system being modeled is organized into sections, where each section
begins with a keyword enclosed in brackets. The various section keywords
are listed in <a class="reference internal" href="#table-input"><span class="std std-numref">Table 4.1</span></a>. <a class="reference internal" href="#ex-template-inp"><span class="std std-numref">Listing 4.1</span></a> contains a template of what the
input file layout looks like.</p>
<span id="table-input"></span><table class="docutils align-default" id="id14">
<caption><span class="caption-text">EPANET-MSX input file section keywords</span><a class="headerlink" href="#id14" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>[TITLE]</strong></p></td>
<td><p>adds a descriptive title to the data set</p></td>
</tr>
<tr class="row-even"><td><p><strong>[OPTIONS]</strong></p></td>
<td><p>sets the values of computational options</p></td>
</tr>
<tr class="row-odd"><td><p><strong>[SPECIES]</strong></p></td>
<td><p>names the chemical species being analyzed</p></td>
</tr>
<tr class="row-even"><td><p><strong>[COEFFICIENTS]</strong></p></td>
<td><p>names the parameters and constants used in
chemical rate and equilibrium expressions</p></td>
</tr>
<tr class="row-odd"><td><p><strong>[TERMS]</strong></p></td>
<td><p>defines intermediate terms used in chemical rate
and equilibrium expressions</p></td>
</tr>
<tr class="row-even"><td><p><strong>[PIPES]</strong></p></td>
<td><p>supplies the rate and equilibrium expressions that
govern species dynamics in pipes</p></td>
</tr>
<tr class="row-odd"><td><p><strong>[TANKS]</strong></p></td>
<td><p>supplies the rate and equilibrium expressions that
govern species dynamics in storage tanks</p></td>
</tr>
<tr class="row-even"><td><p><strong>[SOURCES]</strong></p></td>
<td><p>identifies input sources (i.e., boundary
conditions) for selected species</p></td>
</tr>
<tr class="row-odd"><td><p><strong>[QUALITY]</strong></p></td>
<td><p>supplies initial conditions for selected species
throughout the network</p></td>
</tr>
<tr class="row-even"><td><p><strong>[PARAMETERS]</strong></p></td>
<td><p>allows parameter values to be assigned on a pipe
by pipe basis</p></td>
</tr>
<tr class="row-odd"><td><p><strong>[DISPERSION]</strong></p></td>
<td><p>specifies the relative molecular diffusivity of
bulk species</p></td>
</tr>
<tr class="row-even"><td><p><strong>[PATTERNS]</strong></p></td>
<td><p>defines time patterns used with input sources</p></td>
</tr>
<tr class="row-odd"><td><p><strong>[REPORT]</strong></p></td>
<td><p>specifies reporting options</p></td>
</tr>
</tbody>
</table>
<p>Each section can contain any number of lines of data and appear in any
order. Blank lines can appear anywhere in the file and the semicolon (;)
can be used to indicate what follows on the line is a comment, not data.
A maximum of 1024 characters can appear on a line. The ID labels used to
identify objects can be any combination of characters and numbers that
do not contain square brackets ([]), double quotes or a semicolon.</p>
<p>On the pages that follow the contents and formats of each input file
section are described in the order shown above. Reserved keywords are
shown in bold and option choices are separated by slashes.</p>
<div class="literal-block-wrapper docutils container" id="ex-template-inp">
<div class="code-block-caption"><span class="caption-text">EPANET-MSX input file template</span><a class="headerlink" href="#ex-template-inp" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[TITLE]
  &lt;title line&gt;

[OPTIONS]
 AREA_UNITS  FT2/M2/CM2
 TIME_UNITS  SEC/MIN/HR/DAY
 SOLVER      EUL/RK5/ROS2
 COUPLING    FULL/NONE	
 TIMESTEP    &lt;seconds&gt;
 ATOL        &lt;value&gt;
 RTOL        &lt;value&gt;
 COMPILER    VC/GC/NONE
 SEGMENTS    &lt;value&gt;
 PECLET      &lt;value&gt;

[SPECIES]
 BULK        &lt;specieID&gt;    &lt;units&gt;    (&lt;atol&gt;  &lt;rtol&gt;)
 WALL        &lt;specieID&gt;    &lt;units&gt;    (&lt;atol&gt;  &lt;rtol&gt;)

[COEFFICIENTS]
 PARAMETER   &lt;paramID&gt;     &lt;value&gt;
 CONSTANT    &lt;constID&gt;     &lt;value&gt;

[TERMS]
 &lt;termID&gt;    &lt;expression&gt;

[PIPES] or [TANKS]
 EQUIL       &lt;specieID&gt;    &lt;expression&gt;
 RATE        &lt;specieID&gt;    &lt;expression&gt;
 FORMULA     &lt;specieID&gt;    &lt;expression&gt;

[SOURCES]
 &lt;type&gt;   &lt;nodeID&gt;    &lt;specieID&gt;    &lt;strength&gt;    (&lt;patternID&gt;)

[QUALITY]
 GLOBAL     &lt;specieID&gt;    &lt;value&gt;
 NODE       &lt;nodeID&gt;      &lt;bulkSpecieID&gt;    &lt;value&gt;
 LINK       &lt;linkID&gt;      &lt;wallSpecieID&gt;    &lt;value&gt;

[PARAMETERS]
 PIPE         &lt;pipeID&gt;  &lt;paramID&gt; &lt;value&gt;
 TANK         &lt;tankID&gt;  &lt;paramID&gt; &lt;value&gt;

[DISPERSION]
 &lt;specieID&gt;   &lt;value&gt;

[PATTERNS]
 &lt;patternID&gt;  &lt;multiplier&gt;  &lt;multiplier&gt; ...

[REPORT]
 NODES      ALL
 NODES      &lt;node1ID&gt;     &lt;node2ID&gt;  ...
 LINKS      ALL
 LINKS      &lt;link1ID&gt;     &lt;link2ID&gt;  ...
 SPECIES    &lt;speciesID&gt;   YES/NO  (&lt;precision&gt;)
 FILE       &lt;filename&gt;
 PAGESIZE   &lt;lines&gt;
</pre></div>
</div>
</div>
<section id="title">
<span id="id1"></span><h2><strong>[TITLE]</strong><a class="headerlink" href="#title" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Attaches a descriptive title to the problem being analyzed.</p>
</div></blockquote>
<p><strong>Format:</strong></p>
<blockquote>
<div><p>A single line of text.</p>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><p>The <strong>[TITLE]</strong> section is optional.</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="options">
<span id="id2"></span><h2><strong>[OPTIONS]</strong><a class="headerlink" href="#options" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Defines various simulation options.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><strong>AREA_UNITS</strong> <span class="math notranslate nohighlight">\(\ \;\;\)</span> <strong>FT2/M2/CM2</strong></p>
<p><strong>TIME_UNITS</strong> <span class="math notranslate nohighlight">\(\ \ \ \)</span> <strong>SEC/MIN/HR/DAY</strong></p>
<p><strong>SOLVER</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \ \ \ \ \;\)</span> <strong>EUL/RK5/ROS2</strong></p>
<p><strong>COUPLING</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \;\;\)</span> <strong>FULL/NONE</strong></p>
<p><strong>TIMESTEP</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \;\)</span> <em>seconds</em></p>
<p><strong>ATOL</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \ \ \ \ \ \ \ \;\)</span> <em>value</em></p>
<p><strong>RTOL</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \ \ \ \ \ \ \ \;\)</span> <em>value</em></p>
<p><strong>COMPILER</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \;\)</span> <strong>NONE/VC/GC</strong></p>
<p><strong>SEGMENTS</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \;\)</span> <em>value</em></p>
<p><strong>PECLET</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \ \ \ \ \;\)</span> <em>value</em></p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><p><strong>AREA_UNITS</strong> sets the units used to express pipe wall surface area where:</p>
<blockquote>
<div><p><strong>FT2</strong> = square feet</p>
<p><strong>M2</strong> <span class="math notranslate nohighlight">\(\ \)</span> = square meters</p>
<p><strong>CM2</strong> = square centimeters</p>
<p>The default is <strong>FT2</strong>.</p>
</div></blockquote>
<p><strong>TIME_UNITS</strong> is the units in which all reaction rate terms are expressed. The default units are hours (<strong>HR</strong>).</p>
<p><strong>SOLVER</strong> is the choice of numerical integration method used to solve the reaction system where:</p>
<blockquote>
<div><p><strong>EUL</strong> <span class="math notranslate nohighlight">\(\ \)</span> = standard Euler integrator</p>
<p><strong>RK5</strong> <span class="math notranslate nohighlight">\(\ \)</span> = Runge-Kutta 5<sup>th</sup> order integrator</p>
<p><strong>ROS2</strong> = 2<sup>nd</sup> order Rosenbrock integrator.</p>
<p>The default solver is <strong>EUL</strong>.</p>
</div></blockquote>
<p><strong>COUPLING</strong> determines to what degree the solution of any algebraic equilibrium equations is coupled to the integration of the reaction rate equations. If coupling is <strong>NONE</strong> then the solution to the algebraic equations is only updated at the end of each integration time step. With <strong>FULL</strong> coupling the updating is done whenever a new set of values for the rate-dependent variables in the reaction rate expressions is computed. This can occur at several intermediate times during the normal integration time step when using the <strong>RK5</strong> and <strong>ROS2</strong> integration methods. Thus the <strong>FULL</strong> coupling option is more accurate, but can require significantly more computation time. The default is <strong>NONE</strong>.</p>
<p><strong>TIMESTEP</strong> is the time step, in seconds, used to integrate the reaction system. The default time step is 300 seconds (5 minutes).</p>
<p><strong>ATOL</strong> is the default absolute tolerance used to determine when two concentration levels of a species are the same. It applies to all species included in the model. Different values for individual species can be set in the <a class="reference internal" href="#species"><span class="std std-ref">[SPECIES]</span></a> section of the input (see below). If no <strong>ATOL</strong> option is specified then it defaults to 0.01 (regardless of species concentration units).</p>
<p><strong>RTOL</strong> is the default relative accuracy level on a species’ concentration used to adjust time steps in the <strong>RK5</strong> and <strong>ROS2</strong> integration methods. It applies to all species included in the model. Different values for individual species can be set in the <a class="reference internal" href="#species"><span class="std std-ref">[SPECIES]</span></a> section of the input (see below). If no <strong>RTOL</strong> option is specified then it defaults to 0.001.</p>
<p><strong>COMPILER</strong> determines if the chemical reaction system being modeled should first be compiled before the simulation begins.
This option is available on Windows systems that have either the Microsoft Visual C++ or the MinGW compiler installed or on
Linux systems with the Gnu C++ compiler. The VC option is used for the Visual C++ compiler, the GC option is for the MinGW or
Gnu compilers, while NONE is the default which means that no compilation is performed. Using this option can result in faster run times by a factor of 2 to 5.</p>
<p><strong>SEGMENTS</strong> is the maximum number of water quality segments any pipe can have. The default setting is 5000. Reducing this number can
speed up the simulation time but may lead to more numerical diffusion.</p>
<p><strong>PECLET</strong> is the Peclet number above which the dispersion effect is neglected. The default value is 1000.0. Reducing this number excludes more pipes from dispersion modeling.</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="species">
<span id="id3"></span><h2><strong>[SPECIES]</strong><a class="headerlink" href="#species" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Defines each chemical species being simulated.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><strong>BULK</strong> <span class="math notranslate nohighlight">\(\ \)</span> <em>name</em> <span class="math notranslate nohighlight">\(\ \ \)</span> <em>units</em> <span class="math notranslate nohighlight">\(\ \ \)</span> (<em>Atol</em>) <span class="math notranslate nohighlight">\(\ \ \)</span> (<em>Rtol</em>)</p>
<p><strong>WALL</strong> <span class="math notranslate nohighlight">\(\ \)</span> <em>name</em> <span class="math notranslate nohighlight">\(\ \ \)</span> <em>units</em> <span class="math notranslate nohighlight">\(\ \ \)</span> (<em>Atol</em>) <span class="math notranslate nohighlight">\(\ \ \)</span> (<em>Rtol</em>)</p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd"><em>name</em></dt>
<dd class="field-odd"><p>species name</p>
</dd>
<dt class="field-even"><em>units</em></dt>
<dd class="field-even"><p>species mass units</p>
</dd>
<dt class="field-odd"><em>Atol</em></dt>
<dd class="field-odd"><p>optional absolute tolerance that overrides the global value set in the <a class="reference internal" href="#options"><span class="std std-ref">[OPTIONS]</span></a> section</p>
</dd>
<dt class="field-even"><em>Rtol</em></dt>
<dd class="field-even"><p>optional relative tolerance that overrides the global value set in the <a class="reference internal" href="#options"><span class="std std-ref">[OPTIONS]</span></a> section</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>The first format is used to define a bulk water (i.e., dissolved) species while the second is used for species attached (i.e., adsorbed) to the pipe wall.</p></li>
<li><p>Bulk species are measured in concentration units of mass units per liter while wall species are measured in mass units per unit area.</p></li>
<li><p>Any units can be used to represent species mass. The user is responsible for including any necessary unit conversion factors when specifying chemical reaction and equilibrium expressions that involve several species with different mass units.</p></li>
<li><p>Values for both <em>Atol</em> and <em>Rtol</em> must be provided to override the default tolerances.</p></li>
</ul>
</div></blockquote>
<p><strong>Examples:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[SPECIES]

;Bulk chlorine in mg/L with default tolerances

BULK CL2 MG

;Bulk biomass in ug/L with specific tolerances

BULK Xb UG 0.0001 0.01

;Attached biomass in ug/area with specific tolerances

WALL Xa UG 0.0001 0.01
</pre></div>
</div>
</div></blockquote>
</section>
<section id="coefficients">
<span id="id4"></span><h2><strong>[COEFFICIENTS]</strong><a class="headerlink" href="#coefficients" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Defines parameters and constants that are used in the reaction/equilibrium chemistry model.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><strong>PARAMETER</strong> <span class="math notranslate nohighlight">\(\quad\)</span> <em>name</em> <span class="math notranslate nohighlight">\(\quad\)</span> <em>value</em></p>
<p><strong>CONSTANT</strong> <span class="math notranslate nohighlight">\(\quad\)</span> <em>name</em> <span class="math notranslate nohighlight">\(\quad\)</span> <em>value</em></p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd"><em>name</em></dt>
<dd class="field-odd"><p>coefficient’s identifying name</p>
</dd>
<dt class="field-even"><em>value</em></dt>
<dd class="field-even"><p>global value of the coefficient.</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><p>A <strong>PARAMETER</strong> is a coefficient whose value can be changed on a pipe by pipe (or tank by tank) basis (see the <a class="reference internal" href="#parameters"><span class="std std-ref">[PARAMETERS]</span></a> section below)
while a <strong>CONSTANT</strong> coefficient maintains the same value throughout the pipe network.</p>
</div></blockquote>
<p><strong>Examples:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[COEFFICIENTS]

;Kb can vary by pipe

PARAMETER Kb 0.1

;Kw is fixed for all pipes

CONSTANT Kw 1.5
</pre></div>
</div>
</div></blockquote>
</section>
<section id="terms">
<span id="id5"></span><h2><strong>[TERMS]</strong><a class="headerlink" href="#terms" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Defines mathematical expressions that are used as intermediate terms in the expressions for the chemical reaction/equilibrium model.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><em>termID</em> <span class="math notranslate nohighlight">\(\quad\)</span> <em>expression</em></p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd"><em>termID</em></dt>
<dd class="field-odd"><p>identifying name given to the term</p>
</dd>
<dt class="field-even"><em>expression</em></dt>
<dd class="field-even"><p>any well-formed mathematical expression involving species, parameters, constants, hydraulic variables or other terms.</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><p>Terms can be used to simplify reaction rate or equilibrium expressions that would otherwise be unwieldy to write all on one line or have the same terms repeated in several different rate/equilibrium equations. The definition and use of TERMS, when those terms are common and appear in multiple rate or equilibrium expressions, may speed computation because the common term expression requires only one evaluation.</p>
<p>Hydraulic variables consist of the following reserved names:</p>
<p><strong>D</strong> <span class="math notranslate nohighlight">\(\ \ \ \)</span> pipe diameter (feet or meters)</p>
<p><strong>Kc</strong> <span class="math notranslate nohighlight">\(\,\)</span> pipe roughness coefficient (unitless for Hazen-Williams or Chezy-Manning head loss formulas, millifeet or millimeters for Darcy-Weisbach head loss formula)</p>
<p><strong>Q</strong> <span class="math notranslate nohighlight">\(\ \ \ \)</span> pipe flow rate (flow units)</p>
<p><strong>U</strong> <span class="math notranslate nohighlight">\(\ \ \ \)</span> pipe flow velocity (ft/sec or m/sec)</p>
<p><strong>Re</strong> <span class="math notranslate nohighlight">\(\ \,\)</span> flow Reynolds number</p>
<p><strong>Us</strong> <span class="math notranslate nohighlight">\(\ \,\)</span> pipe shear velocity (ft/sec or m/sec)</p>
<p><strong>Ff</strong> <span class="math notranslate nohighlight">\(\ \ \)</span> Darcy-Weisbach friction factor</p>
<p><strong>Av</strong> <span class="math notranslate nohighlight">\(\ \,\)</span> Surface area per unit volume (area units/L)</p>
</div></blockquote>
<p><strong>Examples:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[TERMS]

;A mass transfer coefficient

Kf 1.2e-4*Re^0.88/D

;A reaction term

a1 k1*HOCL*NH3
</pre></div>
</div>
</div></blockquote>
</section>
<section id="pipes">
<span id="id6"></span><h2><strong>[PIPES]</strong><a class="headerlink" href="#pipes" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Supplies the rate and equilibrium expressions that govern species dynamics in pipes.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><strong>EQUIL</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \ \ \)</span> <em>specieID</em> <span class="math notranslate nohighlight">\(\ \ \)</span> <em>expression</em></p>
<p><strong>RATE</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \ \ \ \)</span> <em>specieID</em> <span class="math notranslate nohighlight">\(\ \ \)</span> <em>expression</em></p>
<p><strong>FORMULA</strong> <span class="math notranslate nohighlight">\(\ \)</span> <em>specieID</em> <span class="math notranslate nohighlight">\(\ \ \)</span> <em>expression</em></p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd"><em>specieID</em></dt>
<dd class="field-odd"><p>a species identifier</p>
</dd>
<dt class="field-even"><em>expression</em></dt>
<dd class="field-even"><p>any well-formed mathematical expression involving species, parameters, constants, hydraulic variables or terms.</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>There should be one expression supplied for each species defined in the model.</p></li>
<li><p>The allowable hydraulic variables were defined above in the description of the <a class="reference internal" href="#terms"><span class="std std-ref">[TERMS]</span></a> section.</p></li>
<li><p>The <strong>EQUIL</strong> format is used for equilibrium expressions where it is assumed that the expression supplied is being equated to zero. Thus formally there is no need to supply the name of a species, but requiring one encourages the user to make sure that all species are accounted for.</p></li>
<li><p>The <strong>RATE</strong> format is used to supply the equation that expresses the rate of change of the given species with respect to time as a function of the other species in the model.</p></li>
<li><p>The <strong>FORMULA</strong> format is used when the concentration of the named species is a simple function of the remaining species.</p></li>
</ul>
</div></blockquote>
<p><strong>Examples:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[PIPES]

;Bulk chlorine decay

RATE CL2 -Kb*CL2

;Adsorption equilibrium between Cb in bulk and Cw on wall

EQUIL Cw Cmax*k*Cb / (1 + k*Cb) - Cw

;Conversion between biomass (X) and cell numbers (N)

FORMULA N log10(X*1.0e6)

;Bulk C formation plus non-equilibrium sorption between C and Cs

;Using hydraulic variable Av [Area-Units/Liter]

RATE C K*C - Av*(K1*(Smax-Cs)*C - K2*Cs)

;Equivalent sorption model, using 1/hydraulic radius = 4/D

;Assumes area units are FT2 and diameter in FT

;CFPL is TERM equal to FT3/Liter, thus (4*CFPL/D) == Av

RATE C K*C - (4*CFPL/D)*(K1*(Smax-Cs)*C - K2*Cs)
</pre></div>
</div>
</div></blockquote>
</section>
<section id="tanks">
<span id="id7"></span><h2><strong>[TANKS]</strong><a class="headerlink" href="#tanks" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Supplies the rate and equilibrium expressions that govern species dynamics in storage tanks.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><strong>EQUIL</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \ \ \)</span> <em>specieID</em> <span class="math notranslate nohighlight">\(\ \ \)</span> <em>expression</em></p>
<p><strong>RATE</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \ \ \ \)</span> <em>specieID</em> <span class="math notranslate nohighlight">\(\ \ \)</span> <em>expression</em></p>
<p><strong>FORMULA</strong> <span class="math notranslate nohighlight">\(\ \)</span> <em>specieID</em> <span class="math notranslate nohighlight">\(\ \ \)</span> <em>expression</em></p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd"><em>specieID</em></dt>
<dd class="field-odd"><p>a species identifier</p>
</dd>
<dt class="field-even"><em>expression</em></dt>
<dd class="field-even"><p>any well-formed mathematical expression involving species, parameters, constants, or terms.</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>A <strong>[TANKS]</strong> section is always required when a model contains both bulk and wall species, even when there are no tanks in the pipe network. If the model contains only bulk species, then this section can be omitted if the reaction expressions within tanks are the same as within pipes.</p></li>
<li><p>There should be one expression supplied for each bulk species defined in the model. By definition, wall species do not exist within tanks.</p></li>
<li><p>Hydraulic variables are associated only with pipes and cannot appear in tank expressions.</p></li>
<li><p>The <strong>EQUIL</strong> format is used for equilibrium expressions where it is assumed that the expression supplied is being equated to zero. Thus formally there is no need to supply the name of a species but doing so allows one to make sure that all species are accounted for.</p></li>
<li><p>The <strong>RATE</strong> format is used to supply the equation that expresses the rate of change of the given species with respect to time as a function of the other species in the model.</p></li>
<li><p>The <strong>FORMULA</strong> format is used when the concentration of the named species is a simple function of the remaining species.</p></li>
</ul>
</div></blockquote>
<p><strong>Examples:</strong></p>
<blockquote>
<div><p>See the examples listed for the <a class="reference internal" href="#pipes"><span class="std std-ref">[PIPES]</span></a> section.</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="sources">
<span id="id8"></span><h2><strong>[SOURCES]</strong><a class="headerlink" href="#sources" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Defines the locations where external sources of particular species enter the pipe network.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><em>sourceType</em> <span class="math notranslate nohighlight">\(\quad\)</span> <em>nodeID</em> <span class="math notranslate nohighlight">\(\quad\)</span> <em>specieID</em> <span class="math notranslate nohighlight">\(\quad\)</span> <em>strength</em> <span class="math notranslate nohighlight">\(\quad\)</span> <em>(patternID)</em></p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd"><em>sourceType</em></dt>
<dd class="field-odd"><p>either <strong>MASS</strong>, <strong>CONCEN</strong>, <strong>FLOWPACED</strong>, or <strong>SETPOINT</strong></p>
</dd>
<dt class="field-even"><em>nodeID</em></dt>
<dd class="field-even"><p>the ID label of the network node where the source is located</p>
</dd>
<dt class="field-odd"><em>specieID</em></dt>
<dd class="field-odd"><p>a bulk species identifier</p>
</dd>
<dt class="field-even"><em>strength</em></dt>
<dd class="field-even"><p>the baseline mass inflow rate (mass/minute) for <strong>MASS</strong> sources or concentration (mass/L) for all other source types</p>
</dd>
<dt class="field-odd"><em>patternID</em></dt>
<dd class="field-odd"><p>the name of an optional time pattern that is used to vary the source strength over time.</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Use one line for each species that has non-zero source strength.</p></li>
<li><p>Only bulk species can enter the pipe network, not wall species.</p></li>
<li><p>The definitions of the different source types conform to those used in the original EPANET program are as follows:</p>
<ul>
<li><p>A <strong>MASS</strong> type source adds a specific mass of species per unit of time to the total flow entering the source node from all connecting pipes.</p></li>
<li><p>A <strong>CONCEN</strong> type source sets the concentration of the species in any external source inflow (i.e., a negative demand) entering the node. The external inflow must be established as part of the hydraulic specification of the network model.</p></li>
<li><p>A <strong>FLOWPACED</strong> type source adds a specific concentration to the concentration that results when all inflows to the source node from its connecting pipes are mixed together.</p></li>
<li><p>A <strong>SETPOINT</strong> type source fixes the concentration leaving the source node to a specific level as long as the mixture concentration of flows from all connecting pipes entering the node is less than the set point concentration.</p></li>
</ul>
</li>
<li><p>If a time pattern is supplied for the source, it must be one defined in the <a class="reference internal" href="#patterns"><span class="std std-ref">[PATTERNS]</span></a> section of the MSX file, not a pattern from the associated EPANET input file.</p></li>
</ul>
</div></blockquote>
<p><strong>Examples:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[SOURCES]

;Inject 6.5 mg/minute of chemical X into Node N1 over the period of time

;defined by pattern PAT1

MASS N1 X 6.5 PAT1

;Maintain a 1.0 mg/L level of chlorine at node N100

SETPOINT N100 CL2 1.0
</pre></div>
</div>
</div></blockquote>
</section>
<section id="quality">
<span id="id9"></span><h2><strong>[QUALITY]</strong><a class="headerlink" href="#quality" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Specifies the initial concentrations of species throughout the pipe network.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><strong>GLOBAL</strong> <span class="math notranslate nohighlight">\(\ \)</span> <em>specieID</em> <span class="math notranslate nohighlight">\(\ \)</span> <em>concen</em></p>
<p><strong>NODE</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \)</span> <em>nodeID</em> <span class="math notranslate nohighlight">\(\ \ \ \)</span> <em>specieID</em> <span class="math notranslate nohighlight">\(\ \)</span> <em>concen</em></p>
<p><strong>LINK</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \)</span> <em>linkID</em> <span class="math notranslate nohighlight">\(\ \ \ \ \ \)</span> <em>specieID</em> <span class="math notranslate nohighlight">\(\ \)</span> <em>concen</em></p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd"><em>specieID</em></dt>
<dd class="field-odd"><p>a species identifier</p>
</dd>
<dt class="field-even"><em>nodeID</em></dt>
<dd class="field-even"><p>a network node ID label</p>
</dd>
<dt class="field-odd"><em>linkID</em></dt>
<dd class="field-odd"><p>a network link ID label</p>
</dd>
<dt class="field-even"><em>concen</em></dt>
<dd class="field-even"><p>a species concentration</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Use as many lines as necessary to define a network’s initial condition.</p></li>
<li><p>Use the <strong>GLOBAL</strong> format to set the same initial concentration at all nodes (for bulk species) or within all pipes (for wall species).</p></li>
<li><p>Use the <strong>NODE</strong> format to set an initial concentration of a bulk species at a particular node.</p></li>
<li><p>Use the <strong>LINK</strong> format to set an initial concentration of a wall species within a particular pipe.</p></li>
<li><p>The initial concentration of a bulk species within a pipe is assumed equal to the initial concentration at the downstream node of the pipe.</p></li>
<li><p>All initial concentrations are assumed to be zero unless otherwise specified in this section.</p></li>
<li><p>Models with equilibrium equations will require that reasonable initial conditions be set so that the equations are solvable. For example, if they contain a ratio of species concentrations then a divide by zero condition will occur if all initial concentrations are set to zero.</p></li>
</ul>
</div></blockquote>
<p><strong>Examples:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[QUALITY]

;Set concentration of bulk species Cb to 1.0 at all nodes

GLOBAL Cb 1.0

;Override above condition for node N100

NODE N100 Cb 0.5
</pre></div>
</div>
</div></blockquote>
</section>
<section id="parameters">
<span id="id10"></span><h2><strong>[PARAMETERS]</strong><a class="headerlink" href="#parameters" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Defines values for specific reaction rate parameters on a pipe by pipe or tank by tank basis.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><strong>PIPE</strong> <span class="math notranslate nohighlight">\(\ \ \ \)</span> <em>pipeID</em> <span class="math notranslate nohighlight">\(\ \)</span> <em>paramID</em> <span class="math notranslate nohighlight">\(\ \)</span> <em>value</em></p>
<p><strong>TANK</strong> <span class="math notranslate nohighlight">\(\ \)</span> <em>tankID</em> <span class="math notranslate nohighlight">\(\ \)</span> <em>paramID</em> <span class="math notranslate nohighlight">\(\ \)</span> <em>value</em></p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd"><em>pipeID</em></dt>
<dd class="field-odd"><p>the ID label of a pipe link in the network</p>
</dd>
<dt class="field-even"><em>tankID</em></dt>
<dd class="field-even"><p>the ID label of a tank node in the network</p>
</dd>
<dt class="field-odd"><em>paramID</em></dt>
<dd class="field-odd"><p>the name of one of the reaction rate parameters listed in the <a class="reference internal" href="#coefficients"><span class="std std-ref">[COEFFICIENTS]</span></a> section</p>
</dd>
<dt class="field-even"><em>value</em></dt>
<dd class="field-even"><p>the parameter’s value used for the specified pipe or tank.</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Use one line for each pipe or tank whose parameter value is different than the global value.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<section id="patterns">
<span id="id11"></span><h2><strong>[PATTERNS]</strong><a class="headerlink" href="#patterns" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Defines time patterns used to vary external source strength over time.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><em>name</em> <span class="math notranslate nohighlight">\(\quad\)</span> <em>multiplier</em> <span class="math notranslate nohighlight">\(\ \)</span> <em>multiplier</em> <span class="math notranslate nohighlight">\(\quad\)</span> …</p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd"><em>name</em></dt>
<dd class="field-odd"><p>an identifier assigned to the time pattern</p>
</dd>
<dt class="field-even"><em>multiplier</em></dt>
<dd class="field-even"><p>a multiplier used to adjust a baseline value</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Use one or more lines for each time pattern included in the model.</p></li>
<li><p>If extending the list of multipliers to another line remember to begin the line with the pattern name.</p></li>
<li><p>All patterns share the same time period interval as defined in the <strong>[TIMES]</strong> section of the EPANET input file being used in conjunction with the EPANET-MSX input file.</p></li>
<li><p>Each pattern can have a different number of time periods.</p></li>
<li><p>When the simulation time exceeds the pattern length the pattern wraps around to its first period.</p></li>
</ul>
</div></blockquote>
<p><strong>Examples:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[PATTERNS]

;A 3-hour injection pattern over a 24 hour period

;(assuming a 1-hour pattern time interval is in use)

P1 0.0 0.0 0.0 0.0 1.0 1.0

P1 1.0 0.0 0.0 0.0 0.0 0.0

P1 0.0 0.0 0.0 0.0 0.0 0.0

P1 0.0 0.0 0.0 0.0 0.0 0.0
</pre></div>
</div>
</div></blockquote>
</section>
<section id="dispersion">
<span id="id12"></span><h2><strong>[DISPERSION]</strong><a class="headerlink" href="#dispersion" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Defines the relative diffusivity of the species to be incorporated in the dispesion modeling.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><em>specieID</em> <span class="math notranslate nohighlight">\(\quad\)</span> <em>value</em></p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd"><em>specieID</em></dt>
<dd class="field-odd"><p>a species identifier</p>
</dd>
<dt class="field-even"><em>value</em></dt>
<dd class="field-even"><p>relative diffusivity of the species.</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><p>The relative diffusivity is the ratio of the molecular diffusivity of the species to that of chlorine at 20 deg. C (<span class="math notranslate nohighlight">\(0.00112 ft^2/day\)</span>).
If the relative diffusivity of a species is not defined in this section, the dispersion of the species is neglected.</p>
</div></blockquote>
<p><strong>Examples:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[DISPERISON]

; same molucular diffusivity as chlorine at 20 deg. C

HOCL 1.0

NH3 1.0

NH2CL 1.0

NHCL2 1.0
</pre></div>
</div>
</div></blockquote>
</section>
<section id="report">
<span id="id13"></span><h2><strong>[REPORT]</strong><a class="headerlink" href="#report" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Describes the contents of the output report produced from a simulation.</p>
</div></blockquote>
<p><strong>Formats:</strong></p>
<blockquote>
<div><p><strong>NODES</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \)</span> <strong>ALL</strong></p>
<p><strong>NODES</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \)</span> <em>node1 node2 …</em></p>
<p><strong>LINKS</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \ \)</span> <strong>ALL</strong></p>
<p><strong>LINKS</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \ \)</span> <em>link1 link2 …</em></p>
<p><strong>SPECIES</strong> <span class="math notranslate nohighlight">\(\ \ \ \)</span> <em>speciesID</em> <span class="math notranslate nohighlight">\(\ \)</span> <strong>YES</strong><em>/</em><strong>NO</strong> <span class="math notranslate nohighlight">\(\ \)</span> (<em>precision</em>)</p>
<p><strong>FILE</strong> <span class="math notranslate nohighlight">\(\ \ \ \ \ \ \ \ \ \ \)</span> <em>filename</em></p>
<p><strong>PAGESIZE</strong> <span class="math notranslate nohighlight">\(\ \)</span> <em>lines</em></p>
</div></blockquote>
<p><strong>Definitions:</strong></p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd"><em>node1, node2, etc.</em></dt>
<dd class="field-odd"><p>a list of nodes whose results are to be reported</p>
</dd>
<dt class="field-even"><em>link1, link2, etc.</em></dt>
<dd class="field-even"><p>a list of links whose results are to be reported</p>
</dd>
<dt class="field-odd"><em>specieID</em></dt>
<dd class="field-odd"><p>the name of a species to be reported on</p>
</dd>
<dt class="field-even"><em>precision</em></dt>
<dd class="field-even"><p>number of decimal places used to report a species’ concentration</p>
</dd>
<dt class="field-odd"><em>filename</em></dt>
<dd class="field-odd"><p>the name of a file to which the report will be written</p>
</dd>
<dt class="field-even"><em>lines</em></dt>
<dd class="field-even"><p>the number of lines per page to use in the report.</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Remarks:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Use as many <strong>NODES</strong> and <strong>LINKS</strong> lines as it takes to specify which locations get reported. The default is not to report results for any nodes or links.</p></li>
<li><p>Use the <strong>SPECIES</strong> line to specify which species get reported and at what precision. The default is to report all species at two decimal places of precision.</p></li>
<li><p>The <strong>FILE</strong> line is used to have the report written to a specific file. If not provided the report will be written to the same file used for reporting program errors and simulation status.</p></li>
</ul>
</div></blockquote>
<p><strong>Examples:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[REPORT]

;Write results for all species at all nodes and links

;at all time periods to a specific file

NODES ALL

LINKS ALL

FILE &quot;c:\my files\epanet-msx\myreport.txt&quot;

[REPORT]

;Write nodal results for species S1 and S2 using

;4 decimal places to the standard EPANET report file

SPECIES S1 YES 4

SPECIES S2 YES 4

NODES ALL
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<span id="document-5_examplesystems"></span><section id="example-reaction-systems">
<span id="examplesystems"></span><h1>EXAMPLE REACTION SYSTEMS<a class="headerlink" href="#example-reaction-systems" title="Permalink to this heading">¶</a></h1>
<p>This section demonstrates how several different multi-species reaction
systems of interest can be modeled with EPANET-MSX.</p>
<section id="multi-source-chlorine-decay">
<h2><em>Multi-Source Chlorine Decay</em><a class="headerlink" href="#multi-source-chlorine-decay" title="Permalink to this heading">¶</a></h2>
<p>Multi-source networks present problems modeling a single species,
such as free chlorine, when the decay rates observed in the source
waters vary quite significantly. As the sources blend differently
throughout the network, it becomes difficult to assign a single decay
coefficient that accurately reflects the decay rate observed in the
blended water. Consider the distribution system shown in <a class="reference internal" href="#figure-5-1"><span class="std std-numref">Fig. 5.1</span></a> that
is served by two different sources. The network has been color-coded to
show the average fraction of water in each pipe that originates from the
River (Source 1).</p>
<figure class="align-default" id="id6">
<span id="figure-5-1"></span><a class="reference internal image-reference" href="_images/figure51.png"><img alt="_images/figure51.png" src="_images/figure51.png" style="width: 4.54167in; height: 4.00833in;" /></a>
<figcaption>
<p><span class="caption-text">Example of a two-source water distribution system showing the average percent of water originating from the River source</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Assume that free chlorine reacts in the bulk flow along a pipe according
to the following first-order rate expression:</p>
<blockquote>
<div><div class="math notranslate nohighlight" id="equation-firstorder">
<span class="eqno">()<a class="headerlink" href="#equation-firstorder" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
{d {C} \over d {t}} = {-kC}
\end{aligned}\]</div>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(C\)</span> is the concentration of free chlorine at time <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(k\)</span> is a
reaction rate constant. Now suppose that when analyzed separately in
bottle tests, water from Source 1 has a <span class="math notranslate nohighlight">\(k\)</span> = 1.3 days<sup>-1</sup> while
Source 2’s water has <span class="math notranslate nohighlight">\(k\)</span> = 17.7 days<sup>-1</sup>. The issue becomes one of
determining a <span class="math notranslate nohighlight">\({k}\)</span>-value for each pipe of the network that will reflect the
proper reactivity of the blended water from both sources.</p>
<p>One approach to reconciling the vastly different chlorine decay
constants in this example, without introducing a more complex chlorine
decay mechanism that attempts to represent the different reactivity of
the total organics from the two sources, is to assume that at any time
the chlorine decay constant within a pipe is given by a weighted average
of the two source values, where the weights are the fraction of each
source water present in the pipe. These fractions can be deduced by
introducing a fictitious conservative tracer compound at Source 1,
denoted as T1, whose concentration is fixed at a constant 1.0 <span class="math notranslate nohighlight">\(mg/L\)</span>. Then
at any point in the network the fraction of water from Source 1 would be
the concentration of T1 while the fraction from Source 2 would be 1.0
minus that value. The resulting chlorine decay model now consists of
two-species – a tracer species <span class="math notranslate nohighlight">\(T1\)</span> and a free chlorine species <span class="math notranslate nohighlight">\(C\)</span>. The
first-order decay constant k for any pipe in the system would be given
by:</p>
<blockquote>
<div><div class="math notranslate nohighlight" id="equation-decayconstant">
<span class="eqno">()<a class="headerlink" href="#equation-decayconstant" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
k = 1.3{T1}+17.7{(1.0-T1)}
\end{aligned}\]</div>
</div></blockquote>
<p>while the system reaction dynamics would be expressed by:</p>
<blockquote>
<div><div class="math notranslate nohighlight" id="equation-dtdt">
<span class="eqno">()<a class="headerlink" href="#equation-dtdt" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
{d {T1} \over d {t}} = 0
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-dcdt">
<span class="eqno">()<a class="headerlink" href="#equation-dcdt" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
{d {C} \over d {t}} = {{-(1.3{T1}+17.7{(1.0-T1)})}C}
\end{aligned}\]</div>
</div></blockquote>
<p><a class="reference internal" href="#ex-twosources-inp"><span class="std std-numref">Listing 5.1</span></a> is the MSX input file that defines this model for a network
where the two source nodes are represented as reservoirs with ID names
“1” and “2”, respectively. Note that it contains no surface species, no
equilibrium species, and assumes that a constant chlorine concentration
of 1.2 <span class="math notranslate nohighlight">\(mg/L\)</span> is maintained at each source.</p>
<div class="literal-block-wrapper docutils container" id="ex-twosources-inp">
<div class="code-block-caption"><span class="caption-text">EPANET-MSX input file for modeling two-source chlorine decay</span><a class="headerlink" href="#ex-twosources-inp" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[OPTIONS]
  AREA_UNITS  FT2
  RATE_UNITS  HR
  SOLVER      RK5
  TIMESTEP    300

[SPECIES]
  BULK  T1    MG         ;Source 1 tracer
  BULK  CL2   MG         ;Free chlorine

[COEFFICIENTS]
  CONSTANT  k1  1.3      ;Source 1 decay coeff.
  CONSTANT  k2  17.7     ;Source 2 decay coeff.

[PIPES]
  ;T1 is conservative
  RATE  T1   0

  ;CL2 has first order decay
  RATE  CL2  –(k1*T1 + k2*(1-T1))*CL2

[QUALITY]
  ;Initial conditions (= 0 if not specified here)
  NODE   1      T1   1.0 
  NODE   1      CL2  1.2
  NODE   2      CL2  1.2   
</pre></div>
</div>
</div>
</section>
<section id="oxidation-mass-transfer-and-adsorption">
<h2><em>Oxidation, Mass Transfer, and Adsorption</em><a class="headerlink" href="#oxidation-mass-transfer-and-adsorption" title="Permalink to this heading">¶</a></h2>
<p>This example is an extension and more complete description of the
arsenic oxidation/adsorption model that was presented previously in
sections <a class="reference internal" href="index.html#framework"><span class="std std-ref">CONCEPTUAL FRAMEWORK</span></a> (<a class="reference internal" href="index.html#framework"><span class="std std-numref">Section 2</span></a>) and <a class="reference internal" href="index.html#usage"><span class="std std-ref">PROGRAM USAGE</span></a> (<a class="reference internal" href="index.html#usage"><span class="std std-numref">Section 3</span></a>) of this manual.
It models the oxidation of arsenite <span class="math notranslate nohighlight">\(As^{+3}\)</span> to arsenate <span class="math notranslate nohighlight">\(As^{+5}\)</span> by a monochloramine disinfectant
residual <span class="math notranslate nohighlight">\(NH_2Cl\)</span> in the bulk flow along with the subsequent
adsorption of arsenate onto exposed iron on the pipe wall. We also
include a mass transfer limitation to the rate at which arsenate can
migrate to the pipe wall where it is adsorbed.</p>
<p><a class="reference internal" href="#figure-5-2"><span class="std std-numref">Fig. 5.2</span></a> shows a schematic of the arsenic model. Note that after
arsenate is produced by the oxidation of arsenite in the bulk solution
it diffuses through a boundary layer to reach a concentration denoted as
<span class="math notranslate nohighlight">\(As_w^{+5}\)</span> just adjacent to the pipe wall. It is this
concentration that interacts with adsorbed arsenate <span class="math notranslate nohighlight">\(As_s^{+5}\)</span> on the pipe wall.
Thus the system contains five species (dissolved arsenite in bulk solution, dissolved
arsenate in bulk solution, monochloramine in bulk solution, dissolved arsenate just
adjacent to the pipe wall surface and sorbed arsenate on the pipe
surface). One might argue that arsenate is a single species that appears
in three different forms (bulk dissolved, wall dissolved, and wall
sorbed), but for the purposes of modeling it is necessary to distinguish
each form as a separate species.</p>
<figure class="align-default" id="id7">
<span id="figure-5-2"></span><img alt="_images/figure52.png" src="_images/figure52.png" />
<figcaption>
<p><span class="caption-text">Schematic of the mass transfer limited arsenic oxidation/adsorption system</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The mathematical form of this reaction system can be modeled with five
differential rate equations in the case of non-equilibrium
adsorption/desorption (see, e.g., <span id="id1">[<a class="reference internal" href="index.html#id5" title="B. Gu, J. Schmitt, Z. Chen, L. Liang, and J.F. McCarthy. Adsorption and desorption of natural organic matter on iron oxide: mechanisms and models. Environ. Sci. Technol., 28:38-46, January 1994.">Gu <em>et al.</em>, 1994</a>]</span>, for a more complete
description of non-equilibrium adsorption/desorption):</p>
<div class="math notranslate nohighlight" id="equation-5-as3">
<span class="eqno">()<a class="headerlink" href="#equation-5-as3" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
{d As^{+3} \over {d t}} = -k_a As^{+3}(NH_2Cl)
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-5-nh2cl">
<span class="eqno">()<a class="headerlink" href="#equation-5-nh2cl" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
{d (NH_2Cl) \over {d t}} =-k_b (NH_2Cl)
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-5-as5">
<span class="eqno">()<a class="headerlink" href="#equation-5-as5" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
{d As^{+5} \over {d t}} = k_a As^{+3}(NH_2Cl)-K_fA_v(As^{+5}-As_w^{+5})
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-5-as5w">
<span class="eqno">()<a class="headerlink" href="#equation-5-as5w" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
{d As_w^{+5} \over {d t}}= K_fA_v(As^{+5}-As_w^{+5})-A_v[k_1(S_{max}-As_s^{+5})As_w^{+5}-k_2As_s^{+5}]
\end{aligned}\]</div>
<div class="math notranslate nohighlight" id="equation-5-as5s">
<span class="eqno">()<a class="headerlink" href="#equation-5-as5s" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
{d As_s^{+5} \over {d t}}= {k_1(S_{max}-As_s^{+5})As_w^{+5}-k_2As_s^{+5}}
\end{aligned}\]</div>
<p>where <span class="math notranslate nohighlight">\(As^{+3}\)</span> is the bulk phase concentration of arsenite,
<span class="math notranslate nohighlight">\(As^{+5}\)</span> is the bulk phase concentration of arsenate, <span class="math notranslate nohighlight">\(As_w^{+5}\)</span> is
the bulk phase concentration of arsenate adjacent to the pipe wall,
<span class="math notranslate nohighlight">\(As_s^{+5}\)</span> is surface phase concentration of arsenate, and
<span class="math notranslate nohighlight">\(NH_2Cl\)</span> is the bulk phase concentration of monochloramine. The
parameters in these equations are as follows: <span class="math notranslate nohighlight">\(k_a\)</span> is a rate
coefficient for arsenite oxidation, <span class="math notranslate nohighlight">\(k_b\)</span> is a monochloramine
decay rate coefficient due to reactions with all other reactants
(including arsenite), <span class="math notranslate nohighlight">\(A_v\)</span> is the pipe surface area per liter of
pipe volume, <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> are the arsenate adsorption and
desorption rate coefficients, <span class="math notranslate nohighlight">\(S_{max}\)</span> is the maximum pipe surface
concentration, and <span class="math notranslate nohighlight">\(K_f\)</span> is a mass transfer rate coefficient. The
mass transfer coefficient <span class="math notranslate nohighlight">\(K_f\)</span> will in general depend on the
amount of flow turbulence as well as the diameter of the pipe. A typical
empirical relation might be:</p>
<div class="math notranslate nohighlight" id="equation-masstransfer">
<span class="eqno">()<a class="headerlink" href="#equation-masstransfer" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
K_f = {{1.6 \times 10^{-4}Re^{0.88}} \over {D}}
\end{aligned}\]</div>
<p>where <span class="math notranslate nohighlight">\(Re\)</span> is the flow Reynolds number and <span class="math notranslate nohighlight">\(D\)</span> is the pipe diameter.</p>
<p>Using the notation defined in <a class="reference internal" href="index.html#equation-daebulk">(2.5)</a>-<a class="reference internal" href="index.html#equation-daeequil">(2.7)</a>, <span class="math notranslate nohighlight">\(\boldsymbol{x}_b\)</span> =
{<span class="math notranslate nohighlight">\(As^{+3}\)</span>, <span class="math notranslate nohighlight">\(As^{+5}\)</span>, <span class="math notranslate nohighlight">\(As_w^{+5}\)</span>, <span class="math notranslate nohighlight">\(NH_2Cl\)</span>},
<span class="math notranslate nohighlight">\(\boldsymbol{x}_s\)</span> = {<span class="math notranslate nohighlight">\(As_s^{+5}\)</span>}, <span class="math notranslate nohighlight">\(\boldsymbol{z}_b\)</span> = {<span class="math notranslate nohighlight">\(\emptyset\)</span>}, <span class="math notranslate nohighlight">\(\boldsymbol{z}_s\)</span> = {<span class="math notranslate nohighlight">\(\emptyset\)</span>},
and <span class="math notranslate nohighlight">\(\boldsymbol{p}\)</span> = {<span class="math notranslate nohighlight">\(k_a\)</span>, <span class="math notranslate nohighlight">\(k_b\)</span>, <span class="math notranslate nohighlight">\(A_v\)</span>, <span class="math notranslate nohighlight">\(k_1\)</span>,
<span class="math notranslate nohighlight">\(k_2\)</span>, <span class="math notranslate nohighlight">\(K_f\)</span>, <span class="math notranslate nohighlight">\(S_{max}\)</span>}. The reaction dynamics defined
by <a class="reference internal" href="#equation-5-as3">(5.5)</a>-<a class="reference internal" href="#equation-5-as5s">(5.9)</a> conserves total arsenic mass within any pipe segment of
length L (and thus bulk volume <span class="math notranslate nohighlight">\(A \times L\)</span>, and pipe surface area <span class="math notranslate nohighlight">\(P \times L\)</span>, where <span class="math notranslate nohighlight">\(A\)</span>
and <span class="math notranslate nohighlight">\(P\)</span> are cross sectional area and wetted perimeter, respectively). This
can be shown by summing the differential changes in the mass of all
arsenic species within a pipe segment, and assuring that they sum to zero: <span class="math notranslate nohighlight">\((A \times L) ({d {As^{+3}} \over {dt}}) + (A \times L) ({d As^{+5} \over dt}) + (A \times L)({d As_w^{+5} \over dt}) + (P \times L) ({d As_s^{+5} \over dt}) = 0\)</span>.</p>
<p>It was mentioned in <a class="reference internal" href="index.html#framework"><span class="std std-ref">CONCEPTUAL FRAMEWORK</span></a> (<a class="reference internal" href="index.html#framework"><span class="std std-numref">Section 2</span></a>) that some reactions are reversible and
fast enough in comparison with the system’s other processes so that a
local equilibrium can be assumed, while others are not sufficiently fast
and/or irreversible and it is inappropriate to use an equilibrium
formulation to represent them. In the case of reversible sorption
processes a local equilibrium assumption (LEA) is sometimes assumed
between the adsorbed phase and its concentration in the bulk fluid (such
an assumption is not always realistic, and no such claim is made here -
see, e.g., <span id="id2">[<a class="reference internal" href="index.html#id4" title="D.C. Koopman, J.V. Cole, and H.H. Lee. Assumption of local equilibrium in adsorption processes. AIChE Journal, 38:623-625, April 1992.">Koopman <em>et al.</em>, 1992</a>]</span>). Under the LEA, the rates of
adsorption and desorption must be much faster than the rate of change of
the bulk species, and consequently, <span class="math notranslate nohighlight">\({d As_s^{+5} \over dt} = 0\)</span>; the
differential equation <a class="reference internal" href="#equation-5-as5s">(5.9)</a> can then be substituted with the algebraic
equation:</p>
<div class="math notranslate nohighlight" id="equation-5-ass5-equil">
<span class="eqno">()<a class="headerlink" href="#equation-5-ass5-equil" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
As_s^{+5}={{k_s S_{max}As_w^{+5}} \over {1+k_sAs_w^{+5}}}
\end{aligned}\]</div>
<p>where <span class="math notranslate nohighlight">\(k_s = k_1/k_2\)</span>. In this case the DAE system
is described by <a class="reference internal" href="#equation-5-as3">(5.5)</a>-<a class="reference internal" href="#equation-5-as5w">(5.8)</a> and <a class="reference internal" href="#equation-5-ass5-equil">(5.11)</a>, and includes four differential rate
equations and one algebraic equation. Thus in terms of the notation used
in <a class="reference internal" href="index.html#equation-daebulk">(2.5)</a>-<a class="reference internal" href="index.html#equation-daeequil">(2.7)</a>, <span class="math notranslate nohighlight">\(\boldsymbol{x}_b\)</span> = {<span class="math notranslate nohighlight">\(As^{+3}\)</span>, <span class="math notranslate nohighlight">\(As^{+5}\)</span>,
<span class="math notranslate nohighlight">\(As_w^{+5}\)</span>, <span class="math notranslate nohighlight">\(NH_2Cl\)</span>}, <span class="math notranslate nohighlight">\(\boldsymbol{x}_s\)</span> = {<span class="math notranslate nohighlight">\(\emptyset\)</span>}, <span class="math notranslate nohighlight">\(\boldsymbol{z}_b\)</span> = {<span class="math notranslate nohighlight">\(\emptyset\)</span>},
<span class="math notranslate nohighlight">\(\boldsymbol{z}_s\)</span> = {<span class="math notranslate nohighlight">\(As_s^{+5}\)</span>}, and <span class="math notranslate nohighlight">\(\boldsymbol{p}\)</span> = {<span class="math notranslate nohighlight">\(k_a\)</span>, <span class="math notranslate nohighlight">\(k_b\)</span>, <span class="math notranslate nohighlight">\(A_v\)</span>, <span class="math notranslate nohighlight">\(k_1\)</span>,
<span class="math notranslate nohighlight">\(k_2\)</span>, <span class="math notranslate nohighlight">\(K_f\)</span>, <span class="math notranslate nohighlight">\(S_{max}\)</span>}.  The
LEA model could be left in this form that explicitly includes the
surface adsorbed phase (<span class="math notranslate nohighlight">\(As_s^{+5}\)</span>) - or, because the special form of
<a class="reference internal" href="#equation-5-ass5-equil">(5.11)</a> presents an explicit solution for the adsorbed arsenate, <a class="reference internal" href="#equation-5-ass5-equil">(5.11)</a>
could be substituted into <a class="reference internal" href="#equation-5-as5w">(5.8)</a>, leaving an equivalent system of only
four differential rate expressions in the four bulk-phase variables
<span class="math notranslate nohighlight">\(\boldsymbol{x}_b\)</span> = {<span class="math notranslate nohighlight">\(As^{+3}\)</span>, <span class="math notranslate nohighlight">\(As^{+5}\)</span>,
<span class="math notranslate nohighlight">\(As_w^{+5}\)</span>, <span class="math notranslate nohighlight">\(NH_2Cl\)</span>}. In this latter case, however, the adsorbed phase
arsenate concentration would have to be separately calculated after
solution (if desired), using <a class="reference internal" href="#equation-5-ass5-equil">(5.11)</a>, which could be laborious if it were
required at many locations and time steps.</p>
<p><a class="reference internal" href="#ex-arsenic-inp"><span class="std std-numref">Listing 5.2</span></a> shows the MSX input file for this system, with the assumption
of local equilibrium (<a class="reference internal" href="#equation-5-as3">(5.5)</a>-<a class="reference internal" href="#equation-5-as5w">(5.8)</a> and <a class="reference internal" href="#equation-5-ass5-equil">(5.11)</a>). The [PIPES] section
contains four kinetic rate reactions involving the four bulk species and
one equilibrium reaction that includes the lone surface species. The
[TANKS] section contains only the bulk species reactions. To complete
the model specification, the [QUALITY] section assumes that the network
has a single source which is a reservoir node labeled “1”, and that the
concentrations at this source remain constant. If this were not the case
then a [SOURCES] section could be added that describes the sources in
more detail.</p>
<div class="literal-block-wrapper docutils container" id="ex-arsenic-inp">
<div class="code-block-caption"><span class="caption-text">MSX input file for the mass transfer limited arsenic oxidation/adsorption system</span><a class="headerlink" href="#ex-arsenic-inp" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[SPECIES]
  BULK  A3    UG                    ;Dissolved arsenite
  BULK  A5    UG                    ;Dissolved arsenate
  BULK  A5w   UG                    ;Dissolved arsenate at wall
  WALL  A5s   UG                    ;Adsorbed arsenate
  BULK  NH2CL MG                    ;Monochloramine

[COEFFICIENTS]
  CONSTANT  Ka   10.0               ;Arsenite oxidation rate coeff.
  CONSTANT  Kb   0.50               ;Monochloramine decay rate coeff.
  CONSTANT  Smax 50                 ;Arsenate adsorption coeff.  
  CONSTANT  K1   5.0                ;Arsenate adsorption rate coeff.
  CONSTANT  K2   1.0                ;Arsenate desorption rate coeff.

[TERMS]
  Kf     1.6e-4*Re^0.88/D           ;Mass transfer coefficient (Ft/Hr)
  Ks     K1/K2                      ;Arsenate equil. adsorption coeff.
  LPERCF 28.316                     ;Liters/Cu. Ft. (conversion for Kf)

[PIPES]
  RATE  A3    -Ka*A3*NH2CL                        ;Arsenite oxidation                                         
                                                  ;Arsenate production      
  RATE  A5    Ka*A3*NH2CL - LPERCF*Kf*Av*(A5 - A5w)                                        
                                                  ;Arsenate at pipe wall
  RATE  A5w   LPERCF*Kf*Av*(A5 - A5w) - Av*(K1*(Smax-A5s)*A5w - K2*A5s)      
  RATE  NH2CL -Kb*NH2CL                           ;Monochloramine oxidatio                                               
  EQUIL A5s   Smax*Ks*A5w/(1.0 + Ks*A5w) - A5s    ;Arsenate adsorption

[TANKS]
  RATE  A3   -Ka*A3*NH2CL                   ;Arsenite oxidation
  RATE  A5    Ka*A3*NH2CL                   ;Arsenate w/o mass tran.
  RATE  A5w   0                             ;Not present in a tank
  RATE  NH2CL -Kb*NH2CL                     ;Monochloramine oxidation

[QUALITY]
  ;Initial conditions (= 0 if not specified here)
  NODE   1      A3   10.0 
  NODE   1      A5   0.0
  NODE   1      NHCL 2.5
</pre></div>
</div>
</div>
<p><em>Note about equation units.</em> The modeler must understand the units of
all quantities used in mathematical expressions, and ensure that the
resulting expressions are dimensionally correct. In short, a complete
unit analysis for each expression and resulting RATE or EQUIL term is an
essential quality assurance step for developing MSX models. As an
example, consider <a class="reference internal" href="#equation-5-as5w">(5.8)</a> above, repeated here for convenience:</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
{d As_w^{+5} \over {d t}}= K_fA_v(As^{+5}-As_w^{+5})-A_v[k_1(S_{max}-As_s^{+5})As_w^{+5}-k_2As_s^{+5}]
\end{aligned}\]</div>
<p>The units of the left hand side are the units of the bulk species,
<span class="math notranslate nohighlight">\(As_w^{+5}\)</span>, divided by the units used for time. Since the default time
unit is hours, the left hand side has units of [<span class="math notranslate nohighlight">\(\mu g/L\mbox{-}hr\)</span>], and
consequently each of the two main terms on the right hand side must have
these same units. Since <span class="math notranslate nohighlight">\(A_v\)</span> was previously defined as the pipe
surface area per liter pipe volume, and the default area unit is
[<span class="math notranslate nohighlight">\(ft^2\)</span>], this quantity has units of [<span class="math notranslate nohighlight">\(ft^2/L\)</span>] (<span class="math notranslate nohighlight">\(A_v\)</span>
is a pre-defined MSX hydraulic variable - see the description of the
<a class="reference internal" href="index.html#terms"><span class="std std-ref">[TERMS]</span></a> input in <a class="reference internal" href="index.html#inputformat"><span class="std std-ref">INPUT FILE FORMAT</span></a> (<a class="reference internal" href="index.html#inputformat"><span class="std std-numref">Section 4</span></a>) of this manual). From this analysis we find
that the mass transfer coefficient <span class="math notranslate nohighlight">\(K_f\)</span> in the first term on the
right hand side must have units of [<span class="math notranslate nohighlight">\(L/ft^2\mbox{-}hr\)</span>]. The units of the
previous expression for <span class="math notranslate nohighlight">\(K_f\)</span> in <a class="reference internal" href="#equation-masstransfer">(5.10)</a> are, however, the more
conventional velocity units of [<span class="math notranslate nohighlight">\(ft/hr\)</span>], requiring multiplication by the
number of liters per cubic ft: <span class="math notranslate nohighlight">\([ft/hr] \times [L/ ft^3]\)</span> =
<span class="math notranslate nohighlight">\([L/ft^2\mbox{-}hr]\)</span>. This unit analysis explains the presence of the
term LPERCF in the above MSX input file; without this term the
expressions would not be dimensionally consistent and the results would
be invalid. The reader should verify that the second term on the right
hand side is dimensionally correct - given the units of <span class="math notranslate nohighlight">\(A_v\)</span>-
provided that rate coefficient <span class="math notranslate nohighlight">\(k_1\)</span> has units [<span class="math notranslate nohighlight">\(L/\mu g\mbox{-}hr\)</span>], and
<span class="math notranslate nohighlight">\(k_2\)</span> has units [<span class="math notranslate nohighlight">\(1/hr\)</span>] (recall that the surface species has units
of [<span class="math notranslate nohighlight">\(\mu g/ft^2\)</span>], since we are using the default area units).</p>
</section>
<section id="bacterial-regrowth-with-chlorine-inhibition">
<h2><em>Bacterial Regrowth with Chlorine Inhibition</em><a class="headerlink" href="#bacterial-regrowth-with-chlorine-inhibition" title="Permalink to this heading">¶</a></h2>
<p>This next example models bacterial regrowth as affected by chlorine
inhibition within a distribution system. The regrowth model is taken
from <span id="id3">Zhang <em>et al.</em> [<a class="reference internal" href="index.html#id16" title="W. Zhang, C. T. Miller, and F. A. DiGiano. Bacterial regrowth model for water distribution systems incorporating alternating split-operator solution technique. Journal of Environmental Engineering, 130:932-941, September 2004.">2004</a>]</span> and includes the following processes depicted
in <a class="reference internal" href="#figure-5-3"><span class="std std-numref">Fig. 5.3</span></a>:</p>
<figure class="align-default" id="id8">
<span id="figure-5-3"></span><img alt="_images/figure53-a.png" src="_images/figure53-a.png" />
<figcaption>
<p><span class="caption-text">Conceptual diagram of bacterial regrowth within a pipeline. Dashed arrows represent reactions with chlorine while solid arrows represent transformation processes</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<ol class="loweralpha simple">
<li><p>Both free bacteria in the bulk flow and bacteria attached to the pipe
wall utilize the biodegradable fraction of dissolved organic carbon
(BDOC and DOC, respectively) as a growth substrate. Monod kinetics
are used to describe this growth with the following rate equations:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\begin{aligned}
{{d X}\over {dt}}\bigg |_{growth} = \mu X
\end{aligned}\\\begin{aligned}
{{d S}\over {dt}} = -\mu X/Y
\end{aligned}\end{aligned}\end{align} \]</div>
<blockquote>
<div><p>where <span class="math notranslate nohighlight">\(X\)</span> is mass concentration of bacterial cells, <span class="math notranslate nohighlight">\(S\)</span> is the
concentration of BDOC, <span class="math notranslate nohighlight">\(Y\)</span> is a yield coefficient (mass of cells
produced per unit conversion of BDOC), and <span class="math notranslate nohighlight">\(\mu\)</span> is a specific growth
coefficient. The latter decreases with the BDOC concentration
according to:</p>
</div></blockquote>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\mu = {{\mu_{max}S}\over{S+K_s}}
\end{aligned}\]</div>
<blockquote>
<div><p>where <span class="math notranslate nohighlight">\(\mu_{max}\)</span> is the maximum growth rate coefficient and <span class="math notranslate nohighlight">\(K_s\)</span> is the half-saturation constant.</p>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>Both free and attached bacteria die at a first order rate:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{aligned}
{{d X}\over {dt}}\bigg |_{decay} = -k_d X
\end{aligned}\]</div>
<blockquote>
<div><p>where <span class="math notranslate nohighlight">\(k_d\)</span> is a decay rate coefficient.</p>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li><p>Deposition of free bacterial cells onto the pipe wall is modeled with
the following first-order rate process:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{aligned}
{{d X}\over {dt}}\bigg |_{deposition} = -k_{dep} X
\end{aligned}\]</div>
<blockquote>
<div><p>while detachment of attached cells into the bulk flow also depends on
flow velocity:</p>
</div></blockquote>
<div class="math notranslate nohighlight">
\[\begin{aligned}
{{d X}\over {dt}}\bigg |_{detachment} = k_{det} X U
\end{aligned}\]</div>
<blockquote>
<div><p>where <span class="math notranslate nohighlight">\(k_{dep}\)</span> is a deposition rate constant, <span class="math notranslate nohighlight">\(k_{det}\)</span> is a
detachment rate constant, and <span class="math notranslate nohighlight">\(U\)</span> is the bulk flow velocity.</p>
</div></blockquote>
<ol class="loweralpha simple" start="4">
<li><p>The effect of chlorine on limiting the number of viable bacterial
cells is modeled by applying an inhibition factor <span class="math notranslate nohighlight">\(I\)</span> to the bacterial
specific growth rate as:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{aligned}
I = exp \left ( {-(C-C_t)}\over {C_c}\right)
\end{aligned}\]</div>
<blockquote>
<div><p>Here <span class="math notranslate nohighlight">\(C\)</span> is the chlorine concentration, <span class="math notranslate nohighlight">\(C_t\)</span> is a threshold
chlorine concentration below which no inhibition occurs, and
<span class="math notranslate nohighlight">\(C_c\)</span> is a characteristic chlorine concentration that scales
the degree of inhibition. Note at higher values of <span class="math notranslate nohighlight">\(C\)</span>, <span class="math notranslate nohighlight">\(I\)</span> becomes
smaller and therefore results in smaller bacterial growth rates.</p>
</div></blockquote>
<ol class="loweralpha simple" start="5">
<li><p>Chlorine reacts with DOC in the bulk flow to decay at a first-order
rate:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{aligned}
{{d C}\over {dt}} = -k_{b} C
\end{aligned}\]</div>
<blockquote>
<div><p>where <span class="math notranslate nohighlight">\(C\)</span> is chlorine concentration and <span class="math notranslate nohighlight">\(k_b\)</span> is a bulk decay
rate coefficient.</p>
</div></blockquote>
<p>The EPANET-MSX specification of the full model is shown in Figure <a class="reference internal" href="#chloramine-inp"><span class="std std-numref">Listing 5.3</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="chloramine-inp">
<div class="code-block-caption"><span class="caption-text">MSX input file for a bacterial regrowth model with chlorine inhibition</span><a class="headerlink" href="#chloramine-inp" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[OPTIONS]
AREA_UNITS  CM2
RATE_UNITS  HR
SOLVER      RK5
TIMESTEP    300

[SPECIES]
BULK   CL2   MG          ;chlorine
BULK   S     MG          ;organic substrate
BULK   Xb    UG          ;mass of free bacteria
WALL   Xa    UG          ;mass of attached bacteria
BULK   Nb    log(N)      ;number of free bacteria
WALL   Na    log(N)      ;number of attached bacteria

[COEFFICIENTS]
CONSTANT  Kb      0.05   ;CL2 decay constant (1/hr)
CONSTANT  CL2C    0.20   ;characteristic CL2 (mg/L)
CONSTANT  CL2Tb   0.03   ;threshold CL2 for Xb (mg/L)
CONSTANT  CL2Ta   0.10   ;threshold CL2 for Xa (mg/L)
CONSTANT  MUMAXb  0.20   ;max. growth rate for Xb (1/hr)
CONSTANT  MUMAXa  0.20   ;max. growth rate for Xa (1/hr)
CONSTANT  Ks      0.40   ;half saturation constant (mg/L)
CONSTANT  Kdet    0.03   ;detachment rate constant (1/hr/(ft/s))
CONSTANT  Kdep    0.08   ;deposition rate constant (1/hr)
CONSTANT  Kd      0.06   ;bacterial decay constant (1/hr)
CONSTANT  Yg      0.15   ;bacterial yield coefficient (mg/mg)

[TERMS]
Ib   EXP(-STEP(CL2-CL2Tb)*(CL2-CL2Tb)/CL2C) ;Xb inhibition coeff. 
Ia   EXP(-STEP(CL2-CL2Ta)*(CL2-CL2Ta)/CL2C) ;Xa inhibition coeff.
MUb  MUMAXb*S/(S+Ks)*Ib                     ;Xb growth rate coeff.
MUa  MUMAXa*S/(S+Ks)*Ia                     ;Xa growth rate coeff.

[PIPES]
RATE    CL2    -Kb*CL2
RATE    S      -(MUa*Xa*Av + MUb*Xb)/Yg/1000
RATE    Xb     (MUb-Kd)*Xb + Kdet*Xa*U*Av - Kdep*Xb
RATE    Xa     (MUa-Kd)*Xa - Kdet*Xa*U + Kdep*Xb/Av
FORMULA Nb     LOG10(1.0e6*Xb)
FORMULA Na     LOG10(1.0e6*Xa)

[TANKS]
RATE    CL2    -Kb*CL2
RATE    S      -MUb*Xb/Yg/1000
RATE    Xb     (MUb-Kd)*Xb
FORMULA Nb     LOG10(1.0e6*Xb)

[SOURCES]
CONCEN  SrcNode  CL2  1.2
CONCEN  SrcNode  S    0.4
CONCEN  SrcNode  Xb   0.01
</pre></div>
</div>
</div>
<p>Several notes of explanation require mentioning:</p>
<ol class="arabic simple">
<li><p>There are six species defined for the model: bulk chlorine (CL2),
bulk biodegradable dissolved organic carbon (S), bulk bacterial
concentration (Xb), bulk bacterial cell count (Nb), attached
bacterial concentration (Xa), and attached bacterial cell count
(Na). CL2 and S are measured in milligrams. The bacterial
concentrations are expressed in micrograms of equivalent carbon so
that their numerical values scale more evenly. The bacterial cell
counts are expressed as the logarithm of the number of cells.</p></li>
<li><p>The entries in the [PARAMETERS] section are based on values provided
by <span id="id4">Zhang <em>et al.</em> [<a class="reference internal" href="index.html#id16" title="W. Zhang, C. T. Miller, and F. A. DiGiano. Bacterial regrowth model for water distribution systems incorporating alternating split-operator solution technique. Journal of Environmental Engineering, 130:932-941, September 2004.">2004</a>]</span> and are used only for illustrative purposes.</p></li>
<li><p>The [TERMS] section allows one to define intermediate mathematical
terms in the model’s description so that the rate equations can be
expressed more clearly and compactly.</p></li>
<li><p>The chlorine inhibition threshold concentration is lower for the
bulk phase than for the surface phase. This results in defining
separate inhibition factors, Ib and Ia for these two phases,
respectively.</p></li>
<li><p>The special EPANET-MSX function STEP(x) used in the definitions of
the inhibition factors Ib and Ia is internally evaluated to 1 when
x &gt; 0 and is 0 otherwise.</p></li>
<li><p>The variables U and Av are reserved symbols in EPANET-MSX that
represent flow velocity and pipe surface area per unit volume,
respectively, and their values are automatically computed by the
program.</p></li>
<li><p>Whenever the surface biomass species appears in the rate expression
for a bulk species it is multiplied by Av to convert from areal
density to volumetric concentration. Likewise, the bulk biomass
concentration is divided by Av in the rate expression for attached
biomass to convert it to an areal density.</p></li>
<li><p>The kinetic rate expressions for tanks do not include any terms
involving Xa since it is assumed that surface species do not exist
(or have reduced significance) within storage facilities.</p></li>
<li><p>A simple FORMULA expression is used to convert from micrograms of
bacterial carbon to logarithmic cell counts. It assumes that there
are <span class="math notranslate nohighlight">\(10^6\)</span> cells per microgram of carbon in the cell biomass.</p></li>
<li><p>The model assumes that there is a single source node named SrcNode
that supplies all water to the system. The [SOURCES] section
specifies the concentrations of chlorine, biodegradable carbon, and
bulk bacterial concentration in this water. The latter value was
derived from assuming that the treated source water contained 10
cells/mL (i.e., <span class="math notranslate nohighlight">\(10^4\)</span> cells per liter).</p></li>
</ol>
</section>
<section id="chloramine-decomposition">
<h2><em>Chloramine Decomposition</em><a class="headerlink" href="#chloramine-decomposition" title="Permalink to this heading">¶</a></h2>
<p>This final example illustrates a complex chemical reaction system
involving both kinetic rate expressions and nonlinear equilibrium
relationships. The system being studied is the auto-decomposition of
monochloramine to ammonia in the presence of natural organic matter
(NOM). When chloramines are used as a secondary disinfectant care must
be taken to avoid producing excessive amounts of free ammonia that can
contribute to biological nitrification episodes within the distribution
system. The reaction model used for this system was developed by
Valentine and co-workers <span id="id5">[<a class="reference internal" href="index.html#id14" title="S.E. Duirk, B. Gombert, J-P. Croue, and R.L. Valentine. Modeling monochloramine loss in the presence of natural organic matter. Water Research, 39:3418-3431, September 2005.">Duirk <em>et al.</em>, 2005</a>, <a class="reference internal" href="index.html#id15" title="P.J. Vikesland, K. Ozekin, and R.L. Valentine. Monochloramine decay in model and distribution system waters. Water Research, 35:1766-1776, May 2001.">Vikesland <em>et al.</em>, 2001</a>]</span>
and is shown in Table <a class="reference internal" href="#table-monochloramine"><span class="std std-numref">Table 5.1</span></a>. The principal species are hypochlorous acid
(HOCl), hypochlorite ion (OCL<sup>-</sup>), ammonia (NH<sub>3</sub>),
ammonium ion (NH<sub>4</sub><sup>+</sup>), monochloramine
(NH<sub>2</sub>Cl), dichloramine (NHCl<sub>2</sub>), an unidentified
intermediate compound (I), and total organic carbon (TOC). Because the
reactions involve acid-base dissociations and the rate coefficient of
the disproportionation of NH<sub>2</sub>Cl is a function of both pH and
carbonate species, the pH-carbonate equilibrium system is also included.</p>
<p><a class="reference internal" href="#ex-monochloramine-inp"><span class="std std-numref">Listing 5.4</span></a> shows the EPANET-MSX specification of the monochloramine
decay model. There are 14 bulk species and no surface species. The entries in the [COEFFICIENTS] section are
the rate coefficients <span class="math notranslate nohighlight">\(k_1\)</span> through <span class="math notranslate nohighlight">\(k_{12}\)</span> listed in <a class="reference internal" href="#table-monochloramine"><span class="std std-numref">Table 5.1</span></a>. The expression for <span class="math notranslate nohighlight">\(k_5\)</span>
as a function of pH and carbonate species is included in the [TERMS]
section, as are the rate terms contributed by the reactants of reactions
1 through 12 in <a class="reference internal" href="#table-monochloramine"><span class="std std-numref">Table 5.1</span></a>. Because there are no surface species in the
model, the reaction expressions listed in the [PIPES] section apply to
the storage tanks as well.</p>
<p>The first five rate expressions apply to the various chlorinated
species, ammonia, and the un-named intermediate compound. The next three
rate expressions, all set equal to 0, state that pH, alkalinity, and TOC
are assumed to remain constant. These are followed by two equilibrium
expressions that represent the dissociation reactions of hypochlorous
acid and ammonia, respectively. The final set of four equilibrium
expressions model the distribution of the various carbonate species
under conditions of constant alkalinity and pH. Note that in order to
solve this carbonate equilibrium sub-system it is necessary to supply
initial values for pH and alkalinity at all nodes of whatever network is
being modeled. This is done in the [QUALITY] section, using the GLOBAL
specifier to set values throughout the network. (The alkalinity of 0.004
moles/L is equivalent to 200 <span class="math notranslate nohighlight">\(mg/L\)</span> CaCO<sub>3</sub> while the
H<sup>+</sup> value of <span class="math notranslate nohighlight">\(2.818 \times 10^{-8}\)</span> moles/L is the same as a pH of
7.75.)</p>
<span id="table-monochloramine"></span><table class="docutils align-default" id="id9">
<caption><span class="caption-text">Monochloramine decay model based on Vikesland et al. (2001) and Duirk et al. (2005).</span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 5%" />
<col style="width: 47%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p><em>Reaction Stoichiometry</em></p></th>
<th class="head"><p><em>Rate Coefficient/Equilibrium Constant</em><sup>a</sup></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>R.1</p></td>
<td><p>HOCl + NH<sub>3</sub> <span class="math notranslate nohighlight">\(\rightarrow\)</span>
NH<sub>2</sub>Cl + H<sub>2</sub>O</p></td>
<td><p><span class="math notranslate nohighlight">\(k_1=1.5 \times 10^{10} M^{-1}h^{-1}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>R.2</p></td>
<td><p>NH<sub>2</sub>Cl + H<sub>2</sub>O
<span class="math notranslate nohighlight">\(\rightarrow\)</span> HOCl + NH<sub>3</sub></p></td>
<td><p><span class="math notranslate nohighlight">\(k_2=7.6 \times 10^{-2}\,h^{-1}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>R.3</p></td>
<td><p>HOCl + NH<sub>2</sub>Cl <span class="math notranslate nohighlight">\(\rightarrow\)</span>
NHCl<sub>2</sub> + H<sub>2</sub>O</p></td>
<td><p><span class="math notranslate nohighlight">\(k_3=1.0 \times 10^{6}M^{-1}\,h^{-1}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>R.4</p></td>
<td><p>NHCl<sub>2</sub> + H<sub>2</sub>O
<span class="math notranslate nohighlight">\(\rightarrow\)</span> HOCl + NH<sub>2</sub>Cl</p></td>
<td><p><span class="math notranslate nohighlight">\(k_4=2.3 \times 10^{-3}\,h^{-1}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>R.5</p></td>
<td><p>NH<sub>2</sub>Cl + NH<sub>2</sub>Cl
<span class="math notranslate nohighlight">\(\rightarrow\)</span> NHCl<sub>2</sub> + NH<sub>3</sub></p></td>
<td><p><span class="math notranslate nohighlight">\(k_5=2.5 \times 10^{7}[H^{+}]+4.0 \times 10^{4}[H_2CO_3]
+800[HCO_3^{-}]\,M^{-2}h^{-1}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>R.6</p></td>
<td><p>NHCl<sub>2</sub> + NH<sub>3</sub> <span class="math notranslate nohighlight">\(\rightarrow\)</span>
NH<sub>2</sub>Cl + NH<sub>2</sub>Cl</p></td>
<td><p><span class="math notranslate nohighlight">\(k_6=2.2 \times 10^{8}\,M^{-2}h^{-1}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>R.7</p></td>
<td><p>NHCl<sub>2</sub> + H<sub>2</sub>O <span class="math notranslate nohighlight">\(\rightarrow\)</span> I</p></td>
<td><p><span class="math notranslate nohighlight">\(k_7=4.0 \times 10^{5}\,M^{-1}h^{-1}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>R.8</p></td>
<td><p>I + NHCl<sub>2</sub> <span class="math notranslate nohighlight">\(\rightarrow\)</span> HOCl + products</p></td>
<td><p><span class="math notranslate nohighlight">\(k_8=1.0 \times 10^{8}\,M^{-1}h^{-1}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>R.9</p></td>
<td><p>I + NH<sub>2</sub>Cl <span class="math notranslate nohighlight">\(\rightarrow\)</span> products</p></td>
<td><p><span class="math notranslate nohighlight">\(k_9=3.0 \times 10^{7}\,M^{-1}h^{-1}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>R.10</p></td>
<td><p>NH<sub>2</sub>Cl + NHCl<sub>2</sub> <span class="math notranslate nohighlight">\(\rightarrow\)</span>
products</p></td>
<td><p><span class="math notranslate nohighlight">\(k_{10}=55.0\,M^{-1}h^{-1}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>R.11</p></td>
<td><p>NH2Cl + S<sub>1</sub><span class="math notranslate nohighlight">\(\times\)</span>
TOC <span class="math notranslate nohighlight">\(\rightarrow\)</span> products<sup>b</sup></p></td>
<td><p><span class="math notranslate nohighlight">\(k_{11}=3.0 \times 10^{4}\,M^{-1}h^{-1}\)</span></p>
<p><span class="math notranslate nohighlight">\(S_1\)</span> = 0.02</p>
</td>
</tr>
<tr class="row-odd"><td><p>R.12</p></td>
<td><p>HOCl + S<sub>2</sub><span class="math notranslate nohighlight">\(\times\)</span>
TOC <span class="math notranslate nohighlight">\(\rightarrow\)</span> products<sup>c</sup></p></td>
<td><p><span class="math notranslate nohighlight">\(k_{12}=6.5 \times 10^{5}\,M^{-1}h^{-1}\)</span></p>
<p><span class="math notranslate nohighlight">\(S_2\)</span> = 0.5</p>
</td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>E.1</p></td>
<td><p>HOCl <span class="math notranslate nohighlight">\(\leftrightarrow\)</span> H<sup>+</sup> + OCl<sup>-</sup></p></td>
<td><p><span class="math notranslate nohighlight">\(pK_a\)</span> = 7.5</p></td>
</tr>
<tr class="row-even"><td><p>E.2</p></td>
<td><p>NH<sub>4</sub><sup>+</sup> <span class="math notranslate nohighlight">\(\leftrightarrow\)</span>
NH<sub>3</sub> + H<sup>+</sup></p></td>
<td><p><span class="math notranslate nohighlight">\(pK_a\)</span> = 9.3</p></td>
</tr>
<tr class="row-odd"><td><p>E.3</p></td>
<td><p>H<sub>2</sub>CO<sub>3</sub> <span class="math notranslate nohighlight">\(\leftrightarrow\)</span>
HCO<sub>3</sub><sup>-</sup> +
H<sup>+</sup></p></td>
<td><p><span class="math notranslate nohighlight">\(pK_a\)</span> = 6.3</p></td>
</tr>
<tr class="row-even"><td><p>E.4</p></td>
<td><p>HCO<sub>3</sub><sup>-</sup> <span class="math notranslate nohighlight">\(\leftrightarrow\)</span>
CO<sub>3</sub><sup>2-</sup> +
H<sup>+</sup></p></td>
<td><p><span class="math notranslate nohighlight">\(pK_a\)</span> = 10.3</p></td>
</tr>
</tbody>
</table>
<p><span class="math notranslate nohighlight">\(\ \ \ \ \)</span> Notes:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>All rate coefficients and equilibrium constants are for 25 degrees C.</p></li>
<li><p><span class="math notranslate nohighlight">\(S_1\)</span> is the fast reactive fraction of TOC.</p></li>
<li><p><span class="math notranslate nohighlight">\(S_2\)</span> is the slow reactive fraction of TOC.</p></li>
</ol>
</div></blockquote>
<div class="literal-block-wrapper docutils container" id="ex-monochloramine-inp">
<div class="code-block-caption"><span class="caption-text">EPANET-MSX input file of the monochloramine decomposition model</span><a class="headerlink" href="#ex-monochloramine-inp" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[OPTIONS]
RATE_UNITS  HR
SOLVER      ROS2
COUPLING    NONE
TIMESTEP    300
RTOL        0.0001
ATOL        1.0e-8

[SPECIES]
BULK   HOCL    MOLES    ;hypochlorous acid
BULK   NH3     MOLES    ;ammonia
BULK   NH2CL   MOLES    ;monochloramine
BULK   NHCL2   MOLES    ;dichloramine
BULK   I       MOLES    ;unknown intermediate
BULK   OCL     MOLES    ;hypochlorite ion
BULK   NH4     MOLES    ;ammonium ion
BULK   ALK     MOLES    ;total alkalinity
BULK   TOC     MOLES    ;total organic carbon
BULK   H       MOLES    ;hydrogen ion
BULK   OH      MOLES    ;hydroxide ion
BULK   CO3     MOLES    ;carbonate ion
BULK   HCO3    MOLES    ;bicarbonate ion
BULK   H2CO3   MOLES    ;dissolved carbon dioxide

[COEFFICIENTS]
PARAMETER       k1    1.5e10
PARAMETER       k2    7.6e-2
PARAMETER       k3    1.0e6
PARAMETER       k4    2.3e-3
PARAMETER       k6    2.2e8
PARAMETER       k7    4.0e5
PARAMETER       k8    1.0e8
PARAMETER       k9    3.0e7
PARAMETER       k10   55.0

PARAMETER       k11   3.0E4
PARAMETER       k12   6.5E5
CONSTANT        S1    0.02
CONSTANT        S2    0.50

[TERMS]
k5     (2.5e7*H) + (4.0e4*H2CO3) + (800*HCO3)
a1     k1*HOCL*NH3
a2     k2*NH2CL
a3     k3*HOCL*NH2CL
a4     k4*NHCL2
a5     k5*NH2CL*NH2CL
a6     k6*NHCL2*NH3*H
a7     k7*NHCL2*OH
a8     k8*I*NHCL2
a9     k9*I*NH2CL
a10    k10*NH2CL*NHCL2
a11    k11*S1*TOC*NH2CL
a12    k12*S2*TOC*HOCL

[PIPES]
RATE   HOCL    -a1 + a2 - a3 + a4 + a8 – a12
RATE   NH3     -a1 + a2 + a5 - a6 + a11
RATE   NH2CL    a1 - a2 - a3 + a4 - a5 + a6 - a9 - a10 – a11
RATE   NHCL2    a3 - a4 + a5 - a6 - a7 - a8 - a10
RATE   I        a7 - a8 - a9
RATE   H        0
RATE   ALK      0
RATE   TOC      0
EQUIL  OCL      H*OCL - 3.16E-8*HOCL
EQUIL  NH4      H*NH3 - 5.01E-10*NH4
EQUIL  CO3      H*CO3 - 5.01E-11*HCO3
EQUIL  H2CO3    H*HCO3 - 5.01E-7*H2CO3
EQUIL  HCO3     ALK - HCO3 - 2*CO3 - OH + H
EQUIL  OH       H*OH - 1.0E-14

[QUALITY]
GLOBAL       ALK   0.004
GLOBAL       H     2.818E-8
</pre></div>
</div>
</div>
</section>
</section>
<span id="document-reference"></span><section id="bibliography">
<h1>BIBLIOGRAPHY<a class="headerlink" href="#bibliography" title="Permalink to this heading">¶</a></h1>
</section>
<div class="docutils container" id="id1">
<dl class="citation">
<dt class="label" id="id12"><span class="brackets">1</span></dt>
<dd><p>H. A. Basha and L. N. Malaeb. Eulerian-lagrangain method for constituent transport in water distribution networks. <em>Journal of Hydraulic Engineering</em>, 133:1155–1166, October 2007.</p>
</dd>
<dt class="label" id="id14"><span class="brackets">2</span></dt>
<dd><p>S.E. Duirk, B. Gombert, J-P. Croue, and R.L. Valentine. Modeling monochloramine loss in the presence of natural organic matter. <em>Water Research</em>, 39:3418–3431, September 2005.</p>
</dd>
<dt class="label" id="id7"><span class="brackets">3</span></dt>
<dd><p>G. H. Golub and J. M. Ortega. <em>Scientific computing and ordinary differential equations</em>. Academic Press, 1992.</p>
</dd>
<dt class="label" id="id5"><span class="brackets">4</span></dt>
<dd><p>B. Gu, J. Schmitt, Z. Chen, L. Liang, and J.F. McCarthy. Adsorption and desorption of natural organic matter on iron oxide: mechanisms and models. <em>Environ. Sci. Technol.</em>, 28:38–46, January 1994.</p>
</dd>
<dt class="label" id="id6"><span class="brackets">5</span></dt>
<dd><p>E. Hairer, S.P. Norsett, and G. Warner. <em>Solving Ordinary Differential Equations I. Nonstiff Problems</em>. Springer Series in Computational Mathematics. Springer-Verlag, 2 edition, 1993.</p>
</dd>
<dt class="label" id="id4"><span class="brackets">6</span></dt>
<dd><p>D.C. Koopman, J.V. Cole, and H.H. Lee. Assumption of local equilibrium in adsorption processes. <em>AIChE Journal</em>, 38:623–625, April 1992.</p>
</dd>
<dt class="label" id="id13"><span class="brackets">7</span></dt>
<dd><p>Y. Lee. <em>Mass dispersion in intermittent laminar flow</em>. PhD thesis, University of Cincinnati, Cincinnati, Ohio, USA, 2004.</p>
</dd>
<dt class="label" id="id2"><span class="brackets">8</span></dt>
<dd><p>W.H. Press, B.P. Flannery, S.A. Teukolsky, and W.T. Vetterling. <em>Numerical Recipes in C</em>. Cambridge University Press, 2nd edition, 1992.</p>
</dd>
<dt class="label" id="id10"><span class="brackets">9</span></dt>
<dd><p>L. A. Rossman. The epanet programmer's toolkit for analysis of water distribution systems. In <em>Proc. 26th Annual Water Resources Planning and Management Conference</em>. Reston, VA, 1999. American Society of Civil Engineers.</p>
</dd>
<dt class="label" id="id8"><span class="brackets">10</span></dt>
<dd><p>L. A. Rossman. <em>EPANET 2 Users Manual</em>. U.S. Environmental Protection Agency, Cincinnati, OH, 2000.</p>
</dd>
<dt class="label" id="id9"><span class="brackets">11</span></dt>
<dd><p>L. A. Rossman, H. Woo, M. Tryby, F. Shang, R. Janke, and T. Haxton. <em>EPANET 2.2 Users Manual</em>. U.S. Environmental Protection Agency, Cincinnati, OH, 2020.</p>
</dd>
<dt class="label" id="id11"><span class="brackets">12</span></dt>
<dd><p>F. Shang, H. Woo, J. B. Burkhardt, and R. Murray. Lagrangian method to model advection-dispersion-reaction transport in drinking water pipe networks. <em>Journal of Water Resources Planning and Management</em>, September 2021.</p>
</dd>
<dt class="label" id="id3"><span class="brackets">13</span></dt>
<dd><p>J.G. Verwer, E.J. Spee, J.G. Blom, and W.H. Hundsdorfer. A second order rosenbrock method applied to photochemical dispersion problems. <em>SIAM Journal on Scientific Computing</em>, 20:1456–1480, 1992.</p>
</dd>
<dt class="label" id="id15"><span class="brackets">14</span></dt>
<dd><p>P.J. Vikesland, K. Ozekin, and R.L. Valentine. Monochloramine decay in model and distribution system waters. <em>Water Research</em>, 35:1766–1776, May 2001.</p>
</dd>
<dt class="label" id="id16"><span class="brackets">15</span></dt>
<dd><p>W. Zhang, C. T. Miller, and F. A. DiGiano. Bacterial regrowth model for water distribution systems incorporating alternating split-operator solution technique. <em>Journal of Environmental Engineering</em>, 130:932–941, September 2004.</p>
</dd>
</dl>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-back_matter"></span><section id="msx-toolkit-functions">
<span id="sectoolkit"></span><h1>MSX TOOLKIT FUNCTIONS<a class="headerlink" href="#msx-toolkit-functions" title="Permalink to this heading">¶</a></h1>
<p>The EPANET-MSX toolkit is a library of functions that programmers can
use to create their own custom versions of the multi-species extension
of EPANET. The MSX functions are used in conjunction with the standard
EPANET toolkit functions <span id="id1">[<a class="reference internal" href="index.html#id10" title="L. A. Rossman. The epanet programmer's toolkit for analysis of water distribution systems. In Proc. 26th Annual Water Resources Planning and Management Conference. Reston, VA, 1999. American Society of Civil Engineers.">Rossman, 1999</a>]</span> which can also provide additional flexibility
for programmers. Information on using the standard EPANET toolkit is
available through a Windows Help file named TOOLKIT.HLP that is part of
the EN2toolkit.zip file available at the web site
<a class="reference external" href="https://www.epa.gov/water-research/epanet">https://www.epa.gov/water-research/epanet</a>.
<a class="reference internal" href="#t-toolkit1"><span class="std std-numref">Table 1</span></a>, <a class="reference internal" href="#t-toolkit2"><span class="std std-numref">Table 2</span></a>, and <a class="reference internal" href="#t-toolkit3"><span class="std std-numref">Table 3</span></a> list the name of each MSX toolkit function
along with a brief description of its purpose.</p>
<p>These functions reside in a Windows Dynamic Link Library (DLL) named
<em>epanetmsx.dll</em> and can be used in any programming language that can
access DLLs, such as C/C++, Delphi Pascal, Visual Basic, and MatLab. The
toolkit also includes special header files that must be included in any
program modules that reference the MSX functions. These header files are
named <em>epanetmsx.h</em> for C/C++ programs, <em>epanetmsx.pas</em> for Delphi
programs, and <em>epanetmsx.bas</em> for Visual Basic programs.</p>
<p>Prior to using any of the MSX toolkit functions a standard EPANET input
file must be opened using the <em>ENopen</em> function from the standard EPANET
toolkit DLL, <em>epanet2.dll</em>. In addition, after all processing is
completed the <em>ENclose</em> function from the standard toolkit must be
called. Thus the header files for the standard toolkit (<em>epanet2.h</em>,
<em>epanet2.pas</em>, or <em>epanet2.bas</em>) must also be included in the
application’s code. Finally, if a stand-alone command line executable is
being produced from C/C++ then the LIB files <em>epanet2.lib</em> and
<em>epanetmsx.lib</em> must be linked in when the compiled source files are
linked together. (Note: The LIB files supplied with the EPANET-MSX
distribution are compatible with the Microsoft C/C++ compiler version 6
and higher.)</p>
<p>The following pages provide a description of each toolkit function using
C/C++ syntax to represent argument variables and return types.</p>
<span id="t-toolkit1"></span><table class="docutils align-default" id="id2">
<caption><span class="caption-text">EPANET-MSX toolkit processing functions</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Function Name</strong></p></th>
<th class="head"><p><strong>Purpose</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MSXopen</p></td>
<td><p>Opens the EPANET-MSX toolkit system.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXclose</p></td>
<td><p>Closes the EPANET-MSX toolkit system.</p></td>
</tr>
<tr class="row-even"><td><p>MSXsolveH</p></td>
<td><p>Solves for system hydraulics over the entire
simulation period, saving results to an
internal scratch file.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXusehydfile</p></td>
<td><p>Uses a previously saved EPANET hydraulics file
as the source of hydraulic information.</p></td>
</tr>
<tr class="row-even"><td><p>MSXsolveQ</p></td>
<td><p>Solves for water quality over the entire
simulation period and saves the results to an
internal scratch file.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXinit</p></td>
<td><p>Initializes the MSX system before solving for
water quality results in a step-wise fashion.</p></td>
</tr>
<tr class="row-even"><td><p>MSXstep</p></td>
<td><p>Advances the water quality solution through a
single water quality time step when performing
a step-wise simulation.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXsaveoutfile</p></td>
<td><p>Saves water quality results computed for each
node, link and reporting time period to a named
binary file.</p></td>
</tr>
<tr class="row-even"><td><p>MSXsavemsxfile</p></td>
<td><p>Saves the data associated with the current MSX
project into a new MSX input file.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXreport</p></td>
<td><p>Writes water quality simulations results as
instructed by the MSX input file to a text
file.</p></td>
</tr>
</tbody>
</table>
<span id="t-toolkit2"></span><table class="docutils align-default" id="id3">
<caption><span class="caption-text">EPANET-MSX toolkit data retrieval functions</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Function Name</strong></p></th>
<th class="head"><p><strong>Purpose</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MSXgetindex</p></td>
<td><p>Retrieves the internal index number of an MSX
object given its ID name.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXgetIDlen</p></td>
<td><p>Retrieves the number of characters in the ID
name of an MSX object given its internal index
number.</p></td>
</tr>
<tr class="row-even"><td><p>MSXgetID</p></td>
<td><p>Retrieves the ID name of an MSX object given
its internal index number.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXgetcount</p></td>
<td><p>Retrieves the number of objects of a specific
type.</p></td>
</tr>
<tr class="row-even"><td><p>MSXgetspecies</p></td>
<td><p>Retrieves the attributes of a chemical species
given its internal index number.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXgetinitqual</p></td>
<td><p>Retrieves the initial concentration of a
particular chemical species assigned to a
specific node or link of the pipe network.</p></td>
</tr>
<tr class="row-even"><td><p>MSXgetqual</p></td>
<td><p>Retrieves the concentration of a chemical
species at a specific node or link of the
network at the current simulation time step.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXgetconstant</p></td>
<td><p>Retrieves the value of a particular reaction
constant.</p></td>
</tr>
<tr class="row-even"><td><p>MSXgetparameter</p></td>
<td><p>Retrieves the value of a particular reaction
parameter for a given pipe or tank within the
pipe network.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXgetsource</p></td>
<td><p>Retrieves information on any external source of
a particular chemical species assigned to a
specific node of the pipe network.</p></td>
</tr>
<tr class="row-even"><td><p>MSXgetpatternlen</p></td>
<td><p>Retrieves the number of time periods within a
source time pattern.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXgetpatternvalue</p></td>
<td><p>Retrieves the multiplier at a specific time
period for a given source time pattern.</p></td>
</tr>
<tr class="row-even"><td><p>MSXgeterror</p></td>
<td><p>Returns the text for an error message given its
error code.</p></td>
</tr>
</tbody>
</table>
<span id="t-toolkit3"></span><table class="docutils align-default" id="id4">
<caption><span class="caption-text">EPANET-MSX data modification functions</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Function Name</strong></p></th>
<th class="head"><p><strong>Purpose</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MSXsetconstant</p></td>
<td><p>Assigns a new value to a specific reaction
constant.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXsetparameter</p></td>
<td><p>Assigns a value to a particular reaction
parameter for a given pipe or tank within the
pipe network.</p></td>
</tr>
<tr class="row-even"><td><p>MSXsetinitqual</p></td>
<td><p>Assigns an initial concentration of a
particular chemical species to a specific node
or link of the pipe network.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXsetsource</p></td>
<td><p>Sets the attributes of an external source of a
particular chemical species to a specific node
of the pipe network.</p></td>
</tr>
<tr class="row-even"><td><p>MSXsetpattern</p></td>
<td><p>Assigns a new set of multipliers to a given MSX
source time pattern.</p></td>
</tr>
<tr class="row-odd"><td><p>MSXsetpatternvalue</p></td>
<td><p>Assigns a new value to the multiplier for a
specific time period in a given MSX source time
pattern.</p></td>
</tr>
<tr class="row-even"><td><p>MSXaddpattern</p></td>
<td><p>Adds a new, empty MSX source time pattern to
the project.</p></td>
</tr>
</tbody>
</table>
<section id="msxopen">
<h2>MSXopen<a class="headerlink" href="#msxopen" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXopen(char * f);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Opens the EPANET-MSX toolkit system.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>f is a C-style character string containing the name of an EPANET-MSX input file.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>The standard EPANET toolkit function ENopen must have been called
first to open the EPANET toolkit along with an associated EPANET
input file for the network being analyzed as well as to identify the
name of a report file to which results are written.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">//Open the EPANET toolkit</span>

<span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENopen</span><span class="p">(</span><span class="s">&quot;example1.inp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;example1.rpt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Open the MSX toolkit</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXopen</span><span class="p">(</span><span class="s">&quot;example1.msx&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Add code to perform required analyses here</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"></span>

<span class="c1">//Don&#39;t forget to close the toolkits</span>

<span class="n">MSXclose</span><span class="p">();</span><span class="w"></span>

<span class="n">ENclose</span><span class="p">();</span><span class="w"></span>

<span class="n">exit</span><span class="p">(</span><span class="n">err</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxclose">
<h2>MSXclose<a class="headerlink" href="#msxclose" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXclose(void);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Closes the EPANET-MSX toolkit system.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>None.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>The EPANET toolkit function ENclose should be called at some point
after calling MSXclose to close the EPANET toolkit system.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">//Open the EPANET toolkit</span>

<span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENopen</span><span class="p">(</span><span class="s">&quot;example1.inp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;example1.rpt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Open the MSX toolkit</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXopen</span><span class="p">(</span><span class="s">&quot;example1.msx&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Add code to perform required analyses here</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"></span>

<span class="c1">//Don&#39;t forget to close both toolkits</span>

<span class="n">MSXclose</span><span class="p">();</span><span class="w"></span>

<span class="n">ENclose</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxsolveh">
<h2>MSXsolveH<a class="headerlink" href="#msxsolveh" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXsolveH(void);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Solves for system hydraulics over the entire simulation period and saves
results to an internal scratch file.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>None.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>Either this function or MSXusehydfile (see below) must be called
before any water quality processing is performed.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENopen</span><span class="p">(</span><span class="s">&quot;example1.inp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;example1.rpt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">MSXopen</span><span class="p">(</span><span class="s">&quot;example1.msx&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Solve for hydraulics</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXsolveH</span><span class="p">();</span><span class="w"></span>

<span class="c1">//Perform water quality analysis starting here</span>

<span class="p">...</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxusehydfile">
<h2>MSXusehydfile<a class="headerlink" href="#msxusehydfile" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXusehydfile(char * f);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Uses a previously saved EPANET hydraulics file as the source of
hydraulic information.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>f is a C-style character string containing the name of a previously
saved hydraulics file for the system being analyzed.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>Either this function or MSXsolveH (see above) must be called before
any water quality processing is performed.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Open the EPANET toolkit</span>

<span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENopen</span><span class="p">(</span><span class="s">&quot;example1.inp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;example1.rpt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Use EPANET to solve &amp; save hydraulic results</span>

<span class="n">ENsolveH</span><span class="p">();</span><span class="w"></span>

<span class="n">ENsavehydfile</span><span class="p">(</span><span class="s">&quot;example1.hyd&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Open the MSX toolkit</span>

<span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXopen</span><span class="p">(</span><span class="s">&quot;example1.msx&quot;</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Utilize the hydraulic solution just saved to file</span>

<span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXusehydfile</span><span class="p">(</span><span class="s">&quot;example1.hyd&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Perform water quality analysis starting here</span>

<span class="p">...</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxsolveq">
<h2>MSXsolveQ<a class="headerlink" href="#msxsolveq" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXsolveQ(void);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Solves for water quality over the entire simulation period and saves the results to an internal scratch file.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>None.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>This function does not allow access to computed water quality results
as the simulation unfolds. If such information is required, use
MSXinit in conjunction with step-wise calls to MSXstep (see below).</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENopen</span><span class="p">(</span><span class="s">&quot;example1.inp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;example1.rpt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXopen</span><span class="p">(</span><span class="s">&quot;example1.msx&quot;</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Solve for hydraulics &amp; water quality</span>

<span class="n">MSXsolveH</span><span class="p">();</span><span class="w"></span>

<span class="n">MSXsolveQ</span><span class="p">();</span><span class="w"></span>

<span class="c1">//Report results</span>

<span class="n">MSXreport</span><span class="p">();</span><span class="w"></span>

<span class="c1">//Close the toolkits</span>

<span class="n">MSXclose</span><span class="p">();</span><span class="w"></span>

<span class="n">ENclose</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxinit">
<h2>MSXinit<a class="headerlink" href="#msxinit" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXinit(int saveFlag);
</pre></div>
</div>
</div></blockquote>
<p><strong>Purpose:</strong></p>
<blockquote>
<div><p>Initializes the MSX system before solving for water quality results
in step-wise fashion.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>Set saveFlag to 1 if water quality results should be saved to a
scratch binary file, or to 0 if results are not saved to file.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>This function must be called before a step-wise water quality
simulation is performed using MSXstep. Do not call this function if
performing a complete simulation using MSXsolveQ.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><p>See the example provided for MSXstep.</p>
</div></blockquote>
</section>
<section id="msxstep">
<h2>MSXstep<a class="headerlink" href="#msxstep" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXstep(double * t, double * tleft);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Advances the water quality solution through a single water quality
time step when performing a step-wise simulation.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>Upon returning, t will contain the current simulation time at the end
of the step (in seconds) while tleft will contain the time left in
the simulation (also in seconds).</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>This function should be placed in a loop that repeats until the value
of tleft becomes 0. MSXinit should be called before beginning the
loop.</p>
<p>The water quality time step used by this function is specified in the
<a class="reference internal" href="index.html#options"><span class="std std-ref">[OPTIONS]</span></a> section of the MSX input file.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare time variables</span>

<span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">tleft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Solve for hydraulics</span>

<span class="n">MSXsolveH</span><span class="p">();</span><span class="w"></span>

<span class="c1">//Run a water quality simulation</span>

<span class="n">MSXinit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXstep</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tleft</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">//Use MSXgetqual to retrieve results at time t</span>

<span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">tleft</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxsaveoutfile">
<h2>MSXsaveoutfile<a class="headerlink" href="#msxsaveoutfile" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXsaveoutfile(char * f);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Saves water quality results computed for each node, link and reporting time period to a named binary file.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>f is a C-style character string containing the name of the permanent output results file.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Solve for hydraulics &amp; water quality</span>

<span class="n">MSXsolveH</span><span class="p">();</span><span class="w"></span>

<span class="n">MSXsolveQ</span><span class="p">();</span><span class="w"></span>

<span class="c1">//Copy saved results to a permanent file</span>

<span class="n">MSXsaveoutfile</span><span class="p">(</span><span class="s">&quot;example1.out&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Close the toolkits</span>

<span class="p">...</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxsavemsxfile">
<h2>MSXsavemsxfile<a class="headerlink" href="#msxsavemsxfile" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXsavemsxfile(char * f);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Saves the data associated with the current MSX project into a new MSX input file.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>f is a C-style character string containing the name of the file to which data are saved.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>For a step-wise simulation using MSXstep, this function only applies
if MSXinit was called with its saveFlag parameter set to 1 (see
MSXinit).</p>
<p>The format of the binary results file is described in <a class="reference internal" href="#binary"><span class="std std-ref">BINARY OUTPUT FILE FORMAT</span></a>.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENopen</span><span class="p">(</span><span class="s">&quot;example1.inp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;example1.rpt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXopen</span><span class="p">(</span><span class="s">&quot;example1.msx&quot;</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Save the current MSX data to a different MSX file</span>

<span class="n">MSXsavemsxfile</span><span class="p">(</span><span class="s">&quot;example1a.msx&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Close the toolkits</span>

<span class="p">...</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxreport">
<h2>MSXreport<a class="headerlink" href="#msxreport" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXreport(void);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Writes water quality simulations results as instructed by the MSX
input file to a text file.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>None.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>Results are written to the report file specified in the ENopen
function, unless a specific water quality report file is named in the
<a class="reference internal" href="index.html#report"><span class="std std-ref">[REPORT]</span></a> section of the MSX input file.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Solve for hydraulics &amp; water quality</span>

<span class="n">MSXsolveH</span><span class="p">();</span><span class="w"></span>

<span class="n">MSXsolveQ</span><span class="p">();</span><span class="w"></span>

<span class="c1">//Write results to the &quot;example1.rpt&quot; file</span>

<span class="n">MSXreport</span><span class="p">();</span><span class="w"></span>

<span class="c1">//Close the toolkits</span>

<span class="p">...</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetindex">
<h2>MSXgetindex<a class="headerlink" href="#msxgetindex" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetindex(int type, char * name, int * index);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves the internal index number of an MSX object given its name.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>type is the type of object being sought and must be one of the
following pre-defined constants:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_SPECIES    (for a chemical species)

MSX_CONSTANT   (for a reaction constant)

MSX_PARAMETER  (for a reaction parameter)

MSX_PATTERN    (for a time pattern)
</pre></div>
</div>
<p>name is a C-style character string containing the object’s ID name;</p>
<p>index is the sequence number (starting from 1) of the object in the
order it was listed in the MSX input file.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare an index variable</span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get the index of the chemical species named &quot;CL2&quot;</span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_SPECIES</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CL2&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetidlen">
<h2>MSXgetIDlen<a class="headerlink" href="#msxgetidlen" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetIDlen(int type, int index, int * len);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves the number of characters in the ID name of an MSX object
given its internal index number.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>type is the type of object being sought and must be one of the following pre-defined constants:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_SPECIES    (for a chemical species)

MSX_CONSTANT   (for a reaction constant)

MSX_PARAMETER  (for a reaction parameter)

MSX_PATTERN    (for a time pattern)
</pre></div>
</div>
<p>index is the sequence number of the object (starting from 1 as listed
in the MSX input file);</p>
<p>len is returned with the number of characters in the object’s ID
name, not counting the <em>null</em> termination character.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//This code finds the longest species name within a project</span>

<span class="c1">//Declare some variables</span>

<span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">maxlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Examine each species</span>

<span class="n">MSXgetcount</span><span class="p">(</span><span class="n">MSX_SPECIES</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">count</span><span class="p">);</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="n">count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="c1">//Update longest species name</span>

<span class="w">   </span><span class="n">MSXgetIDlen</span><span class="p">(</span><span class="n">MSX_SPECIES</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">len</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="n">maxlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetid">
<h2>MSXgetID<a class="headerlink" href="#msxgetid" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetID(int type, int index, char * id, int len);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves the ID name of an object given its internal index number.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>type is the type of object being sought and must be one of the
following pre-defined constants:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_SPECIES    (for a chemical species)

MSX_CONSTANT   (for a reaction constant)

MSX_PARAMETER  (for a reaction parameter)

MSX_PATTERN    (for a time pattern)
</pre></div>
</div>
<p>index is the sequence number of the object (starting from 1 as listed
in the MSX input file);</p>
<p>id is a C-style character string that is returned with the object’s
ID name.</p>
<p>len is the maximum number of characters that id can hold, not
counting the <em>null</em> termination character.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>The MSXgetIDlen function can determine the number of characters in an
object’s ID name so that the character array id can be properly sized
(to len + 1).</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare a string to hold a species ID</span>

<span class="kt">char</span><span class="w"> </span><span class="n">id</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get the name of the 2nd species in the MSX input file</span>

<span class="n">MSXgetID</span><span class="p">(</span><span class="n">MSX_SPECIES</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetcount">
<h2>MSXgetcount<a class="headerlink" href="#msxgetcount" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetcount(int type, int * count);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves the number of objects of a specific type.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>type is the type of object being sought and must be one of the following pre-defined constants:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_SPECIES    (for a chemical species)

MSX_CONSTANT   (for a reaction constant)

MSX_PARAMETER  (for a reaction parameter)

MSX_PATTERN    (for a time pattern)
</pre></div>
</div>
<p>count is the number of objects of that type defined in the MSX input file.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare a variable for the number of chemical species</span>

<span class="kt">int</span><span class="w"> </span><span class="n">nSpecies</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get the number of species</span>

<span class="n">MSXgetcount</span><span class="p">(</span><span class="n">MSX_SPECIES</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nSpecies</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetspecies">
<h2>MSXgetspecies<a class="headerlink" href="#msxgetspecies" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetspecies(int species, int * type, char * units, double * aTol,
                  double * rTol);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves the attributes of a chemical species given its internal
index number.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>species is the sequence number of the species (starting from 1 as
listed in the MSX input file);</p>
<p>type is returned with one of the following pre-defined constants:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_BULK    (defined as 0)  for a bulk water species

MSX_WALL    (defined as 1)  for a pipe wall surface species
</pre></div>
</div>
<p>units is a C-style character string array that is returned with the
mass units that were defined for the species in question. It must be
sized to hold a maximum of 15 characters plus the terminating null
character (for a total of 16).</p>
<p>aTol is returned with the absolute concentration tolerance defined
for the species (in concentration units);</p>
<p>rTol is returned with the relative concentration tolerance defined
for the species.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare some variables</span>

<span class="kt">int</span><span class="w"> </span><span class="n">sIndex</span><span class="p">,</span><span class="w"> </span><span class="n">sType</span><span class="p">,</span><span class="w"> </span><span class="n">sUnits</span><span class="p">;</span><span class="w"></span>

<span class="kt">double</span><span class="w"> </span><span class="n">aTol</span><span class="p">,</span><span class="w"> </span><span class="n">rTol</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get attributes of the species named &quot;Xwall&quot;</span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_SPECIES</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Xwall&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sIndex</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetspecie</span><span class="p">(</span><span class="n">sIndex</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sType</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sUnits</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">aTol</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rTol</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetinitqual">
<h2>MSXgetinitqual<a class="headerlink" href="#msxgetinitqual" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetinitqual(int obj, int index, int species, double * value);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves the initial concentration of a particular chemical species
assigned to a specific node or link of the pipe network.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>obj is type of object being queried and must be either:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_NODE    (defined as 0)  for a node

MSX_LINK    (defined as 1)  for a link
</pre></div>
</div>
<p>index is the internal sequence number (starting from 1) assigned to
the node or link;</p>
<p>species is the sequence number of the species (starting from 1);</p>
<p>value is returned with the initial concentration of the species at
the node or link of interest.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>The EPANET toolkit functions ENgetnodeindex and ENgetlinkindex can be
used to identify the index of a node or link from its ID name;</p>
<p>Concentrations are expressed as mass units per liter for bulk species
and as mass per unit area for surface species.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>

<span class="kt">double</span><span class="w"> </span><span class="n">c0</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get initial concentration Of &quot;CL2&quot; in &quot;Tank_A&quot;</span>

<span class="n">ENgetnodeindex</span><span class="p">(</span><span class="s">&quot;Tank_A&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_SPECIES</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CL2&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetinitqual</span><span class="p">(</span><span class="n">MSX_NODE</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">c0</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetqual">
<h2>MSXgetqual<a class="headerlink" href="#msxgetqual" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetqual(int obj, int index, int species, double * value);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves a chemical species concentration at a given node or the
average concentration along a link at the current simulation time
step.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>obj is type of object being queried and must be either:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_NODE    (defined as 0)  for a node

MSX_LINK    (defined as 1)  for a link
</pre></div>
</div>
<p>index is the internal sequence number (starting from 1) assigned to
the node or link;</p>
<p>species is the sequence number of the species (starting from 1 as
listed in the MSX input file);</p>
<p>value is returned with the computed concentration of the species at
the current time period.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>The EPANET toolkit functions ENgetnodeindex and ENgetlinkindex can be
used to identify the index of a node or link from its ID name;</p>
<p>Concentrations are expressed as mass units per liter for bulk species
and as mass per unit area for surface species.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare some variables</span>

<span class="kt">long</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">tstep</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>

<span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">cMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get the indexes of node &quot;Tank_A&quot; and species &quot;CL2&quot;</span>

<span class="n">ENgetnodeindex</span><span class="p">(</span><span class="s">&quot;Tank_A&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_SPECIES</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CL2&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Obtain a hydraulic solution</span>

<span class="n">MSXsolveH</span><span class="p">();</span><span class="w"></span>

<span class="c1">//Run a step-wise water quality analysis</span>

<span class="c1">//without saving results to file</span>

<span class="n">MSXinit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXstep</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tleft</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">//Retrieve CL2 concentration at Tank_A</span>

<span class="w">      </span><span class="n">MSXgetqual</span><span class="p">(</span><span class="n">MSX_NODE</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span><span class="w"></span>

<span class="w">     </span><span class="c1">//Update the max. concentration</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">cMax</span><span class="p">)</span><span class="w"> </span><span class="n">cMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">tleft</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Close the toolkits</span>

<span class="p">...</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetconstant">
<h2>MSXgetconstant<a class="headerlink" href="#msxgetconstant" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetconstant(int index, double * value);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves the value of a particular reaction constant.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>index is the sequence number of the reaction constant (starting from
1) as it appeared in the MSX input file;</p>
<p>value is returned with the value assigned to the constant.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare some variables</span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>

<span class="kt">double</span><span class="w"> </span><span class="n">k1</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get the index of the constant named K1</span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_CONSTANT</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K1&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Get the value of K1</span>

<span class="n">MSXgetconstant</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">k1</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetparameter">
<h2>MSXgetparameter<a class="headerlink" href="#msxgetparameter" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetparameter(int obj, int index, int param, double * value);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves the value of a particular reaction parameter for a given
pipe or tank within the pipe network.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>obj is type of object being queried and must be either:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_NODE    (defined as 0)  for a node

MSX_LINK    (defined as 1)  for a link
</pre></div>
</div>
<p>index is the internal sequence number (starting from 1) assigned to
the node or link;</p>
<p>param is the sequence number of the parameter (starting from 1 as
listed in the MSX input file);</p>
<p>value is returned with the value assigned to the parameter for the
node or link of interest.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>Reaction parameters are only defined for storage tank nodes and pipe
links. All other types of nodes and links have parameter values of 0.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare some variables</span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w"></span>

<span class="kt">double</span><span class="w"> </span><span class="n">k2</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get the value of parameter &quot;K2&quot; for pipe &quot;P1&quot;</span>

<span class="n">ENgetlinkindex</span><span class="p">(</span><span class="s">&quot;P1&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_PARAMETER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">j</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetparameter</span><span class="p">(</span><span class="n">MSX_LINK</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">k2</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetsource">
<h2>MSXgetsource<a class="headerlink" href="#msxgetsource" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetsource(int node, int species, int * type, double * level, int * pat);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves information on any external source of a particular chemical
species assigned to a specific node of the pipe network.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>node is the internal sequence number (starting from 1) assigned to
the node of interest;</p>
<p>species is the sequence number of the species of interest (starting
from 1 as listed in the MSX input file);</p>
<p>type is returned with the type of external source and will be one of
the following pre-defined constants:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_NOSOURCE   (defined as -1) for no source

MSX_CONCEN     (defined as 0)  for a concentration source

MSX_MASS       (defined as 1)  for a mass booster source

MSX_SETPOINT   (defined as 2)  for a setpoint source

MSX_FLOWPACED  (defined as 3)  for a flow paced source
</pre></div>
</div>
<p>The meaning of these source types can be found in the description of the <a class="reference internal" href="index.html#sources"><span class="std std-ref">[SOURCES]</span></a> section of the MSX input file in <a class="reference internal" href="index.html#inputformat"><span class="std std-ref">INPUT FILE FORMAT</span></a> of this manual.</p>
<p>level is returned with the baseline concentration (or mass flow rate)
of the source;</p>
<p>pat is returned with the index of the time pattern used to add
variability to the source’s baseline level (and will be 0 if no
pattern was defined for the source).</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare some variables</span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"></span>

<span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get source information for species CL2 at node N1</span>

<span class="n">ENgetnodeindex</span><span class="p">(</span><span class="s">&quot;N1&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_SPECIES</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CL2&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetsource</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetpatternlen">
<h2>MSXgetpatternlen<a class="headerlink" href="#msxgetpatternlen" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetpatternlen(int pat, int * len);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves the number of time periods within a source time pattern.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>pat is the internal sequence number (starting from 1) of the pattern
as it appears in the MSX input file;</p>
<p>len is returned with the number of time periods (and therefore number
of multipliers) that appear in the pattern.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>This function only applies to source time patterns that appear in the
MSX input file. There is a comparable EPANET toolkit function,
ENgetpatternlen, which can be used for the demand patterns defined in
the EPANET input file.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare some variables</span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get the number of multipliers (n) in pattern &quot;P1&quot;</span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="s">&quot;P1&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetpatternlen</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgetpatternvalue">
<h2>MSXgetpatternvalue<a class="headerlink" href="#msxgetpatternvalue" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgetpatternvalue(int pat, int period, double * value);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Retrieves the multiplier at a specific time period for a given source
time pattern.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>pat is the internal sequence number (starting from 1) of the pattern
as it appears in the MSX input file;</p>
<p>period is the index of the time period (starting from 1) whose
multiplier is being sought;</p>
<p>value is returned with the value of the pattern’s multiplier in the
desired period.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>This function only applies to source time patterns that appear in the
MSX input file. There is a comparable EPANET toolkit function,
Engetpatternvalue, which can be used for the demand patterns defined
in the EPANET input file.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare some variables</span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get the number of multipliers (n) in pattern &quot;P1&quot;</span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="s">&quot;P1&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetpatternlen</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxgeterror">
<h2>MSXgeterror<a class="headerlink" href="#msxgeterror" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXgeterror(int code, char * msg, int len);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Returns the text for an error message given its error code.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>code is the code number of an error condition generated by
EPANET-MSX;</p>
<p>msg is a C-style character string that is returned containing the
text of the error message corresponding to the error code;</p>
<p>len is the maximum number of characters that msg can contain.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>msg should be sized to accept a minimum of 80 characters.</p>
<p>This function only applies to error codes generated by the MSX
toolkit. There is a comparable EPANET toolkit function, ENgeterror,
that applies to EPANET errors.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span><span class="w"> </span><span class="n">msg</span><span class="p">[</span><span class="mi">81</span><span class="p">];</span><span class="w"></span>

<span class="c1">//Open the EPANET toolkit &amp; check for errors</span>

<span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enopen</span><span class="p">(</span><span class="s">&quot;example1.inp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;example1.rpt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">ENgeterror</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Open the MSX toolkit &amp; check for errors</span>

<span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXopen</span><span class="p">(</span><span class="s">&quot;example1.msx&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">MSXgeterror</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"></span>

<span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxsetconstant">
<h2>MSXsetconstant<a class="headerlink" href="#msxsetconstant" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXsetconstant(int index, double value);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Assigns a new value to a specific reaction constant.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>index is the sequence number of the reaction constant (starting from
1) as it appeared in the MSX input file;</p>
<p>value is the new value to be assigned to the constant.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare an index variable</span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get the index of the constant named K1</span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_CONSTANT</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K1&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Set a new value of K1</span>

<span class="n">MSXsetconstant</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="mf">0.53</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxsetparameter">
<h2>MSXsetparameter<a class="headerlink" href="#msxsetparameter" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXsetparameter(int type, int index, int param, double value);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Assigns a value to a particular reaction parameter for a given pipe
or tank within the pipe network.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>type is type of object being queried and must be either:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_NODE    (defined as 0) for a node

MSX_LINK    (defined as 1) for a link
</pre></div>
</div>
<p>index is the internal sequence number (starting from 1) assigned to
the node or link;</p>
<p>param is the sequence number of the parameter (starting from 1 as
listed in the MSX input file);</p>
<p>value is the value to be assigned to the parameter for the node or
link of interest.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>Reaction parameters are only defined for storage tank nodes and pipe
links. Attempts to set parameter values for other types of nodes and
links will be ignored.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare some index variables</span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get indexes for parameter &quot;K2&quot; for pipe &quot;P1&quot;</span>

<span class="n">ENgetlinkindex</span><span class="p">(</span><span class="s">&quot;P1&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_PARAMETER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">j</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Set a new value for the parameter</span>

<span class="n">MSXsetparameter</span><span class="p">(</span><span class="n">MSX_LINK</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="mf">0.25</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxsetinitqual">
<h2>MSXsetinitqual<a class="headerlink" href="#msxsetinitqual" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXsetinitqual(int type, int index, int species, double value);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Assigns an initial concentration of a particular chemical species to
a specific node or link of the pipe network.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>type is type of object being queried and must be either:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_NODE    (defined as 0) for a node

MSX_LINK    (defined as 1) for a link
</pre></div>
</div>
<p>index is the internal sequence number (starting from 1) assigned to
the node or link;</p>
<p>species is the sequence number of the species (starting from 1 as
listed in the MSX input file);</p>
<p>value is the initial concentration of the species to be applied at
the node or link of interest.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>The EPANET toolkit functions ENgetnodeindex and ENgetlinkindex can be
used to identify the index of a node or link from its ID name;</p>
<p>Concentrations are expressed as mass units per liter for bulk species
and as mass per unit area for surface species.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare some index variables</span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get the indexes of node &quot;Tank_A&quot; and species &quot;CL2&quot;</span>

<span class="n">ENgetnodeindex</span><span class="p">(</span><span class="s">&quot;Tank_A&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_SPECIES</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CL2&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Then set the initial concentration</span>

<span class="n">MSXsetinitqual</span><span class="p">(</span><span class="n">MSX_NODE</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mf">1.25</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxsetsource">
<h2>MSXsetsource<a class="headerlink" href="#msxsetsource" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXsetsource(int node, int species, int type, double level, int pat);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Sets the attributes of an external source of a particular chemical
species to a specific node of the pipe network.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>node is the internal sequence number (starting from 1) assigned to
the node of interest;</p>
<p>species is the sequence number of the species of interest (starting
from 1 as listed in the MSX input file);</p>
<p>type is the type of external source to be utilized and will be one of
the following pre-defined constants:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MSX_NOSOURCE    (defined as -1) for no source

MSX_CONCEN      (defined as 0)  for a concentration source

MSX_MASS        (defined as 1)  for a mass booster source

MSX_SETPOINT    (defined as 2)  for a setpoint source

MSX_FLOWPACED   (defined as 3)  for a flow paced source
</pre></div>
</div>
<p>The meaning of these source types can be found in the description of
the <a class="reference internal" href="index.html#sources"><span class="std std-ref">[SOURCES]</span></a> section of the MSX input file in <a class="reference internal" href="index.html#inputformat"><span class="std std-ref">INPUT FILE FORMAT</span></a> of this manual.</p>
<p>level is the baseline concentration (or mass flow rate) of the
source;</p>
<p>pat is the index of the time pattern used to add variability to the
source’s baseline level (use 0 if the source has a constant
strength).</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>The EPANET toolkit function ENgetnodeindex can be used to identify
the index of a node from its ID name;</p>
<p>Concentrations are expressed as mass units per liter for bulk species
and as mass per unit area for surface species.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare some index variables</span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get indexes for species CL2 and node N1</span>

<span class="n">ENgetnodeindex</span><span class="p">(</span><span class="s">&quot;N1&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span><span class="w"></span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_SPECIES</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CL2&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Assign a constant source strength of 1 mg/L</span>

<span class="n">MSXsetsource</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">MSX_SETPOINT</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxsetpattern">
<h2>MSXsetpattern<a class="headerlink" href="#msxsetpattern" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXsetpattern(int pat, double mult[], int len);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Assigns a new set of multipliers to a given MSX source time pattern.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>pat is the internal sequence number (starting from 1) of the pattern
as it appears in the MSX input file;</p>
<p>mult[] is an array of multiplier values to replace those previously
used by the pattern;</p>
<p>len is the number of entries int the multiplier array mult.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>This function only applies to source time patterns that appear in the
MSX input file. There is a comparable EPANET toolkit function,
ENsetpattern, which can be used for the demand patterns defined in
the EPANET input file.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare an array of multipliers</span>

<span class="kt">double</span><span class="w"> </span><span class="n">mult</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">1.1</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">};</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>

<span class="c1">//Open the EPANET &amp; MSX toolkits</span>

<span class="p">...</span><span class="w"></span>

<span class="c1">//Get index for pattern &quot;P1&quot;</span>

<span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_PATTERN</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;P1&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Assign multipliers to the pattern</span>

<span class="n">MSXsetpattern</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">mult</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="msxsetpatternvalue">
<h2>MSXsetpatternvalue<a class="headerlink" href="#msxsetpatternvalue" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXsetpatternvalue(int pat, int period, double value);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Assigns a new value to the multiplier for a specific time period in a
given MSX source time pattern.</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>pat is the internal sequence number (starting from 1) of the pattern
as it appears in the MSX input file;</p>
<p>period is the time period (starting from 1) in the pattern to be
replaced;</p>
<p>value is the new multiplier value to use for that time period.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>This function only applies to source time patterns that appear in the
MSX input file. There is a comparable EPANET toolkit function,
ENsetpatternvalue, which can be used for the demand patterns defined
in the EPANET input file.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div></div></blockquote>
</section>
<section id="msxaddpattern">
<h2>MSXaddpattern<a class="headerlink" href="#msxaddpattern" title="Permalink to this heading">¶</a></h2>
<p><strong>Declaration:</strong></p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int MSXaddpattern(char \* id);
</pre></div>
</div>
</div></blockquote>
<p><strong>Description:</strong></p>
<blockquote>
<div><p>Adds a new, empty MSX source time pattern to an MSX project</p>
</div></blockquote>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p>id is a C-style character string containing the name of the new
pattern.</p>
</div></blockquote>
<p><strong>Returns:</strong></p>
<blockquote>
<div><p>Returns an error code or 0 for no error.</p>
</div></blockquote>
<p><strong>Notes:</strong></p>
<blockquote>
<div><p>The new pattern has no time periods or multipliers assigned to it.
The MSXsetpattern function can be used to assign an array of
multipliers to the pattern.</p>
</div></blockquote>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Declare some variables</span>

<span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"></span>

<span class="kt">double</span><span class="w"> </span><span class="n">mult</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">,</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">};</span><span class="w"></span>

<span class="c1">//Create a new pattern named &quot;newPat&quot;</span>

<span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSXaddpattern</span><span class="p">(</span><span class="s">&quot;newPat&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Assign multipliers to it</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">MSXgetindex</span><span class="p">(</span><span class="n">MSX_PATTERN</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;newPat&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">MSXsetpattern</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">mult</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="binary-output-file-format">
<span id="binary"></span><h1>BINARY OUTPUT FILE FORMAT<a class="headerlink" href="#binary-output-file-format" title="Permalink to this heading">¶</a></h1>
<p>The EPANET-MSX system can save the water quality results it computes to
a binary output file. This file can be named and saved to disk using the
MSXsaveoutfile function. The format of the file’s contents is described
in <a class="reference internal" href="#t-binary"><span class="std std-numref">Table 4</span></a> below.</p>
<span id="t-binary"></span><table class="longtable docutils align-default" id="id5">
<caption><span class="caption-text">Format of the EPANET-MSX binary output file</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Quantity</strong></p></th>
<th class="head"><p><strong>Size and Type</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Magic number (516114521)</p></td>
<td><p>4-byte integer</p></td>
</tr>
<tr class="row-odd"><td><p>Version number (currently 200000)</p></td>
<td><p>4-byte integer</p></td>
</tr>
<tr class="row-even"><td><p>Number of network nodes</p></td>
<td><p>4-byte integer</p></td>
</tr>
<tr class="row-odd"><td><p>Number of network links</p></td>
<td><p>4-byte integer</p></td>
</tr>
<tr class="row-even"><td><p>Number of water quality species</p></td>
<td><p>4-byte integer</p></td>
</tr>
<tr class="row-odd"><td><p>Reporting time step (seconds)</p></td>
<td><p>4-byte integer</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">For each water quality species:</div>
<div class="line-block">
<div class="line">Number of characters in ID name (N)</div>
<div class="line">ID name</div>
<div class="line">Species units</div>
</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line">4-byte integer</div>
<div class="line">N character bytes</div>
<div class="line">15 character bytes</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">For each reporting period:</div>
<div class="line-block">
<div class="line">For each water quality species:</div>
<div class="line-block">
<div class="line">For each network node:</div>
<div class="line-block">
<div class="line">Nodal water quality result</div>
<div class="line"><br /></div>
</div>
</div>
<div class="line">For each water quality species:</div>
<div class="line-block">
<div class="line">For each network link:</div>
<div class="line-block">
<div class="line">Link water quality result</div>
</div>
</div>
</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line">4-byte float</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line">4-byte float</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Byte offset where water quality results begin</p></td>
<td><p>4-byte integer</p></td>
</tr>
<tr class="row-odd"><td><p>Number of reporting periods</p></td>
<td><p>4-byte integer</p></td>
</tr>
<tr class="row-even"><td><p>Error code</p></td>
<td><p>4-byte integer</p></td>
</tr>
<tr class="row-odd"><td><p>Magic number (516114521)</p></td>
<td><p>4-byte integer</p></td>
</tr>
</tbody>
</table>
</section>
<section id="msx-error-codes">
<span id="errorcodes"></span><h1>MSX ERROR CODES<a class="headerlink" href="#msx-error-codes" title="Permalink to this heading">¶</a></h1>
<table class="longtable docutils align-default" id="id6">
<caption><span class="caption-text">EPANET-MSX Error Codes</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 22%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Error Code</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Error 200:</strong></p></td>
<td><p><strong>Cannot read EPANET-MSX file.</strong></p>
<p>One or more errors were found when processing the MSX
input file. See the report output file for details.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 501:</strong></p></td>
<td><p><strong>insufficient memory available.</strong></p>
<p>There is not enough physical memory in the computer to
analyze the pipe network.</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 502:</strong></p></td>
<td><p><strong>no EPANET data file supplied.</strong></p>
<p>A standard EPANET input was not opened with a call to
ENopen before the MSX system was opened with MSXopen.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 503:</strong></p></td>
<td><p><strong>could not open MSX input file.</strong></p>
<p>The MSX input file does not exist or cannot be opened
(i.e., it may be in use by another program).</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 504:</strong></p></td>
<td><p><strong>could not open hydraulic results file.</strong></p>
<p>The hydraulic results file specified in the
MSXusehydfile function either does not exist or cannot
be opened.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 505:</strong></p></td>
<td><p><strong>could not read hydraulic results file.</strong></p>
<p>The hydraulic results file generated by the MSXsolveH
function or imported by the MSXusehydfile function could
not be read correctly. This could happen if, for
example, an imported file was not actually a hydraulic
results file.</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 506:</strong></p></td>
<td><p><strong>could not read MSX input file.</strong></p>
<p>The contents of the MSX input file were formatted
incorrectly or had other errors (such as duplicate ID
names for objects of the same type). The specific errors
and the offending lines will be listed in the report
file named when calling the ENopen function.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 507:</strong></p></td>
<td><p><strong>too few pipe reaction expressions.</strong></p>
<p>The total number of Rate, Equilibrium, and Formula
expressions in the [PIPES] section of the MSX input file
must equal the total number of species defined.</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 508:</strong></p></td>
<td><p><strong>too few tank reaction expressions.</strong></p>
<p>The total number of Rate, Equilibrium, and Formula
expressions in the [TANKS] section of the MSX input file
must equal the total number of bulk species defined.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 509:</strong></p></td>
<td><p><strong>could not open differential equation solver.</strong></p>
<p>The system’s differential equation solver could not be
opened, possibly because of insufficient memory
available.</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 510:</strong></p></td>
<td><p><strong>could not open algebraic solver.</strong></p>
<p>The system’s nonlinear equation solver could not be
opened, possibly because of insufficient memory
available.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 511:</strong></p></td>
<td><p><strong>could not open binary results file.</strong></p>
<p>The binary output file where EPANET-MSX stores its
computed results could not be opened or does not exist.</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 512:</strong></p></td>
<td><p><strong>read/write error on binary results file.</strong></p>
<p>An error occurred when either writing a result to the
binary results file or reading a result from the file.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 513:</strong></p></td>
<td><p><strong>could not integrate reaction rate expressions.</strong></p>
<p>The differential equation solver employed by EPANET-MSX
could not successfully integrate the system’s reaction
rate equations over the current water quality time step.
One could try re-running the analysis using a smaller
time step or larger values for ATOL and RTOL (as
specified in the [OPTIONS] or [SPECIES] sections of the
MSX input file).</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 514:</strong></p></td>
<td><p><strong>could not solve reaction equilibrium expressions.</strong></p>
<p>The nonlinear equation solver employed by EPANET-MSX
could not successfully solve the system’s set of
equilibrium equations at the current simulation time.
Users must insure that the initial conditions set
throughout the pipe network are sufficient and
consistent so that a solution exisits for the governing
set of equilibrium equations.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 515:</strong></p></td>
<td><p><strong>reference made to an unknown type of object.</strong></p>
<p>The object type code number supplied as an argument in
one of the MSX toolkit functions does not equal any of
the predefined code numbers.</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 516:</strong></p></td>
<td><p><strong>reference made to an illegal object index.</strong></p>
<p>The object index number supplied as an argument in one
of the MSX toolkit functions is either &lt;= 0 or higher
than the number of objects of the type of being
referenced.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 517:</strong></p></td>
<td><p><strong>reference made to an undefined object ID.</strong></p>
<p>The object ID name supplied as an argument in one of the
MSX toolkit functions does not belong to any object
defined in the MSX input file.</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 518:</strong></p></td>
<td><p><strong>invalid property values were specified.</strong></p>
<p>An invalid value was supplied as an argument to one of
the MSX toolkit functions that modifies a specific
property of an object (e.g., an initial or source
concentration cannot be a negative value).</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 519:</strong></p></td>
<td><p><strong>an MSX project was not opened.</strong></p>
<p>A call was made to an MSX toolkit function without
having first successfully opened a project with the
MSXopen function.</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 520:</strong></p></td>
<td><p><strong>an MSX project is already opened.</strong></p>
<p>A call was made to open an MSX project without having
first closed a currently opened project with the
MSXclose function.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 521:</strong></p></td>
<td><p><strong>could not open MSX report file.</strong></p>
<p>The MSX report file cannot be opened (i.e., it may be in use
by another program).</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 522:</strong></p></td>
<td><p><strong>could not compile chemistry functions.</strong></p>
<p>The compiler selected in the <strong>COMPILER</strong> option is not
available on the user’s file system.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Error 523:</strong></p></td>
<td><p><strong>could not load functions from compiled chemistry file.</strong></p>
<p>There was an internal error when trying to dynamically load
the compiled chemistry functions into the running application.</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>Error 524:</strong></p></td>
<td><p><strong>illegal math operation.</strong></p>
<p>An illegal operation (such as trying to raise a negative number
to a power) occurred while evaluating a mathematical expression.
The specie or term with the offending mathematical expression
is identified in the EPANET report file and the simulation is
terminated.</p>
</td>
</tr>
</tbody>
</table>
</section>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="#">Table of Contents</a></h3>
    <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-1_introduction">1. INTRODUCTTION</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-2_framework">2. CONCEPTUAL FRAMEWORK</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#material-transport">2.1. <em>Material Transport</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#advection-dispersion-and-reaction">2.2. <em>Advection, Dispersion and Reaction</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#chemical-reactions">2.3. <em>Chemical Reactions</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#full-network-solution">2.4. <em>Full Network Solution</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#reaction-system-solution">2.5. <em>Reaction System Solution</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#pipe-surface-discretization">2.6. <em>Pipe Surface Discretization</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#model-implementation">2.7. <em>Model Implementation</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-3_programusage">3. PROGRAM USAGE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#example-command-line-run">3.1. <em>Example Command Line Run</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#example-toolkit-usage">3.2. <em>Example Toolkit Usage</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-compiled-reaction-models">3.3. <em>Using Compiled Reaction Models</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-4_inputformat">4. INPUT FILE FORMAT</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#title">4.1. <strong>[TITLE]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#options">4.2. <strong>[OPTIONS]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#species">4.3. <strong>[SPECIES]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#coefficients">4.4. <strong>[COEFFICIENTS]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#terms">4.5. <strong>[TERMS]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#pipes">4.6. <strong>[PIPES]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tanks">4.7. <strong>[TANKS]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sources">4.8. <strong>[SOURCES]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#quality">4.9. <strong>[QUALITY]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#parameters">4.10. <strong>[PARAMETERS]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#patterns">4.11. <strong>[PATTERNS]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#dispersion">4.12. <strong>[DISPERSION]</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#report">4.13. <strong>[REPORT]</strong></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-5_examplesystems">5. EXAMPLE REACTION SYSTEMS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#multi-source-chlorine-decay">5.1. <em>Multi-Source Chlorine Decay</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#oxidation-mass-transfer-and-adsorption">5.2. <em>Oxidation, Mass Transfer, and Adsorption</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#bacterial-regrowth-with-chlorine-inhibition">5.3. <em>Bacterial Regrowth with Chlorine Inhibition</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#chloramine-decomposition">5.4. <em>Chloramine Decomposition</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-reference">6. BIBLIOGRAPHY</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">APPENDIX</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-back_matter">MSX TOOLKIT FUNCTIONS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxopen">MSXopen</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxclose">MSXclose</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxsolveh">MSXsolveH</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxusehydfile">MSXusehydfile</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxsolveq">MSXsolveQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxinit">MSXinit</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxstep">MSXstep</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxsaveoutfile">MSXsaveoutfile</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxsavemsxfile">MSXsavemsxfile</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxreport">MSXreport</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetindex">MSXgetindex</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetidlen">MSXgetIDlen</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetid">MSXgetID</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetcount">MSXgetcount</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetspecies">MSXgetspecies</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetinitqual">MSXgetinitqual</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetqual">MSXgetqual</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetconstant">MSXgetconstant</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetparameter">MSXgetparameter</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetsource">MSXgetsource</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetpatternlen">MSXgetpatternlen</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgetpatternvalue">MSXgetpatternvalue</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxgeterror">MSXgeterror</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxsetconstant">MSXsetconstant</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxsetparameter">MSXsetparameter</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxsetinitqual">MSXsetinitqual</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxsetsource">MSXsetsource</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxsetpattern">MSXsetpattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxsetpatternvalue">MSXsetpatternvalue</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#msxaddpattern">MSXaddpattern</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#binary-output-file-format">BINARY OUTPUT FILE FORMAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#msx-error-codes">MSX ERROR CODES</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="#">EPANETMSX 2.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">EPANETMSX 2.0 documentation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.1.1.
    </div>
  </body>
</html>